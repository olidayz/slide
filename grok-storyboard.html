<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spec Campaigns — Storyboards</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0a;
            --text-primary: #ffffff;
            --text-secondary: #888;
            --accent: #FF6B00;
            --accent-bright: #FF8C33;
            --danger: #FF6B00;
            --frame-bg: #111111;
            --border: #2a2a2a;
            --comment-bg: #1a1a1a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Mono', monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Tab Navigation */
        .tab-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 200;
            background: var(--bg-dark);
            border-bottom: 1px solid var(--border);
            display: flex;
            padding: 0 48px;
        }

        .tab-btn {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding: 20px 32px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            position: relative;
            transition: color 0.3s ease;
        }

        .tab-btn:hover {
            color: var(--text-primary);
        }

        .tab-btn.active {
            color: var(--accent);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Header */
        .header {
            padding: 84px 48px 32px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .project-info h1 {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            font-weight: 400;
            color: var(--accent);
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-bottom: 12px;
        }

        .project-title {
            font-family: 'Space Mono', monospace;
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -1px;
        }

        .meta {
            text-align: right;
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        /* Progress indicator */
        .progress-bar {
            display: none;
        }

        /* Main content */
        .main {
            padding: 0 48px 100px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Concept section */
        .concept-section {
            margin-bottom: 80px;
            padding-bottom: 60px;
            border-bottom: 1px solid var(--border);
        }

        .section-label {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 24px;
        }

        .concept-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 48px;
        }

        .concept-item h3 {
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .concept-item p {
            font-size: 13px;
            line-height: 1.7;
            color: var(--text-secondary);
        }

        /* Storyboard */
        .storyboard-section {
            margin-bottom: 80px;
        }

        .frame-counter {
            position: fixed;
            right: 48px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 50;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .frame-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .frame-dot.active {
            background: var(--accent);
            transform: scale(1.5);
        }

        .frame-dot:hover {
            background: var(--text-secondary);
        }

        /* Frames */
        .frames-container {
            display: flex;
            flex-direction: column;
            gap: 120px;
        }

        .frame {
            display: grid;
            grid-template-columns: 1.4fr 1fr;
            gap: 60px;
            align-items: start;
            opacity: 0;
            transform: translateY(40px);
            animation: fadeInUp 0.8s ease forwards;
        }

        .frame:nth-child(1) { animation-delay: 0.1s; }
        .frame:nth-child(2) { animation-delay: 0.15s; }
        .frame:nth-child(3) { animation-delay: 0.2s; }
        .frame:nth-child(4) { animation-delay: 0.25s; }
        .frame:nth-child(5) { animation-delay: 0.3s; }
        .frame:nth-child(6) { animation-delay: 0.35s; }
        .frame:nth-child(7) { animation-delay: 0.4s; }
        .frame:nth-child(8) { animation-delay: 0.45s; }
        .frame:nth-child(9) { animation-delay: 0.5s; }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .frame-visual {
            aspect-ratio: 16/9;
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .frame-visual:hover {
            border-color: var(--accent);
        }

        .frame-visual.dragover {
            border-color: var(--accent);
            background: rgba(255, 107, 0, 0.1);
        }

        .frame-visual::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent 40%, rgba(255,255,255,0.02) 50%, transparent 60%);
            pointer-events: none;
        }

        .frame-number {
            position: absolute;
            top: 16px;
            left: 16px;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-primary);
            background: rgba(0,0,0,0.8);
            padding: 4px 10px;
            border-radius: 2px;
            z-index: 10;
        }

        .frame-timing {
            position: absolute;
            top: 16px;
            right: 16px;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--accent);
            background: rgba(0,0,0,0.8);
            padding: 4px 10px;
            border-radius: 2px;
            z-index: 10;
        }

        /* Visual placeholder content */
        .visual-content {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 32px;
        }

        .visual-description {
            font-family: 'Instrument Serif', serif;
            font-size: 20px;
            font-style: italic;
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.5;
        }

        /* Uploaded image */
        .frame-image {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 5;
        }

        .remove-image {
            position: absolute;
            top: 16px;
            right: 100px;
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--text-primary);
            background: rgba(255, 59, 59, 0.8);
            padding: 4px 10px;
            border-radius: 2px;
            z-index: 15;
            cursor: pointer;
            border: none;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: none;
        }

        .frame-visual:hover .remove-image {
            display: block;
        }

        .upload-hint {
            position: absolute;
            bottom: 16px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            color: var(--text-secondary);
            background: rgba(0,0,0,0.6);
            padding: 4px 12px;
            border-radius: 2px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        .frame-visual:hover .upload-hint {
            opacity: 1;
        }

        /* Hidden file input */
        .frame-file-input {
            display: none;
        }

        /* Chaos frames get orange tint */
        .frame.chaos .frame-visual {
            border-color: rgba(255, 107, 0, 0.4);
        }

        .frame.chaos .frame-visual::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, transparent 0%, rgba(255, 107, 0, 0.08) 100%);
            pointer-events: none;
        }

        /* Grok frames get white/bright tint */
        .frame.grok .frame-visual {
            border-color: rgba(255, 255, 255, 0.4);
        }

        .frame.grok .frame-visual::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, transparent 0%, rgba(255, 255, 255, 0.05) 100%);
            pointer-events: none;
        }

        /* Frame details */
        .frame-details {
            padding-top: 20px;
        }

        .frame-type {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 16px;
            display: inline-block;
            padding: 4px 12px;
            border-radius: 2px;
        }

        .frame.chaos .frame-type {
            color: var(--accent);
            background: rgba(255, 107, 0, 0.15);
        }

        .frame.transition .frame-type {
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.05);
        }

        .frame.grok .frame-type {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.1);
        }

        .frame.endcard .frame-type {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.1);
        }

        .frame-title {
            font-family: 'Space Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.3;
            color: var(--text-primary);
        }

        .frame-description {
            font-size: 13px;
            line-height: 1.8;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .frame-notes {
            padding: 16px;
            background: rgba(255, 107, 0, 0.03);
            border-left: 2px solid var(--accent);
            font-size: 12px;
            line-height: 1.7;
            margin-bottom: 20px;
            position: relative;
        }

        .frame-notes strong {
            font-family: 'Space Mono', monospace;
            color: var(--accent);
            display: block;
            margin-bottom: 8px;
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .frame-notes ul {
            list-style: none;
            color: var(--text-secondary);
        }

        .frame-notes li {
            padding-left: 16px;
            position: relative;
            margin-bottom: 6px;
        }

        .remove-notes-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 4px 8px;
            background: transparent;
            border: 1px solid transparent;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 2px;
            opacity: 0;
            transition: all 0.2s;
        }

        .frame-notes:hover .remove-notes-btn {
            opacity: 1;
        }

        .remove-notes-btn:hover {
            border-color: #ff3b3b;
            color: #ff3b3b;
        }

        .add-notes-btn {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 10px 16px;
            background: transparent;
            border: 1px dashed var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            margin-bottom: 20px;
            transition: all 0.2s;
            display: block;
            width: 100%;
            text-align: center;
        }

        .add-notes-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Editable text styles */
        [contenteditable="true"] {
            cursor: text;
            border-radius: 2px;
            transition: background 0.2s ease, box-shadow 0.2s ease;
        }

        [contenteditable="true"]:hover {
            background: rgba(255, 107, 0, 0.05);
        }

        [contenteditable="true"]:focus {
            outline: none;
            background: rgba(255, 107, 0, 0.1);
            box-shadow: 0 0 0 2px rgba(255, 107, 0, 0.3);
        }

        .frame-notes li::before {
            content: '—';
            position: absolute;
            left: 0;
            color: var(--accent);
        }

        /* CD Comments Section */
        .cd-comments {
            margin-top: 20px;
            padding: 16px;
            background: var(--comment-bg);
            border: 1px solid var(--border);
            border-radius: 4px;
        }

        .cd-comments-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .cd-comments-label {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: #4ECDC4;
        }

        .cd-comments-status {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            color: var(--text-secondary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .cd-comments-status.visible {
            opacity: 1;
        }

        .cd-comments-textarea {
            width: 100%;
            min-height: 80px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 12px;
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--text-primary);
            resize: vertical;
            line-height: 1.6;
        }

        .cd-comments-textarea::placeholder {
            color: var(--text-secondary);
            opacity: 0.5;
        }

        .cd-comments-textarea:focus {
            outline: none;
            border-color: #4ECDC4;
        }

        /* New Comments Section */
        .comments-section {
            margin-top: 16px;
        }

        .comments-header {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: #4ECDC4;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
        }

        .comments-header:hover {
            color: #6FE7E0;
        }

        .comments-toggle {
            font-size: 8px;
            transition: transform 0.2s;
        }

        .comments-section.collapsed .comments-toggle {
            transform: rotate(-90deg);
        }

        .comments-section.collapsed .comments-body {
            display: none;
        }

        .comment-count-badge {
            background: #4ECDC4;
            color: var(--bg-dark);
            font-size: 9px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        .comments-thread {
            max-height: 250px;
            overflow-y: auto;
            margin-bottom: 12px;
        }

        .comment-bubble {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 8px;
            position: relative;
        }

        .comment-bubble:hover {
            border-color: var(--border);
        }

        .comment-bubble-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .comment-bubble-author {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: #4ECDC4;
        }

        .comment-bubble-time {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            color: var(--text-secondary);
        }

        .comment-bubble-text {
            font-size: 13px;
            line-height: 1.5;
            color: var(--text-primary);
        }

        .comment-bubble-delete {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 14px;
            color: var(--text-secondary);
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
            padding: 4px;
        }

        .comment-bubble:hover .comment-bubble-delete {
            opacity: 1;
        }

        .comment-bubble-delete:hover {
            color: #ff3b3b;
        }

        .comment-input-row {
            display: flex;
            gap: 8px;
        }

        .comment-input {
            flex: 1;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 10px 12px;
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--text-primary);
        }

        .comment-input:focus {
            outline: none;
            border-color: #4ECDC4;
        }

        .comment-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.6;
        }

        .comment-submit {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 10px 16px;
            background: #4ECDC4;
            border: none;
            color: var(--bg-dark);
            cursor: pointer;
            border-radius: 4px;
            font-weight: 700;
            transition: opacity 0.2s;
        }

        .comment-submit:hover {
            opacity: 0.8;
        }

        /* End card special styling */
        .frame.endcard .frame-visual {
            background: var(--bg-dark);
            border-color: var(--text-primary);
        }

        .endcard-content {
            text-align: center;
        }

        .endcard-line {
            font-family: 'Space Mono', monospace;
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -1px;
            margin-bottom: 24px;
            color: var(--text-primary);
        }

        .endcard-grok {
            font-family: 'Space Mono', monospace;
            font-size: 18px;
            color: var(--accent);
            letter-spacing: 2px;
        }

        /* Footer */
        .footer {
            margin-top: 120px;
            padding-top: 40px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-left {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .footer-right {
            display: flex;
            gap: 24px;
        }

        .footer-link {
            font-size: 11px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-link:hover {
            color: var(--accent);
        }

        /* Clear data button */
        .clear-data-btn {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .clear-data-btn:hover {
            border-color: #ff3b3b;
            color: #ff3b3b;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .tab-nav {
                padding: 0 24px;
            }

            .tab-btn {
                padding: 16px 20px;
                font-size: 10px;
            }

            .header {
                padding: 20px 24px 40px;
            }

            .main {
                padding: 200px 24px 60px;
            }

            .concept-grid {
                grid-template-columns: 1fr;
                gap: 32px;
            }

            .frame {
                grid-template-columns: 1fr;
                gap: 32px;
            }

            .frame-counter {
                display: none;
            }

            .frame-title {
                font-size: 20px;
            }
        }

        /* Glitch effect for chaos frames */
        @keyframes glitch {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
        }

        .frame.chaos:hover .visual-description {
            animation: glitch 0.3s ease infinite;
        }

        /* Scan line effect */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 1000;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.03),
                rgba(0, 0, 0, 0.03) 1px,
                transparent 1px,
                transparent 2px
            );
            opacity: 0.5;
        }

        /* WIP Badge */
        .wip-badge {
            display: inline-block;
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding: 4px 10px;
            background: rgba(255, 107, 0, 0.2);
            color: var(--accent);
            border-radius: 2px;
            margin-left: 12px;
            vertical-align: middle;
            cursor: pointer;
            position: relative;
        }

        .wip-badge:hover {
            background: rgba(255, 107, 0, 0.4);
        }

        .wip-badge .remove-badge {
            display: none;
            position: absolute;
            top: -6px;
            right: -6px;
            width: 14px;
            height: 14px;
            background: #ff3b3b;
            border-radius: 50%;
            font-size: 10px;
            line-height: 14px;
            text-align: center;
            cursor: pointer;
        }

        .wip-badge:hover .remove-badge {
            display: block;
        }

        .add-status-btn {
            display: inline-block;
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 4px 8px;
            background: transparent;
            border: 1px dashed var(--border);
            color: var(--text-secondary);
            border-radius: 2px;
            margin-left: 12px;
            vertical-align: middle;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s, border-color 0.2s;
        }

        .add-status-btn:hover {
            opacity: 1;
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Add Tab Button */
        .add-tab-btn {
            font-family: 'Space Mono', monospace;
            font-size: 18px;
            padding: 20px 24px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .add-tab-btn:hover {
            color: var(--accent);
        }

        /* Delete Tab Button */
        .delete-tab-btn {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 2px;
            margin-left: 16px;
            transition: all 0.3s ease;
        }

        .delete-tab-btn:hover {
            border-color: #ff3b3b;
            color: #ff3b3b;
        }

        /* Brief Actions (in header) */
        .brief-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .brief-action-btn {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 8px 14px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 2px;
            transition: all 0.2s ease;
        }

        .brief-action-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .brief-action-btn.danger:hover {
            border-color: #ff3b3b;
            color: #ff3b3b;
        }

        .brief-action-btn.archive:hover {
            border-color: #888;
            color: #888;
        }

        /* Add Note Button */
        .add-note-btn {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 6px 12px;
            background: transparent;
            border: 1px dashed var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 2px;
            margin-top: 12px;
            transition: all 0.3s ease;
            display: block;
            width: 100%;
            text-align: center;
        }

        .add-note-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Note item with delete */
        .note-item {
            position: relative;
            padding-right: 30px;
        }

        .note-item .delete-note {
            position: absolute;
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            font-weight: bold;
            color: #ff3b3b;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
            padding: 4px 8px;
            z-index: 10;
            background: var(--bg-dark);
            border-radius: 2px;
        }

        .note-item:hover .delete-note {
            opacity: 1;
        }

        /* Editable meta fields */
        .meta [contenteditable="true"] {
            display: inline;
            padding: 2px 4px;
            margin: -2px -4px;
            border-radius: 2px;
        }

        .meta [contenteditable="true"]:hover {
            background: rgba(255, 107, 0, 0.1);
        }

        .meta [contenteditable="true"]:focus {
            background: rgba(255, 107, 0, 0.15);
            outline: none;
        }

        /* View toggle */
        .view-toggle {
            position: fixed;
            top: 70px;
            right: 48px;
            z-index: 150;
            display: flex;
            gap: 4px;
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 4px;
        }

        .view-btn {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 8px 12px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 2px;
            transition: all 0.2s;
        }

        .view-btn:hover {
            color: var(--text-primary);
        }

        .view-btn.active {
            background: var(--accent);
            color: var(--bg-dark);
        }

        /* Grid/Storyboard view - Cinematic film strip */
        .frames-container.grid-view {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .frames-container.grid-view .frame {
            display: block;
            position: relative;
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .frames-container.grid-view .frame-visual {
            aspect-ratio: 16/9;
            border: none;
            border-radius: 0;
        }

        .frames-container.grid-view .frame-visual .visual-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
        }

        .frames-container.grid-view .frame-visual .visual-description {
            font-size: 12px;
            padding: 16px;
        }

        .frames-container.grid-view .frame-details {
            padding: 12px 16px;
            background: rgba(0,0,0,0.5);
        }

        .frames-container.grid-view .frame-title {
            font-size: 11px;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .frames-container.grid-view .frame-description {
            font-size: 10px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 0;
        }

        .frames-container.grid-view .frame-notes,
        .frames-container.grid-view .cd-comments,
        .frames-container.grid-view .image-url-container,
        .frames-container.grid-view .frame-type,
        .frames-container.grid-view .delete-tab-btn {
            display: none;
        }

        .frames-container.grid-view .frame-number {
            font-size: 10px;
            padding: 3px 8px;
        }

        .frames-container.grid-view .frame-timing {
            font-size: 9px;
            padding: 3px 6px;
        }

        /* Hover effect for grid view */
        .frames-container.grid-view .frame:hover {
            border-color: var(--accent);
            transform: scale(1.02);
            transition: all 0.2s ease;
            z-index: 10;
        }

        @media (max-width: 1200px) {
            .frames-container.grid-view {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .frames-container.grid-view {
                grid-template-columns: 1fr;
            }
        }

        /* Archive styling */
        .tab-btn.archived {
            opacity: 0.4;
            text-decoration: line-through;
        }

        .tab-btn.archived:hover {
            opacity: 0.7;
        }

        /* Add Frame Button */
        .add-frame-btn {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 24px 48px;
            background: transparent;
            border: 2px dashed var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            margin-top: 60px;
            transition: all 0.3s ease;
            display: block;
            width: 100%;
            text-align: center;
        }

        .add-frame-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Status dropdown */
        .status-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 8px 0;
            z-index: 1000;
            min-width: 120px;
            display: none;
        }

        .status-dropdown.show {
            display: block;
        }

        .status-option {
            padding: 8px 16px;
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .status-option:hover {
            background: rgba(255, 107, 0, 0.1);
            color: var(--accent);
        }

        /* Modal for new brief */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 32px;
            max-width: 400px;
            width: 90%;
        }

        .modal h3 {
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 24px;
        }

        .modal input {
            width: 100%;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 12px;
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .modal input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .modal-btns {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .modal-btn {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-btn.primary {
            background: var(--accent);
            border: none;
            color: var(--bg-dark);
            font-weight: 700;
        }

        .modal-btn.secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .modal-btn:hover {
            opacity: 0.8;
        }

        /* Replit specific */
        .replit-notes {
            background: rgba(255, 107, 0, 0.05);
            border: 1px solid rgba(255, 107, 0, 0.2);
            border-radius: 4px;
            padding: 24px;
            margin-bottom: 40px;
        }

        .replit-notes h4 {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 16px;
        }

        .replit-notes ul {
            list-style: none;
        }

        .replit-notes li {
            font-size: 13px;
            line-height: 1.7;
            color: var(--text-secondary);
            padding-left: 20px;
            position: relative;
            margin-bottom: 8px;
        }

        .replit-notes li::before {
            content: '!';
            position: absolute;
            left: 0;
            color: var(--accent);
            font-weight: 700;
        }

        .idea-block {
            background: var(--frame-bg);
            border-left: 3px solid var(--accent);
            padding: 24px;
            margin: 24px 0;
        }

        .idea-block h4 {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .idea-block p {
            font-family: 'Instrument Serif', serif;
            font-size: 18px;
            font-style: italic;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Image URL Input - HIDDEN (use drag/drop instead) */
        .image-url-container {
            display: none;
        }

        .image-url-input {
            flex: 1;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 10px 12px;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-primary);
        }

        .image-url-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.5;
        }

        .image-url-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .image-url-btn {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 10px 16px;
            background: var(--accent);
            border: none;
            color: var(--bg-dark);
            cursor: pointer;
            border-radius: 4px;
            font-weight: 700;
            transition: opacity 0.2s;
        }

        .image-url-btn:hover {
            opacity: 0.8;
        }

        .image-url-btn.clear {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .image-url-btn.clear:hover {
            border-color: #ff3b3b;
            color: #ff3b3b;
        }

        /* Cloud Save Bar */
        .cloud-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--frame-bg);
            border-top: 1px solid var(--border);
            padding: 12px 48px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 300;
        }

        .cloud-bar-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .cloud-bar-label {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-secondary);
        }

        .cloud-bar-id {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--accent);
            background: rgba(255, 107, 0, 0.1);
            padding: 6px 12px;
            border-radius: 4px;
        }

        .cloud-bar-btn {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 10px 20px;
            background: var(--accent);
            border: none;
            color: var(--bg-dark);
            cursor: pointer;
            border-radius: 4px;
            font-weight: 700;
            transition: opacity 0.2s;
        }

        .cloud-bar-btn:hover {
            opacity: 0.8;
        }

        .cloud-bar-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .cloud-bar-btn.secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .cloud-bar-status {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* Add padding to footer so cloud bar doesn't overlap */
        .footer {
            margin-bottom: 60px;
        }

        /* ==========================================
           PRESENTATION MODE
           ========================================== */
        .presentation-mode {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 10000;
            display: none;
        }

        .presentation-mode.active {
            display: flex;
            flex-direction: column;
        }

        .presentation-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 10;
        }

        .presentation-mode:hover .presentation-header {
            opacity: 1;
        }

        .presentation-title {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--text-secondary);
        }

        .presentation-counter {
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            color: var(--accent);
        }

        .presentation-close {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 2px;
        }

        .presentation-close:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .presentation-frame {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 80px 120px;
        }

        .presentation-frame img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 4px;
        }

        .presentation-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            max-width: 600px;
        }

        .presentation-placeholder .frame-title {
            font-size: 36px;
            margin-bottom: 24px;
        }

        .presentation-placeholder .frame-description {
            font-size: 18px;
            line-height: 1.8;
            color: var(--text-secondary);
        }

        /* Presentation Split View */
        .presentation-split {
            display: flex;
            width: 100%;
            height: 100%;
            gap: 60px;
            align-items: center;
        }

        .presentation-split.no-image {
            justify-content: center;
        }

        .presentation-image {
            flex: 1;
            max-width: 60%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .presentation-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .presentation-text {
            flex: 0 0 35%;
            padding-right: 40px;
        }

        .presentation-frame-type {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 12px;
            display: block;
        }

        .presentation-text h2 {
            font-family: 'Instrument Serif', serif;
            font-size: 42px;
            font-weight: 400;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .presentation-text p {
            font-size: 16px;
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .presentation-visual-desc {
            max-width: 800px;
            text-align: center;
        }

        .presentation-visual-desc h2 {
            font-family: 'Instrument Serif', serif;
            font-size: 48px;
            font-weight: 400;
            margin-bottom: 32px;
        }

        .presentation-visual-desc .visual-text {
            font-size: 20px;
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .presentation-nav {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .presentation-mode:hover .presentation-nav {
            opacity: 1;
        }

        .presentation-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }

        .presentation-dot:hover {
            background: var(--text-secondary);
        }

        .presentation-dot.active {
            background: var(--accent);
            transform: scale(1.3);
        }

        .presentation-arrows {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 48px;
            color: var(--text-secondary);
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
            padding: 20px;
            user-select: none;
        }

        .presentation-mode:hover .presentation-arrows {
            opacity: 0.5;
        }

        .presentation-arrows:hover {
            opacity: 1 !important;
            color: var(--accent);
        }

        .presentation-arrows.prev { left: 20px; }
        .presentation-arrows.next { right: 20px; }

        /* ==========================================
           THREADED COMMENTS
           ========================================== */
        .comments-thread {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 12px;
        }

        .comment-item {
            padding: 12px;
            background: var(--bg-dark);
            border-radius: 4px;
            margin-bottom: 8px;
            position: relative;
        }

        .comment-item:last-child {
            margin-bottom: 0;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .comment-author {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: #4ECDC4;
        }

        .comment-time {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            color: var(--text-secondary);
        }

        .comment-text {
            font-size: 12px;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .comment-delete {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 14px;
            color: var(--text-secondary);
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .comment-item:hover .comment-delete {
            opacity: 1;
        }

        .comment-delete:hover {
            color: #ff3b3b;
        }

        .comment-input-row {
            display: flex;
            gap: 8px;
        }

        .comment-input {
            flex: 1;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 10px 12px;
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--text-primary);
        }

        .comment-input:focus {
            outline: none;
            border-color: #4ECDC4;
        }

        .comment-submit {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 10px 16px;
            background: #4ECDC4;
            border: none;
            color: var(--bg-dark);
            cursor: pointer;
            border-radius: 4px;
            font-weight: 700;
        }

        .comment-submit:hover {
            opacity: 0.8;
        }

        /* ==========================================
           MOODBOARD SECTION - COLLAPSIBLE MOSAIC
           ========================================== */
        .moodboard-section {
            margin-bottom: 60px;
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            background: var(--frame-bg);
        }

        .moodboard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            cursor: pointer;
            transition: background 0.2s;
            user-select: none;
        }

        .moodboard-header:hover {
            background: rgba(255, 107, 0, 0.05);
        }

        .moodboard-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .moodboard-toggle {
            font-size: 12px;
            color: var(--accent);
            transition: transform 0.3s;
        }

        .moodboard-section.collapsed .moodboard-toggle {
            transform: rotate(-90deg);
        }

        .moodboard-title-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .moodboard-title {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--text-primary);
        }

        .moodboard-ai-summary {
            font-family: 'Instrument Serif', serif;
            font-size: 14px;
            font-style: italic;
            color: var(--text-secondary);
            max-width: 500px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .moodboard-count {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--text-secondary);
            background: var(--bg-dark);
            padding: 4px 10px;
            border-radius: 12px;
        }

        .moodboard-body {
            max-height: 600px;
            overflow: hidden;
            transition: max-height 0.4s ease, padding 0.4s ease;
            padding: 0 24px 24px;
        }

        .moodboard-section.collapsed .moodboard-body {
            max-height: 0;
            padding: 0 24px;
        }

        /* Beautiful Mosaic Grid */
        .moodboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-auto-rows: 80px;
            gap: 8px;
        }

        .moodboard-item {
            background: var(--bg-dark);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            grid-column: span 3;
            grid-row: span 2;
        }

        /* Mosaic pattern - varying sizes */
        .moodboard-item:nth-child(5n+1) {
            grid-column: span 4;
            grid-row: span 3;
        }

        .moodboard-item:nth-child(7n+3) {
            grid-column: span 2;
            grid-row: span 2;
        }

        .moodboard-item:nth-child(11n+5) {
            grid-column: span 5;
            grid-row: span 3;
        }

        .moodboard-item:hover {
            transform: scale(1.03);
            z-index: 10;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .moodboard-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s;
        }

        .moodboard-item:hover img {
            transform: scale(1.1);
        }

        .moodboard-item .remove-moodboard {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .moodboard-item:hover .remove-moodboard {
            opacity: 1;
        }

        .moodboard-item .remove-moodboard:hover {
            background: rgba(255, 59, 59, 0.9);
            transform: scale(1.1);
        }

        .moodboard-add {
            background: transparent;
            border: 2px dashed var(--border);
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            grid-column: span 3;
            grid-row: span 2;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
        }

        .moodboard-add:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .moodboard-add-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .moodboard-add-text {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* Moodboard add options */
        .moodboard-add-options {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .moodboard-add-option {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .moodboard-add-option:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Moodboard link items */
        .moodboard-item.link-item {
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 120px;
            transition: all 0.2s;
        }

        .moodboard-item.link-item:hover {
            border-color: var(--accent);
        }

        .moodboard-link-favicon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            margin-bottom: 12px;
            background: var(--border);
        }

        .moodboard-link-title {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .moodboard-link-url {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .moodboard-link-open {
            position: absolute;
            bottom: 12px;
            right: 12px;
            font-size: 14px;
            color: var(--text-secondary);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .moodboard-item.link-item:hover .moodboard-link-open {
            opacity: 1;
        }

        /* Add Reference Modal */
        .add-reference-modal .modal-options {
            display: flex;
            gap: 16px;
            margin: 24px 0;
        }

        .add-reference-modal .modal-option {
            flex: 1;
            padding: 24px;
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .add-reference-modal .modal-option:hover {
            border-color: var(--accent);
        }

        .add-reference-modal .modal-option-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .add-reference-modal .modal-option-label {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-primary);
        }

        .add-reference-modal .link-input-section {
            display: none;
            margin-top: 24px;
        }

        .add-reference-modal .link-input-section.show {
            display: block;
        }

        .add-reference-modal .link-input-row {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .add-reference-modal .link-input-row input {
            width: 100%;
            padding: 12px 16px;
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
            font-size: 12px;
        }

        .add-reference-modal .link-input-row input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .add-reference-modal .link-input-row input::placeholder {
            color: var(--text-secondary);
        }

        /* ==========================================
           REFERENCE FINDER (Eyecannndy Integration)
           ========================================== */
        .find-reference-btn {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 2px;
            transition: all 0.2s;
            margin-top: 12px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .find-reference-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .find-reference-btn .icon {
            font-size: 12px;
        }

        .reference-finder-modal .modal {
            max-width: 1200px;
            width: 95vw;
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .reference-finder-modal .modal h3 {
            margin-bottom: 8px;
        }

        .reference-finder-subtitle {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .reference-finder-subtitle a {
            color: var(--accent);
            text-decoration: none;
        }

        .reference-finder-subtitle a:hover {
            text-decoration: underline;
        }

        .technique-search {
            width: 100%;
            padding: 12px 16px;
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            margin-bottom: 20px;
        }

        .technique-search:focus {
            outline: none;
            border-color: var(--accent);
        }

        .technique-search::placeholder {
            color: var(--text-secondary);
        }

        .technique-categories {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .technique-category {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 20px;
            transition: all 0.2s;
        }

        .technique-category:hover,
        .technique-category.active {
            border-color: var(--accent);
            color: var(--accent);
        }

        .reference-finder-content {
            display: flex;
            gap: 20px;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        .techniques-grid {
            width: 320px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .technique-preview-panel {
            flex: 1;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .technique-preview-placeholder {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            text-align: center;
            padding: 40px;
        }

        .preview-placeholder-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .preview-placeholder-text {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            line-height: 1.6;
        }

        .technique-preview-panel iframe {
            width: 100%;
            height: 100%;
            display: none;
            background: #fff;
        }

        .technique-preview-panel.has-content .technique-preview-placeholder {
            display: none;
        }

        .technique-preview-panel.has-content iframe {
            display: block;
        }

        .technique-card {
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .technique-card:hover {
            border-color: var(--accent);
        }

        .technique-card.selected {
            border-color: var(--accent);
            background: rgba(255, 107, 0, 0.1);
        }

        .technique-card-body {
            padding: 12px;
        }

        .technique-card-name {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .technique-card-desc {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .technique-card-link {
            display: inline-block;
            margin-top: 8px;
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            color: var(--accent);
            text-decoration: none;
        }

        .technique-card-link:hover {
            text-decoration: underline;
        }

        .reference-finder-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .selected-technique-preview {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--text-secondary);
        }

        .selected-technique-preview strong {
            color: var(--accent);
        }

        /* Frame technique tags */
        .frame-techniques {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 12px;
        }

        .technique-tag {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            padding: 4px 10px;
            background: rgba(255, 107, 0, 0.15);
            border: 1px solid var(--accent);
            color: var(--accent);
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .technique-tag:hover {
            background: rgba(255, 107, 0, 0.25);
        }

        .technique-tag .remove-tag {
            font-size: 12px;
            opacity: 0.7;
            cursor: pointer;
        }

        .technique-tag .remove-tag:hover {
            opacity: 1;
        }

        /* ==========================================
           TIMELINE VIEW
           ========================================== */
        .timeline-toggle {
            margin-left: 8px;
        }

        .timeline-view {
            display: none;
            overflow-x: auto;
            padding: 40px 0;
            margin-bottom: 40px;
        }

        .timeline-view.active {
            display: block;
        }

        .timeline-track {
            display: flex;
            gap: 4px;
            min-width: max-content;
            padding: 0 48px;
        }

        .timeline-frame {
            width: 200px;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .timeline-frame:hover {
            transform: translateY(-4px);
        }

        .timeline-thumbnail {
            aspect-ratio: 16/9;
            background: var(--frame-bg);
            border: 2px solid var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .timeline-frame:hover .timeline-thumbnail {
            border-color: var(--accent);
        }

        .timeline-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .timeline-thumbnail-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--text-secondary);
        }

        .timeline-info {
            text-align: center;
        }

        .timeline-number {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--accent);
            margin-bottom: 4px;
        }

        .timeline-label {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .timeline-time {
            height: 40px;
            border-left: 1px solid var(--border);
            margin: 8px auto 0;
            width: 1px;
            position: relative;
        }

        .timeline-time::after {
            content: attr(data-time);
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        /* ==========================================
           FOCUS MODE
           ========================================== */
        body.focus-mode .tab-nav,
        body.focus-mode .cloud-bar,
        body.focus-mode .header,
        body.focus-mode .concept-section,
        body.focus-mode .moodboard-section,
        body.focus-mode .section-label,
        body.focus-mode .footer,
        body.focus-mode .add-frame-btn,
        body.focus-mode .view-toggle {
            opacity: 0.1;
            pointer-events: none;
            transition: opacity 0.4s;
        }

        body.focus-mode .frame {
            opacity: 0.15;
            transform: scale(0.98);
            transition: all 0.4s;
        }

        body.focus-mode .frame.focused {
            opacity: 1;
            transform: scale(1);
            box-shadow: 0 0 100px rgba(255, 107, 0, 0.1);
        }

        body.focus-mode .frame:hover {
            opacity: 1;
            transform: scale(1);
        }

        .focus-mode-indicator {
            position: fixed;
            top: 50%;
            left: 24px;
            transform: translateY(-50%);
            z-index: 1000;
            display: none;
        }

        body.focus-mode .focus-mode-indicator {
            display: block;
        }

        .focus-mode-indicator button {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding: 16px 8px;
            background: var(--accent);
            border: none;
            color: var(--bg-dark);
            cursor: pointer;
            border-radius: 4px;
        }

        /* ==========================================
           HOMEPAGE / DASHBOARD
           ========================================== */
        .homepage {
            display: none;
            min-height: 100vh;
            padding: 120px 48px 80px;
        }

        .homepage.active {
            display: block;
        }

        .homepage-header {
            margin-bottom: 60px;
        }

        .homepage-title {
            font-family: 'Instrument Serif', serif;
            font-size: 64px;
            font-weight: 400;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .homepage-subtitle {
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            color: var(--text-secondary);
            letter-spacing: 1px;
        }

        .briefs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 24px;
        }

        .brief-card {
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .brief-card:hover {
            border-color: var(--accent);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .brief-card-thumbnail {
            aspect-ratio: 16/9;
            background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%);
            position: relative;
            overflow: hidden;
        }

        .brief-card-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.8;
            transition: all 0.4s;
        }

        .brief-card:hover .brief-card-thumbnail img {
            opacity: 1;
            transform: scale(1.05);
        }

        .brief-card-frames {
            position: absolute;
            bottom: 12px;
            left: 12px;
            display: flex;
            gap: 4px;
        }

        .brief-card-frame-dot {
            width: 8px;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
        }

        .brief-card-frame-dot.has-image {
            background: var(--accent);
        }

        .brief-card-status {
            position: absolute;
            top: 12px;
            right: 12px;
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 4px 10px;
            background: rgba(255, 107, 0, 0.9);
            color: var(--bg-dark);
            border-radius: 4px;
        }

        .brief-card-body {
            padding: 20px;
        }

        .brief-card-client {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .brief-card-title {
            font-family: 'Instrument Serif', serif;
            font-size: 24px;
            font-weight: 400;
            margin-bottom: 12px;
            line-height: 1.2;
        }

        .brief-card-meta {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .brief-card-new {
            border-style: dashed;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 280px;
        }

        .brief-card-new:hover {
            border-color: var(--accent);
            background: rgba(255, 107, 0, 0.03);
        }

        .brief-card-new-content {
            text-align: center;
        }

        .brief-card-new-icon {
            font-size: 48px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .brief-card-new-text {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-secondary);
        }

        /* Home button in nav */
        .home-btn {
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            padding: 20px 24px;
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            border-right: 1px solid var(--border);
            transition: background 0.2s;
        }

        .home-btn:hover {
            background: rgba(255, 107, 0, 0.1);
        }

        /* ==========================================
           TEMPLATE LIBRARY MODAL
           ========================================== */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .template-card {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .template-card:hover {
            border-color: var(--accent);
        }

        .template-card.selected {
            border-color: var(--accent);
            background: rgba(255, 107, 0, 0.1);
        }

        .template-card h4 {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .template-card p {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .template-frames {
            margin-top: 12px;
            display: flex;
            gap: 4px;
        }

        .template-frame-dot {
            width: 8px;
            height: 8px;
            background: var(--border);
            border-radius: 2px;
        }

        /* ==========================================
           FRAME TEMPLATES DROPDOWN
           ========================================== */
        .frame-template-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 8px 0;
            z-index: 1000;
            min-width: 200px;
            display: none;
        }

        .frame-template-dropdown.show {
            display: block;
        }

        .frame-template-option {
            padding: 10px 16px;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .frame-template-option:hover {
            background: rgba(255, 107, 0, 0.1);
            color: var(--accent);
        }

        .frame-template-option small {
            display: block;
            font-size: 9px;
            margin-top: 4px;
            opacity: 0.7;
        }

        /* ==========================================
           VERSION HISTORY
           ========================================== */
        .version-history {
            position: fixed;
            top: 60px;
            right: 0;
            width: 320px;
            height: calc(100vh - 120px);
            background: var(--frame-bg);
            border-left: 1px solid var(--border);
            z-index: 150;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .version-history.open {
            transform: translateX(0);
        }

        .version-history-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .version-history-header h3 {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent);
        }

        .version-history-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
        }

        .version-history-close:hover {
            color: var(--text-primary);
        }

        .version-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .version-item {
            padding: 16px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 4px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .version-item:hover {
            border-color: var(--accent);
        }

        .version-item.current {
            border-color: var(--accent);
            background: rgba(255, 107, 0, 0.1);
        }

        .version-time {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--accent);
            margin-bottom: 4px;
        }

        .version-label {
            font-size: 12px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .version-changes {
            font-size: 10px;
            color: var(--text-secondary);
        }

        .version-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .version-btn {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 2px;
        }

        .version-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Toolbar additions */
        .toolbar {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .toolbar-btn {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 8px 12px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 2px;
            transition: all 0.2s;
        }

        .toolbar-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .toolbar-divider {
            width: 1px;
            height: 20px;
            background: var(--border);
            margin: 0 8px;
        }

        /* ==========================================
           AI IMAGE GENERATION PANEL
           ========================================== */
        .ai-generate-btn {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 8px 16px;
            background: linear-gradient(135deg, #FF6B00 0%, #FF8C33 100%);
            border: none;
            color: var(--bg-dark);
            cursor: pointer;
            border-radius: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
            opacity: 0;
            transition: all 0.3s;
            z-index: 15;
            box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
        }

        .frame-visual:hover .ai-generate-btn {
            opacity: 1;
        }

        .ai-generate-btn:hover {
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 107, 0, 0.4);
        }

        .ai-generate-btn .sparkle {
            font-size: 12px;
        }

        /* AI Generation Panel */
        .ai-panel {
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-top: 16px;
            overflow: hidden;
            display: none;
        }

        .ai-panel.open {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .ai-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: rgba(255, 107, 0, 0.05);
            border-bottom: 1px solid var(--border);
        }

        .ai-panel-title {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-panel-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 16px;
            cursor: pointer;
            padding: 4px;
        }

        .ai-panel-close:hover {
            color: var(--text-primary);
        }

        .ai-panel-body {
            padding: 16px;
        }

        /* Model Selector */
        .ai-model-selector {
            margin-bottom: 16px;
        }

        .ai-model-label {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }

        .ai-model-options {
            display: flex;
            gap: 8px;
        }

        .ai-model-option {
            flex: 1;
            padding: 12px;
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .ai-model-option:hover {
            border-color: var(--text-secondary);
        }

        .ai-model-option.selected {
            border-color: var(--accent);
            background: rgba(255, 107, 0, 0.1);
        }

        .ai-model-option .model-name {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .ai-model-option .model-desc {
            font-size: 9px;
            color: var(--text-secondary);
        }

        /* Reference Images */
        .ai-references {
            margin-bottom: 16px;
        }

        .ai-references-label {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-references-count {
            color: var(--accent);
        }

        .ai-references-grid {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .ai-reference-item {
            width: 80px;
            height: 80px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .ai-reference-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .ai-reference-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 18px;
            height: 18px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .ai-reference-item:hover .ai-reference-remove {
            opacity: 1;
        }

        .ai-reference-add {
            width: 80px;
            height: 80px;
            background: transparent;
            border: 2px dashed var(--border);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .ai-reference-add:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .ai-reference-add-icon {
            font-size: 20px;
        }

        .ai-reference-add-text {
            font-size: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Prompt Field */
        .ai-prompt {
            margin-bottom: 16px;
        }

        .ai-prompt-label {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-prompt-auto {
            font-size: 8px;
            color: var(--accent);
            cursor: pointer;
        }

        .ai-prompt-auto:hover {
            text-decoration: underline;
        }

        .ai-prompt-textarea {
            width: 100%;
            min-height: 100px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 12px;
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--text-primary);
            resize: vertical;
            line-height: 1.6;
        }

        .ai-prompt-textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .ai-prompt-textarea::placeholder {
            color: var(--text-secondary);
            opacity: 0.5;
        }

        /* Generate Button */
        .ai-generate-submit {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #FF6B00 0%, #FF8C33 100%);
            border: none;
            border-radius: 6px;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--bg-dark);
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .ai-generate-submit:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
        }

        .ai-generate-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .ai-generate-submit.loading {
            position: relative;
            color: transparent;
        }

        .ai-generate-submit.loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid var(--bg-dark);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Generation Status */
        .ai-status {
            margin-top: 12px;
            padding: 10px 12px;
            background: rgba(255, 107, 0, 0.1);
            border-radius: 4px;
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--accent);
            display: none;
        }

        .ai-status.visible {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-status-spinner {
            width: 12px;
            height: 12px;
            border: 2px solid var(--accent);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Focus Mode Toggle */
        .focus-toggle {
            position: fixed;
            bottom: 70px;
            right: 48px;
            z-index: 200;
        }

        .focus-toggle-btn {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 10px 16px;
            background: var(--frame-bg);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .focus-toggle-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .focus-toggle-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-dark);
        }

        /* Homepage active state hides main content */
        body.show-homepage .tab-content,
        body.show-homepage .tab-nav .tab-btn:not(.home-btn),
        body.show-homepage .add-tab-btn,
        body.show-homepage .view-toggle,
        body.show-homepage .focus-toggle {
            display: none !important;
        }

        body.show-homepage .homepage {
            display: block;
        }

        /* ==========================================
           SHARE MODAL
           ========================================== */
        .share-modal .modal {
            max-width: 480px;
        }

        .share-link-container {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .share-link-input {
            flex: 1;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 12px;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-primary);
        }

        .share-link-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .share-copy-btn {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 12px 20px;
            background: var(--accent);
            border: none;
            color: var(--bg-dark);
            cursor: pointer;
            border-radius: 4px;
            font-weight: 700;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .share-copy-btn:hover {
            opacity: 0.8;
        }

        .share-copy-btn.copied {
            background: #4ECDC4;
        }

        .share-options {
            border-top: 1px solid var(--border);
            padding-top: 20px;
            margin-bottom: 20px;
        }

        .share-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .share-option:last-child {
            border-bottom: none;
        }

        .share-option-label {
            font-size: 12px;
            color: var(--text-primary);
        }

        .share-option-desc {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .toggle-switch.active {
            background: var(--accent);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }

        .toggle-switch.active::after {
            transform: translateX(20px);
        }

        .share-password-field {
            margin-top: 12px;
            display: none;
        }

        .share-password-field.visible {
            display: block;
        }

        .share-password-input {
            width: 100%;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 10px 12px;
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--text-primary);
        }

        .share-password-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .share-preview-btn {
            width: 100%;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 14px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .share-preview-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Share button in header */
        .share-btn {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 8px 14px;
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .share-btn:hover {
            background: var(--accent);
            color: var(--bg-dark);
        }

        /* ==========================================
           CLIENT VIEW (SHARED BRIEF)
           ========================================== */
        body.client-view .tab-nav,
        body.client-view .cloud-bar,
        body.client-view .focus-toggle,
        body.client-view .view-toggle,
        body.client-view .brief-actions,
        body.client-view .add-frame-btn,
        body.client-view .delete-tab-btn,
        body.client-view .delete-frame-btn,
        body.client-view .ai-panel,
        body.client-view .ai-generate-btn,
        body.client-view .cd-comments,
        body.client-view .comments-section,
        body.client-view .image-url-container,
        body.client-view .add-note-btn,
        body.client-view .remove-notes-btn,
        body.client-view .delete-note,
        body.client-view .footer-right {
            display: none !important;
        }

        body.client-view [contenteditable] {
            cursor: default !important;
        }

        body.client-view [contenteditable]:hover,
        body.client-view [contenteditable]:focus {
            background: transparent !important;
            box-shadow: none !important;
        }

        body.client-view .header {
            top: 0;
        }

        body.client-view .main {
            padding-top: 160px;
        }

        body.client-view .frame-visual .upload-hint {
            display: none;
        }

        .client-view-banner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--accent) 0%, #FF8C33 100%);
            padding: 10px 48px;
            z-index: 1000;
            text-align: center;
        }

        body.client-view .client-view-banner {
            display: block;
        }

        .client-view-banner-text {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--bg-dark);
            font-weight: 700;
        }

        .client-view-exit {
            position: absolute;
            right: 48px;
            top: 50%;
            transform: translateY(-50%);
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 4px 12px;
            background: rgba(0,0,0,0.2);
            border: none;
            color: var(--bg-dark);
            cursor: pointer;
            border-radius: 2px;
        }

        .client-view-exit:hover {
            background: rgba(0,0,0,0.3);
        }

        /* Password Gate */
        .password-gate {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--bg-dark);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .password-gate.active {
            display: flex;
        }

        .password-gate-box {
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .password-gate-title {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .password-gate-brief {
            font-family: 'Instrument Serif', serif;
            font-size: 28px;
            margin-bottom: 32px;
        }

        .password-gate-input {
            width: 100%;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 14px;
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 16px;
        }

        .password-gate-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .password-gate-submit {
            width: 100%;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 14px;
            background: var(--accent);
            border: none;
            color: var(--bg-dark);
            cursor: pointer;
            border-radius: 4px;
            font-weight: 700;
        }

        .password-gate-error {
            color: #ff3b3b;
            font-size: 11px;
            margin-top: 12px;
            display: none;
        }

        .password-gate-error.visible {
            display: block;
        }

        /* ==========================================
           FRAME VARIATIONS
           ========================================== */
        .frame-variations {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .variation-tabs {
            display: flex;
            gap: 4px;
        }

        .variation-tab {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            font-weight: 700;
            padding: 6px 12px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .variation-tab:hover {
            border-color: var(--text-secondary);
        }

        .variation-tab.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-dark);
        }

        .variation-tab.selected-variation::after {
            content: ' ✓';
        }

        .variation-add {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            padding: 6px 10px;
            background: transparent;
            border: 1px dashed var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .variation-add:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .variation-actions {
            margin-left: auto;
            display: flex;
            gap: 8px;
        }

        .variation-action-btn {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            padding: 6px 10px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 2px;
            transition: all 0.2s;
        }

        .variation-action-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .variation-action-btn.select-btn:hover {
            border-color: #4ECDC4;
            color: #4ECDC4;
        }

        .variation-action-btn.delete-btn:hover {
            border-color: #ff3b3b;
            color: #ff3b3b;
        }

        /* Compare Mode */
        .compare-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            z-index: 10000;
            display: none;
            flex-direction: column;
        }

        .compare-modal.active {
            display: flex;
        }

        .compare-header {
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .compare-title {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent);
        }

        .compare-close {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 2px;
        }

        .compare-close:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .compare-body {
            flex: 1;
            display: flex;
            padding: 40px;
            gap: 40px;
        }

        .compare-side {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .compare-side-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .compare-side-label {
            font-family: 'Space Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
        }

        .compare-side-select {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 8px 16px;
            background: transparent;
            border: 1px solid #4ECDC4;
            color: #4ECDC4;
            cursor: pointer;
            border-radius: 4px;
        }

        .compare-side-select:hover {
            background: #4ECDC4;
            color: var(--bg-dark);
        }

        .compare-image {
            flex: 1;
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .compare-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .compare-placeholder {
            font-family: 'Instrument Serif', serif;
            font-size: 18px;
            font-style: italic;
            color: var(--text-secondary);
            text-align: center;
            padding: 40px;
        }

        .compare-divider {
            width: 1px;
            background: var(--border);
        }

        /* ==========================================
           EXECUTIONS (Sub-tabs within briefs)
           ========================================== */
        .executions-bar {
            padding: 14px 48px;
            background: rgba(18, 18, 18, 1);
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            margin-bottom: 40px;
        }

        .executions-nav {
            display: flex;
            align-items: center;
            gap: 6px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .executions-label {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-right: 8px;
        }

        .execution-tab {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 6px 14px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            position: relative;
        }

        .execution-tab:hover {
            border-color: var(--text-secondary);
            color: var(--text-primary);
        }

        .execution-tab.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-dark);
        }

        .execution-tab .frame-count {
            font-size: 9px;
            opacity: 0.7;
        }

        /* Right-click or hover menu for execution actions */
        .execution-tab .execution-menu-trigger {
            margin-left: 4px;
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 10px;
        }

        .execution-tab:hover .execution-menu-trigger {
            opacity: 0.6;
        }

        .execution-tab:hover .execution-menu-trigger:hover {
            opacity: 1;
        }

        .execution-menu {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 4px;
            background: var(--frame-bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 4px 0;
            min-width: 120px;
            display: none;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .execution-menu.show {
            display: block;
        }

        .execution-menu-item {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            padding: 8px 12px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
        }

        .execution-menu-item:hover {
            background: rgba(255,255,255,0.05);
            color: var(--text-primary);
        }

        .execution-menu-item.danger:hover {
            color: #ff3b3b;
        }

        .execution-add {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            padding: 6px 10px;
            background: transparent;
            border: 1px dashed var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .execution-add:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Execution Modal */
        .execution-modal .modal {
            max-width: 400px;
        }

        .execution-presets {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .execution-preset {
            padding: 12px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .execution-preset:hover {
            border-color: var(--text-secondary);
        }

        .execution-preset.selected {
            border-color: var(--accent);
            background: rgba(255, 107, 0, 0.1);
        }

        .execution-preset-name {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .execution-preset-desc {
            font-size: 10px;
            color: var(--text-secondary);
        }

        .execution-custom {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .execution-custom-label {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }

        .execution-custom-input {
            width: 100%;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 10px 12px;
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--text-primary);
        }

        .execution-custom-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* Storyboard section label with execution name */
        .storyboard-section .section-label .execution-name {
            color: var(--accent);
        }
    </style>
</head>
<body>
    <div class="scanlines"></div>

    <!-- Client View Banner -->
    <div class="client-view-banner">
        <span class="client-view-banner-text">Viewing Shared Brief</span>
        <button class="client-view-exit" onclick="exitClientView()">Exit Preview</button>
    </div>

    <!-- Password Gate -->
    <div class="password-gate" id="passwordGate">
        <div class="password-gate-box">
            <div class="password-gate-title">Protected Brief</div>
            <div class="password-gate-brief" id="passwordGateBrief">Campaign Title</div>
            <input type="password" class="password-gate-input" id="passwordGateInput" placeholder="Enter password">
            <button class="password-gate-submit" onclick="submitPassword()">View Brief</button>
            <div class="password-gate-error" id="passwordGateError">Incorrect password</div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal-overlay share-modal" id="shareModal">
        <div class="modal">
            <h3>Share Brief</h3>
            <div class="share-link-container">
                <input type="text" class="share-link-input" id="shareLinkInput" readonly>
                <button class="share-copy-btn" id="shareCopyBtn" onclick="copyShareLink()">Copy</button>
            </div>
            <div class="share-options">
                <div class="share-option">
                    <div>
                        <div class="share-option-label">Password Protection</div>
                        <div class="share-option-desc">Require password to view</div>
                    </div>
                    <div class="toggle-switch" id="sharePasswordToggle" onclick="toggleSharePassword()"></div>
                </div>
                <div class="share-password-field" id="sharePasswordField">
                    <input type="text" class="share-password-input" id="sharePasswordInput" placeholder="Enter password">
                </div>
                <div class="share-option">
                    <div>
                        <div class="share-option-label">Show Comments</div>
                        <div class="share-option-desc">Include CD comments in shared view</div>
                    </div>
                    <div class="toggle-switch" id="shareCommentsToggle" onclick="toggleShareComments()"></div>
                </div>
            </div>
            <button class="share-preview-btn" onclick="previewClientView()">
                <span>👁</span> Preview Client View
            </button>
            <div class="modal-btns" style="margin-top: 16px;">
                <button class="modal-btn secondary" onclick="hideShareModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Add Reference Modal -->
    <div class="modal-overlay add-reference-modal" id="addReferenceModal">
        <div class="modal">
            <h3>Add Reference</h3>
            <div class="modal-options" id="referenceOptions">
                <div class="modal-option" onclick="selectReferenceType('image')">
                    <div class="modal-option-icon">🖼</div>
                    <div class="modal-option-label">Upload Image</div>
                </div>
                <div class="modal-option" onclick="selectReferenceType('link')">
                    <div class="modal-option-icon">🔗</div>
                    <div class="modal-option-label">Add Link</div>
                </div>
            </div>
            <div class="link-input-section" id="linkInputSection">
                <div class="link-input-row">
                    <input type="text" id="referenceLinkUrl" placeholder="Paste URL (e.g., https://vimeo.com/...)">
                    <input type="text" id="referenceLinkTitle" placeholder="Title (optional)">
                </div>
                <div class="modal-btns" style="margin-top: 16px;">
                    <button class="modal-btn secondary" onclick="hideAddReferenceModal()">Cancel</button>
                    <button class="modal-btn primary" onclick="addLinkReference()">Add Link</button>
                </div>
            </div>
            <div class="modal-btns" id="referenceModalClose">
                <button class="modal-btn secondary" onclick="hideAddReferenceModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Reference Finder Modal -->
    <div class="modal-overlay reference-finder-modal" id="referenceFinderModal">
        <div class="modal">
            <h3>Find Visual Reference</h3>
            <p class="reference-finder-subtitle">Browse techniques from <a href="https://eyecannndy.com" target="_blank">Eyecannndy</a> — click to view examples, then attach to your frame</p>

            <input type="text" class="technique-search" id="techniqueSearch" placeholder="Search techniques..." oninput="filterTechniques()">

            <div class="technique-categories" id="techniqueCategories">
                <button class="technique-category active" data-category="all" onclick="filterByCategory('all')">All</button>
                <button class="technique-category" data-category="camera" onclick="filterByCategory('camera')">Camera</button>
                <button class="technique-category" data-category="motion" onclick="filterByCategory('motion')">Motion</button>
                <button class="technique-category" data-category="transition" onclick="filterByCategory('transition')">Transition</button>
                <button class="technique-category" data-category="style" onclick="filterByCategory('style')">Style</button>
                <button class="technique-category" data-category="effect" onclick="filterByCategory('effect')">Effect</button>
            </div>

            <div class="reference-finder-content">
                <div class="techniques-grid" id="techniquesGrid">
                    <!-- Populated by JS -->
                </div>
                <div class="technique-preview-panel" id="techniquePreviewPanel">
                    <div class="technique-preview-placeholder">
                        <div class="preview-placeholder-icon">👈</div>
                        <div class="preview-placeholder-text">Select a technique to preview examples from Eyecannndy</div>
                    </div>
                    <iframe id="techniquePreviewIframe" src="" frameborder="0"></iframe>
                </div>
            </div>

            <div class="reference-finder-actions">
                <div class="selected-technique-preview" id="selectedTechniquePreview">
                    No technique selected
                </div>
                <div>
                    <button class="modal-btn secondary" onclick="hideReferenceFinder()">Cancel</button>
                    <button class="modal-btn primary" id="attachTechniqueBtn" onclick="attachSelectedTechnique()" disabled>Attach to Frame</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Compare Modal -->
    <div class="compare-modal" id="compareModal">
        <div class="compare-header">
            <div class="compare-title">Compare Variations</div>
            <button class="compare-close" onclick="closeCompare()">Close</button>
        </div>
        <div class="compare-body">
            <div class="compare-side">
                <div class="compare-side-header">
                    <span class="compare-side-label" id="compareLeftLabel">A</span>
                    <button class="compare-side-select" onclick="selectCompareVariation('left')">Select This</button>
                </div>
                <div class="compare-image" id="compareLeftImage">
                    <div class="compare-placeholder">Variation A</div>
                </div>
            </div>
            <div class="compare-divider"></div>
            <div class="compare-side">
                <div class="compare-side-header">
                    <span class="compare-side-label" id="compareRightLabel">B</span>
                    <button class="compare-side-select" onclick="selectCompareVariation('right')">Select This</button>
                </div>
                <div class="compare-image" id="compareRightImage">
                    <div class="compare-placeholder">Variation B</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Execution Modal -->
    <div class="modal-overlay execution-modal" id="executionModal">
        <div class="modal">
            <h3>Add Execution</h3>
            <div class="execution-presets" id="executionPresets">
                <div class="execution-preset" data-preset=":60" onclick="selectExecutionPreset(':60', this)">
                    <div class="execution-preset-name">:60</div>
                    <div class="execution-preset-desc">Hero film</div>
                </div>
                <div class="execution-preset" data-preset=":45" onclick="selectExecutionPreset(':45', this)">
                    <div class="execution-preset-name">:45</div>
                    <div class="execution-preset-desc">Standard spot</div>
                </div>
                <div class="execution-preset" data-preset=":30" onclick="selectExecutionPreset(':30', this)">
                    <div class="execution-preset-name">:30</div>
                    <div class="execution-preset-desc">Cutdown</div>
                </div>
                <div class="execution-preset" data-preset=":15" onclick="selectExecutionPreset(':15', this)">
                    <div class="execution-preset-name">:15</div>
                    <div class="execution-preset-desc">Social short</div>
                </div>
                <div class="execution-preset" data-preset=":06" onclick="selectExecutionPreset(':06', this)">
                    <div class="execution-preset-name">:06</div>
                    <div class="execution-preset-desc">Bumper</div>
                </div>
                <div class="execution-preset" data-preset="Social" onclick="selectExecutionPreset('Social', this)">
                    <div class="execution-preset-name">Social</div>
                    <div class="execution-preset-desc">9:16 format</div>
                </div>
            </div>
            <div class="execution-custom">
                <label class="execution-custom-label">Or enter custom name</label>
                <input type="text" class="execution-custom-input" id="executionCustomInput" placeholder="e.g., TikTok, OOH, Pre-roll">
            </div>
            <div class="modal-btns" style="margin-top: 20px;">
                <button class="modal-btn secondary" onclick="hideExecutionModal()">Cancel</button>
                <button class="modal-btn primary" onclick="createExecution()">Add Execution</button>
            </div>
        </div>
    </div>

    <!-- Homepage / Dashboard -->
    <div class="homepage" id="homepage">
        <div class="homepage-header">
            <h1 class="homepage-title">Storyboards</h1>
            <p class="homepage-subtitle">All your creative briefs in one place</p>
        </div>
        <div class="briefs-grid" id="briefsGrid">
            <!-- Populated by JS -->
        </div>
    </div>

    <!-- Focus Mode Toggle -->
    <div class="focus-toggle">
        <button class="focus-toggle-btn" onclick="toggleFocusMode()">
            <span>◎</span> Focus
        </button>
    </div>

    <!-- Tab Navigation -->
    <nav class="tab-nav" id="tabNav">
        <button class="home-btn" onclick="showHomepage()" title="All Briefs">⌂</button>
        <button class="tab-btn active" data-tab="grok">Grok <span class="status-container"></span></button>
        <button class="tab-btn" data-tab="replit">Replit <span class="status-container"><span class="wip-badge">WIP<span class="remove-badge" onclick="removeStatus(event, 'replit')">×</span></span></span></button>
        <button class="tab-btn" data-tab="ryanair">Ryanair <span class="status-container"></span></button>
        <button class="tab-btn" data-tab="reddit">Reddit <span class="status-container"></span></button>
        <button class="add-tab-btn" onclick="showNewBriefModal()" title="Add new brief">+</button>
    </nav>

    <!-- Modal for new brief -->
    <div class="modal-overlay" id="newBriefModal">
        <div class="modal">
            <h3>New Brief</h3>
            <input type="text" id="newBriefClient" placeholder="Client name (e.g., Nike)">
            <input type="text" id="newBriefTitle" placeholder="Campaign title (e.g., JUST DO IT)">
            <div class="modal-btns">
                <button class="modal-btn secondary" onclick="hideNewBriefModal()">Cancel</button>
                <button class="modal-btn primary" onclick="createNewBrief()">Create</button>
            </div>
        </div>
    </div>


    <!-- Presentation Mode -->
    <div class="presentation-mode" id="presentationMode">
        <div class="presentation-header">
            <div class="presentation-title" id="presentationTitle">STORYBOARD</div>
            <div class="presentation-counter" id="presentationCounter">1 / 8</div>
            <button class="presentation-close" onclick="exitPresentation()">ESC to Exit</button>
        </div>
        <div class="presentation-arrows prev" onclick="prevSlide()">‹</div>
        <div class="presentation-frame" id="presentationFrame"></div>
        <div class="presentation-arrows next" onclick="nextSlide()">›</div>
        <div class="presentation-nav" id="presentationNav"></div>
    </div>

    <!-- Version History Panel -->
    <div class="version-history" id="versionHistory">
        <div class="version-history-header">
            <h3>Version History</h3>
            <button class="version-history-close" onclick="toggleVersionHistory()">×</button>
        </div>
        <div class="version-list" id="versionList">
            <!-- Versions populated by JS -->
        </div>
    </div>

    <!-- Template Library Modal -->
    <div class="modal-overlay" id="templateModal">
        <div class="modal" style="max-width: 500px;">
            <h3>Choose Template</h3>
            <div class="template-grid">
                <div class="template-card" onclick="selectTemplate('30-sec')">
                    <h4>:30 Spot</h4>
                    <p>Quick-hit digital ad. Hook → Build → Payoff.</p>
                    <div class="template-frames">
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                    </div>
                </div>
                <div class="template-card" onclick="selectTemplate('60-sec')">
                    <h4>:60 Spot</h4>
                    <p>Full story arc. Setup → Escalation → Climax → Resolve.</p>
                    <div class="template-frames">
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                    </div>
                </div>
                <div class="template-card" onclick="selectTemplate('social')">
                    <h4>Social Cutdown</h4>
                    <p>Punchy 15-sec format. Instant hook required.</p>
                    <div class="template-frames">
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                    </div>
                </div>
                <div class="template-card" onclick="selectTemplate('manifesto')">
                    <h4>Brand Manifesto</h4>
                    <p>Emotional journey. Voice-over driven.</p>
                    <div class="template-frames">
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                        <div class="template-frame-dot"></div>
                    </div>
                </div>
            </div>
            <div class="modal-btns" style="margin-top: 20px;">
                <button class="modal-btn secondary" onclick="hideTemplateModal()">Cancel</button>
                <button class="modal-btn primary" onclick="applyTemplate()">Apply Template</button>
            </div>
        </div>
    </div>

    <!-- GROK TAB -->
    <div class="tab-content active" id="grok">
        <div class="progress-bar" id="progressBar"></div>

        <header class="header">
            <div class="header-content">
                <div class="project-info">
                    <h1>Spec Campaign Storyboard</h1>
                    <div class="project-title" contenteditable="true" data-editable-id="grok-title">911 FOR THE TRUTH</div>
                    <div class="brief-actions">
                        <button class="share-btn" onclick="showShareModal('grok')"><span>↗</span> Share</button>
                        <button class="brief-action-btn archive" onclick="archiveBrief('grok')">Archive</button>
                        <button class="brief-action-btn danger" onclick="deleteBrief('grok')">Delete</button>
                    </div>
                </div>
                <div class="meta">
                    CLIENT: <span contenteditable="true" data-editable-id="grok-client">X / Grok</span><br>
                    FORMAT: <span contenteditable="true" data-editable-id="grok-format">:45 Digital/Social</span><br>
                    VERSION: <span contenteditable="true" data-editable-id="grok-version">Draft 1.0</span><br>
                    DATE: <span contenteditable="true" data-editable-id="grok-date">January 2026</span>
                </div>
            </div>
        </header>

        <nav class="frame-counter" id="frameCounter"></nav>

        <!-- Executions Bar -->
        <div class="executions-bar">
            <div class="executions-nav" data-executions-for="grok">
                <span class="executions-label">Executions</span>
                <button class="execution-tab active" data-execution="grok-main" onclick="switchExecution('grok', 'main')">
                    :45 <span class="frame-count">(8)</span>
                    <span class="execution-menu-trigger" onclick="event.stopPropagation(); toggleExecutionMenu(this)">▾</span>
                    <div class="execution-menu">
                        <div class="execution-menu-item" onclick="renameExecution('grok')">Rename</div>
                        <div class="execution-menu-item" onclick="duplicateExecution('grok')">Duplicate</div>
                        <div class="execution-menu-item danger" onclick="deleteExecution('grok')">Delete</div>
                    </div>
                </button>
                <button class="execution-add" onclick="showExecutionModal('grok')" title="Add execution">+</button>
            </div>
        </div>

        <main class="main">
            <section class="concept-section">
                <div class="section-label">Creative Brief</div>
                <div class="concept-grid">
                    <div class="concept-item">
                        <h3>Insight</h3>
                        <p>AI broke reality. Deepfakes, synthetic media, and AI-generated content have made it impossible to trust what we see. Only Grok offers real-time verification—people on X @grok to determine if something is real or fake.</p>
                    </div>
                    <div class="concept-item">
                        <h3>Idea</h3>
                        <p>Grok is 911 for the truth. In a world where your eyes lie, there's one emergency line to call. When reality itself is under attack, Grok is the first responder.</p>
                    </div>
                    <div class="concept-item">
                        <h3>Tone</h3>
                        <p>Overwhelming chaos → Paralysis → Relief. The ad should feel like drowning in information, then finally gasping for air. Urgent, cinematic, ultimately empowering.</p>
                    </div>
                </div>
            </section>

            <!-- Moodboard Section - Collapsible -->
            <section class="moodboard-section" data-moodboard-section="grok">
                <div class="moodboard-header" onclick="toggleMoodboard(this)">
                    <div class="moodboard-header-left">
                        <span class="moodboard-toggle">▼</span>
                        <div class="moodboard-title-group">
                            <span class="moodboard-title" contenteditable="true" onclick="event.stopPropagation()">Moodboard</span>
                            <span class="moodboard-ai-summary" data-summary-for="grok">Cinematic chaos, digital dystopia, overwhelming information warfare</span>
                        </div>
                    </div>
                    <span class="moodboard-count" data-count-for="grok">0 images</span>
                </div>
                <div class="moodboard-body">
                    <div class="moodboard-grid" data-moodboard-id="grok">
                        <div class="moodboard-add" onclick="addMoodboardImage('grok')">
                            <div class="moodboard-add-icon">+</div>
                            <div class="moodboard-add-text">Add Reference</div>
                            <input type="file" class="moodboard-file-input" accept="image/*" style="display:none">
                        </div>
                    </div>
                </div>
            </section>

            <section class="storyboard-section">
                <div class="section-label">Storyboard — :45</div>

                <div class="frames-container">

                    <!-- FRAME 1: CHAOS 1 - HELICOPTER CRASH -->
                    <div class="frame chaos" data-frame="1" data-tab="grok">
                        <div class="frame-visual" data-frame-id="grok-1">
                            <span class="frame-number">01</span>
                            <span class="frame-timing">0:00 – 0:04</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    Phone footage: Helicopter spiraling down over a city skyline.<br><br>
                                    Impact. Fireball. Screaming. "Holy shit holy shit holy shit."
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">AI Chaos</span>
                            <h2 class="frame-title">THE CRASH</h2>
                            <button class="find-reference-btn" onclick="showReferenceFinder('grok-1')" style="display: inline-flex; background: #FF6B00; color: white; padding: 8px 14px; margin: 10px 0; border: none; cursor: pointer; font-family: 'Space Mono', monospace; font-size: 9px; letter-spacing: 1px; text-transform: uppercase; border-radius: 2px; align-items: center; gap: 6px;">🎬 Find Reference</button>
                            <p class="frame-description">We open cold. No context. Vertical phone footage—someone filming the sky, then chaos. A helicopter loses control, spirals, impacts. The footage is shaky, raw, visceral. The person filming is panicking. Comments flooding: "Is this real??" / "Where is this??" / "Oh my god." It looks completely authentic.</p>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="grok-1" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('grok-1')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('grok-1')">Clear</button>
                            </div>
                            <div class="comments-section collapsed" data-comments-for="grok-1">
                                <div class="comments-header" onclick="toggleComments(this)">
                                    <span class="comments-toggle">▼</span>
                                    <span>Comments</span>
                                </div>
                                <div class="comments-body">
                                    <div class="comments-thread" data-thread-id="grok-1"></div>
                                    <div class="comment-input-row">
                                        <input type="text" class="comment-input" placeholder="Add comment..." onkeydown="if(event.key==='Enter')postComment('grok-1', this)">
                                        <button class="comment-submit" onclick="postComment('grok-1', this.previousElementSibling)">Post</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 2: CHAOS 2 - TBD -->
                    <div class="frame chaos" data-frame="2" data-tab="grok">
                        <div class="frame-visual" data-frame-id="grok-2">
                            <span class="frame-number">02</span>
                            <span class="frame-timing">0:04 – 0:08</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    CELEBRITY CHAOS
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">AI Chaos</span>
                            <h2 class="frame-title">CELEBRITY CHAOS</h2>
                            <p class="frame-description">The scroll continues. Celebrity chaos—impossible meetings, leaked photos, cultural collision. The viewer barely has time to process the helicopter before being hit with this. Use mixed media throughout: videos, photos, text posts, screenshots.</p>
                            <div class="frame-notes">
                                <strong>Content Examples</strong>
                                <ul>
                                    <li>MrBeast joining a Salvadoran gang</li>
                                    <li>Kim K meeting Kim Jong Un</li>
                                    <li>"Stolen photo" of Charlie Kirk and Tupac drinking cocktails</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="grok-2" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('grok-2')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('grok-2')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="grok-2" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 3: CHAOS 3 - TBD -->
                    <div class="frame chaos" data-frame="3" data-tab="grok">
                        <div class="frame-visual" data-frame-id="grok-3">
                            <span class="frame-number">03</span>
                            <span class="frame-timing">0:08 – 0:12</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    POLITICAL SHOCKWAVES
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">AI Chaos</span>
                            <h2 class="frame-title">POLITICAL SHOCKWAVES</h2>
                            <p class="frame-description">Scale increases. This should feel like it affects everyone—political, national, systemic. The "this changes everything" moment. Use mixed media throughout: videos, photos, text posts, screenshots.</p>
                            <div class="frame-notes">
                                <strong>Content Examples</strong>
                                <ul>
                                    <li>India invading Greenland</li>
                                    <li>XRP becomes official currency of Brazil</li>
                                    <li>First brothel set to open in Saudi Arabia</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="grok-3" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('grok-3')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('grok-3')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="grok-3" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 4: CHAOS 4 - TBD -->
                    <div class="frame chaos" data-frame="4" data-tab="grok">
                        <div class="frame-visual" data-frame-id="grok-4">
                            <span class="frame-number">04</span>
                            <span class="frame-timing">0:12 – 0:16</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    GLOBAL CATASTROPHE
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">AI Chaos</span>
                            <h2 class="frame-title">GLOBAL CATASTROPHE</h2>
                            <p class="frame-description">Global scale. The kind of footage that makes you call your family. "We're all going to die" energy. Use mixed media throughout: videos, photos, text posts, screenshots.</p>
                            <div class="frame-notes">
                                <strong>Content Examples</strong>
                                <ul>
                                    <li>Meteor lands at Lakers game</li>
                                    <li>Orcas sink cruise ship</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="grok-4" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('grok-4')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('grok-4')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="grok-4" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 5: CHAOS 5 - TBD -->
                    <div class="frame chaos" data-frame="5" data-tab="grok">
                        <div class="frame-visual" data-frame-id="grok-5">
                            <span class="frame-number">05</span>
                            <span class="frame-timing">0:16 – 0:20</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    COSMIC APOCALYPSE
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">AI Chaos</span>
                            <h2 class="frame-title">COSMIC APOCALYPSE</h2>
                            <p class="frame-description">Beyond Earth. This is where we leave the realm of "possible" and enter "impossible but looks real." The apex of the chaos—nothing is off limits now. Use mixed media throughout: videos, photos, text posts, screenshots.</p>
                            <div class="frame-notes">
                                <strong>Content Examples</strong>
                                <ul>
                                    <li>6ix9ine-operated Death Star destroys the moon</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="grok-5" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('grok-5')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('grok-5')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="grok-5" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 6: THE FREEZE -->
                    <div class="frame grok" data-frame="6" data-tab="grok">
                        <div class="frame-visual" data-frame-id="grok-6">
                            <span class="frame-number">06</span>
                            <span class="frame-timing">0:20 – 0:24</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    THE FREEZE
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">The Turn</span>
                            <h2 class="frame-title">THE FREEZE</h2>
                            <p class="frame-description">Record scratch. Freeze frame on the Death Star chaos. Everything stops. Silence. Then text types onto screen with keyboard sounds: "@grok is this real?"</p>
                            <div class="frame-notes">
                                <strong>Production Notes</strong>
                                <ul>
                                    <li>Hard freeze on most absurd moment</li>
                                    <li>Record scratch sound effect</li>
                                    <li>Text types on with keyboard clicking sounds</li>
                                    <li>Let the absurdity hang</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="grok-6" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('grok-6')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('grok-6')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="grok-6" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 7: GROK RESPONDS -->
                    <div class="frame grok" data-frame="7" data-tab="grok">
                        <div class="frame-visual" data-frame-id="grok-7">
                            <span class="frame-number">07</span>
                            <span class="frame-timing">0:24 – 0:28</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    GROK RESPONDS
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">Resolution</span>
                            <h2 class="frame-title">GROK RESPONDS</h2>
                            <p class="frame-description">Grok begins to answer. We see the response start to type out—but we cut before we hear it. The viewer doesn't need the answer. They just need to know Grok is there.</p>
                            <div class="frame-notes">
                                <strong>Production Notes</strong>
                                <ul>
                                    <li>Show Grok interface responding</li>
                                    <li>Response begins typing but cuts early</li>
                                    <li>Don't complete the answer—cut to logo</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="grok-7" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('grok-7')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('grok-7')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="grok-7" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 8: END CARD -->
                    <div class="frame endcard" data-frame="8" data-tab="grok">
                        <div class="frame-visual" data-frame-id="grok-8">
                            <span class="frame-number">08</span>
                            <span class="frame-timing">0:28 – 0:32</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="endcard-content">
                                    <div class="endcard-line">See it. Doubt it. Grok it.</div>
                                    <div class="endcard-grok">@grok</div>
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">End Card</span>
                            <h2 class="frame-title">THE LINE</h2>
                            <p class="frame-description">Cut to black. "See it. Doubt it. Grok it." @grok. X logo. Done.</p>
                            <div class="frame-notes">
                                <strong>Production Notes</strong>
                                <ul>
                                    <li>Hard cut—no transition</li>
                                    <li>White text on black</li>
                                    <li>X logo subtle, secondary</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="grok-8" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('grok-8')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('grok-8')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="grok-8" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                </div>
                <div style="display: flex; gap: 12px; margin-top: 60px;">
                    <button class="add-frame-btn" style="flex:1; margin-top:0;" onclick="addFrame('grok')">+ Add Frame</button>
                    <button class="add-frame-btn" style="flex:0; margin-top:0; padding: 24px;" onclick="showFrameTemplates('grok', this)">Templates ▾</button>
                </div>
            </section>

            <footer class="footer">
                <div class="footer-left">
                    GROK: SEE IT. DOUBT IT. GROK IT. — Storyboard v1.0<br>
                    Prepared for Creative Review
                </div>
                <div class="footer-right">
                    <button class="delete-tab-btn" onclick="deleteBrief('grok')">Delete Brief</button>
                    <button class="clear-data-btn" onclick="clearAllData('grok')">Clear All Data</button>
                    <span class="footer-link">Total Runtime: :45</span>
                    <span class="footer-link">8 Frames</span>
                </div>
            </footer>
        </main>
    </div>

    <!-- REPLIT TAB -->
    <div class="tab-content" id="replit">
        <header class="header">
            <div class="header-content">
                <div class="project-info">
                    <h1>Spec Campaign Storyboard</h1>
                    <div class="project-title" contenteditable="true" data-editable-id="replit-title">MAKE YOUR PARENTS PROUD</div>
                    <div class="brief-actions">
                        <button class="share-btn" onclick="showShareModal('replit')"><span>↗</span> Share</button>
                        <button class="brief-action-btn archive" onclick="archiveBrief('replit')">Archive</button>
                        <button class="brief-action-btn danger" onclick="deleteBrief('replit')">Delete</button>
                    </div>
                </div>
                <div class="meta">
                    CLIENT: <span contenteditable="true" data-editable-id="replit-client">Replit</span><br>
                    FORMAT: <span contenteditable="true" data-editable-id="replit-format">:30-:60 Digital</span><br>
                    VERSION: <span contenteditable="true" data-editable-id="replit-version">Brief Development</span><br>
                    DATE: <span contenteditable="true" data-editable-id="replit-date">January 2026</span>
                </div>
            </div>
        </header>

        <!-- Executions Bar -->
        <div class="executions-bar">
            <div class="executions-nav" data-executions-for="replit">
                <span class="executions-label">Executions</span>
                <button class="execution-tab active" data-execution="replit-main" onclick="switchExecution('replit', 'main')">
                    :30 <span class="frame-count">(5)</span>
                    <span class="execution-menu-trigger" onclick="event.stopPropagation(); toggleExecutionMenu(this)">▾</span>
                    <div class="execution-menu">
                        <div class="execution-menu-item" onclick="renameExecution('replit')">Rename</div>
                        <div class="execution-menu-item" onclick="duplicateExecution('replit')">Duplicate</div>
                        <div class="execution-menu-item danger" onclick="deleteExecution('replit')">Delete</div>
                    </div>
                </button>
                <button class="execution-add" onclick="showExecutionModal('replit')" title="Add execution">+</button>
            </div>
        </div>

        <main class="main">
            <section class="concept-section">
                <div class="section-label">Creative Brief</div>

                <div class="concept-grid">
                    <div class="concept-item">
                        <h3>Insight</h3>
                        <p>Every parent wants their child to become an engineer. Especially immigrant parents. It's the dream job—stable, prestigious, world-building.</p>
                    </div>
                    <div class="concept-item">
                        <h3>Idea</h3>
                        <p>Everyone's an engineer now. Replit made it possible. The barrier is gone.</p>
                    </div>
                    <div class="concept-item">
                        <h3>The Unlock</h3>
                        <p>AI visuals = the mom's imagination, which is BOUNDLESS, IRRATIONAL, EMOTIONALLY EXAGGERATED. Not a Marvel movie—a mother's love visualized at impossible scale.</p>
                    </div>
                </div>
            </section>

            <!-- Moodboard Section -->
            <section class="moodboard-section">
                <div class="section-label">Moodboard</div>
                <div class="moodboard-grid" data-moodboard-id="replit">
                    <div class="moodboard-add" onclick="addMoodboardImage('replit')">
                        <div class="moodboard-add-icon">+</div>
                        <div class="moodboard-add-text">Add Reference</div>
                        <input type="file" class="moodboard-file-input" accept="image/*" style="display:none">
                    </div>
                </div>
            </section>

            <section class="storyboard-section">
                <div class="section-label">Original Exec (Reference)</div>

                <div class="frames-container">
                    <div class="frame" data-frame="1" data-tab="replit">
                        <div class="frame-visual" data-frame-id="replit-1">
                            <span class="frame-number">01</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    THE CALL
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">Opening</span>
                            <h2 class="frame-title">THE CALL</h2>
                            <p class="frame-description">Son on video call. "Mom, I'll call you back—I have to finish coding my app." Mom's ears perk up. "Wait... you code? You're an engineer?!" She says the word like it's holy.</p>
                            <div class="frame-notes">
                                <strong>Script</strong>
                                <ul>
                                    <li>SON: "Mom, I'll call you back. I have to finish coding my app."</li>
                                    <li>MOM: "You code...? You're an engineer?!"</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="replit-1" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('replit-1')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('replit-1')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="replit-1" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="frame" data-frame="2" data-tab="replit">
                        <div class="frame-visual" data-frame-id="replit-2">
                            <span class="frame-number">02</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    MOM'S IMAGINATION
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">Fantasy</span>
                            <h2 class="frame-title">MOM'S IMAGINATION</h2>
                            <p class="frame-description">Cut to mom's dream. This is where AI shines. Not realistic engineering—EMOTIONAL engineering. Her son carved into mountains. Receiving every award. The absurd, boundless scale of a mother's pride.</p>
                            <div class="frame-notes">
                                <strong>Possible Visuals</strong>
                                <ul>
                                    <li>Son's face on Mount Rushmore next to the greats</li>
                                    <li>Holding up a collapsing bridge with bare hands</li>
                                    <li>Statue in the town square back home</li>
                                    <li>40-foot magazine cover she shows to neighbors</li>
                                    <li>Nobel Prize, Oscar, World Cup trophy—simultaneously</li>
                                    <li>Golden escalator ascending past every doubter</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="replit-2" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('replit-2')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('replit-2')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="replit-2" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="frame" data-frame="3" data-tab="replit">
                        <div class="frame-visual" data-frame-id="replit-3">
                            <span class="frame-number">03</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    THE GOODBYE
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">Transition</span>
                            <h2 class="frame-title">THE GOODBYE</h2>
                            <p class="frame-description">Back to the call. Son wrapping up. Mom can barely contain herself. He hangs up before she can finish telling him she's proud. Classic kid move.</p>
                            <div class="frame-notes">
                                <strong>Script</strong>
                                <ul>
                                    <li>SON: "Ok mom, I gotta go."</li>
                                    <li>MOM: "I'm so proud of y—" (click, he's gone)</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="replit-3" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('replit-3')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('replit-3')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="replit-3" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="frame" data-frame="4" data-tab="replit">
                        <div class="frame-visual" data-frame-id="replit-4">
                            <span class="frame-number">04</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    THE PROMPT
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">Reality</span>
                            <h2 class="frame-title">THE PROMPT</h2>
                            <p class="frame-description">Cut to son at laptop. We hear him voice-prompting Replit. The juxtaposition is the joke—and the truth. He IS an engineer now.</p>
                            <div class="frame-notes">
                                <strong>Script</strong>
                                <ul>
                                    <li>SON (V.O.): "Ok, build me an app that tracks my dog's poops. Make no mistakes."</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="replit-4" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('replit-4')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('replit-4')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="replit-4" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="frame endcard" data-frame="5" data-tab="replit">
                        <div class="frame-visual" data-frame-id="replit-5">
                            <span class="frame-number">REF</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="endcard-content">
                                    <div class="endcard-line">Make your parents proud.</div>
                                    <div class="endcard-grok">Replit</div>
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">End Card</span>
                            <h2 class="frame-title">THE LINE</h2>
                            <p class="frame-description">"Make your parents proud." Replit logo. Simple. Emotional. Universal.</p>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="replit-5" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('replit-5')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('replit-5')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="replit-5" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 60px;">
                    <button class="add-frame-btn" style="flex:1; margin-top:0;" onclick="addFrame('replit')">+ Add Frame</button>
                    <button class="add-frame-btn" style="flex:0; margin-top:0; padding: 24px;" onclick="showFrameTemplates('replit', this)">Templates ▾</button>
                </div>
            </section>

            <footer class="footer">
                <div class="footer-left">
                    REPLIT: MAKE YOUR PARENTS PROUD — Brief Development<br>
                    Work in Progress
                </div>
                <div class="footer-right">
                    <button class="delete-tab-btn" onclick="deleteBrief('replit')">Delete Brief</button>
                    <button class="clear-data-btn" onclick="clearAllData('replit')">Clear All Data</button>
                    <span class="footer-link">Status: Refining</span>
                </div>
            </footer>
        </main>
    </div>

    <!-- RYANAIR TAB -->
    <div class="tab-content" id="ryanair">
        <header class="header">
            <div class="header-content">
                <div class="project-info">
                    <h1>Spec Campaign Storyboard</h1>
                    <div class="project-title" contenteditable="true" data-editable-id="ryanair-title">NOW TURN THIS INTO AN AD</div>
                    <div class="brief-actions">
                        <button class="share-btn" onclick="showShareModal('ryanair')"><span>↗</span> Share</button>
                        <button class="brief-action-btn archive" onclick="archiveBrief('ryanair')">Archive</button>
                        <button class="brief-action-btn danger" onclick="deleteBrief('ryanair')">Delete</button>
                    </div>
                </div>
                <div class="meta">
                    CLIENT: <span contenteditable="true" data-editable-id="ryanair-client">Ryanair</span><br>
                    FORMAT: <span contenteditable="true" data-editable-id="ryanair-format">:60 Digital/Social</span><br>
                    VERSION: <span contenteditable="true" data-editable-id="ryanair-version">Draft 1.0</span><br>
                    DATE: <span contenteditable="true" data-editable-id="ryanair-date">January 2026</span>
                </div>
            </div>
        </header>

        <!-- Executions Bar -->
        <div class="executions-bar">
            <div class="executions-nav" data-executions-for="ryanair">
                <span class="executions-label">Executions</span>
                <button class="execution-tab active" data-execution="ryanair-main" onclick="switchExecution('ryanair', 'main')">
                    :60 <span class="frame-count">(6)</span>
                    <span class="execution-menu-trigger" onclick="event.stopPropagation(); toggleExecutionMenu(this)">▾</span>
                    <div class="execution-menu">
                        <div class="execution-menu-item" onclick="renameExecution('ryanair')">Rename</div>
                        <div class="execution-menu-item" onclick="duplicateExecution('ryanair')">Duplicate</div>
                        <div class="execution-menu-item danger" onclick="deleteExecution('ryanair')">Delete</div>
                    </div>
                </button>
                <button class="execution-add" onclick="showExecutionModal('ryanair')" title="Add execution">+</button>
            </div>
        </div>

        <main class="main">
            <section class="concept-section">
                <div class="section-label">Creative Brief</div>

                <div class="concept-grid">
                    <div class="concept-item">
                        <h3>Insight</h3>
                        <p>Michael O'Leary is already a meme. He's publicly floated standing seats, toilet fees, charging for oxygen. The internet thinks he's a cartoon villain. He knows. He leans in.</p>
                    </div>
                    <div class="concept-item">
                        <h3>Idea</h3>
                        <p>Michael uses AI to visualize his most unhinged cost-cutting fantasies. The ad escalates to madness—then he prompts: "Now turn this into an ad." The audience realizes they just watched it. He wins. Again.</p>
                    </div>
                    <div class="concept-item">
                        <h3>Tone</h3>
                        <p>Whiplash meets shitpost. Cinematic tension, absurdist punchlines. Deadpan delivery. The comedy is in the commitment—played completely straight until the meta collapse at the end.</p>
                    </div>
                </div>
            </section>

            <!-- Moodboard Section -->
            <section class="moodboard-section">
                <div class="section-label">Moodboard</div>
                <div class="moodboard-grid" data-moodboard-id="ryanair">
                    <div class="moodboard-add" onclick="addMoodboardImage('ryanair')">
                        <div class="moodboard-add-icon">+</div>
                        <div class="moodboard-add-text">Add Reference</div>
                        <input type="file" class="moodboard-file-input" accept="image/*" style="display:none">
                    </div>
                </div>
            </section>

            <section class="storyboard-section">
                <div class="section-label">Storyboard</div>

                <div class="frames-container">
                    <!-- FRAME 1: THE SETUP -->
                    <div class="frame" data-frame="1" data-tab="ryanair">
                        <div class="frame-visual" data-frame-id="ryanair-1">
                            <span class="frame-number">01</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    Vast aircraft hangar. Pitch black except for a single harsh spotlight from above.<br><br>
                                    @img1 stands alone in the cone of light, speaking into the darkness.<br><br>
                                    His voice echoes: "Show me a plane with no reclining seats."<br><br>
                                    Behind him, a faint glow begins on the raw concrete wall.
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">Opening</span>
                            <h2 class="frame-title">THE SETUP</h2>
                            <p class="frame-description">Vast aircraft hangar. Pitch black except for a single harsh spotlight from above. @img1 stands alone in the cone of light, speaking into the darkness. His voice echoes: "Show me a plane with no reclining seats." Behind him, a faint glow begins on the raw concrete wall.</p>
                            <div class="frame-notes">
                                <strong>Production Notes</strong>
                                <ul>
                                    <li>Establishing shot of the hangar's scale. Industrial, cavernous, villainous.</li>
                                    <li>Single harsh spotlight—everything else falls into darkness.</li>
                                    <li>Sound design: voice echoes off concrete, distant hum of industrial space. No music yet.</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="ryanair-1" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('ryanair-1')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('ryanair-1')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="ryanair-1" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 2: THE ESCALATION BEGINS -->
                    <div class="frame" data-frame="2" data-tab="ryanair">
                        <div class="frame-visual" data-frame-id="ryanair-2">
                            <span class="frame-number">02</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    An AI-generated image blooms across the concrete wall: passengers packed standing, gripping ceiling straps.<br><br>
                                    @img1 smirks in the spotlight. Voice cuts through the dark.<br><br>
                                    "Tighter." / "Charge for the oxygen masks."<br><br>
                                    The projection warps and regenerates.
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">Escalation</span>
                            <h2 class="frame-title">THE ESCALATION BEGINS</h2>
                            <p class="frame-description">An AI-generated image blooms across the concrete wall: passengers packed standing, gripping ceiling straps. @img1 smirks in the spotlight. Voice cuts through the dark. "Tighter." / "Charge for the oxygen masks." The projection warps and regenerates.</p>
                            <div class="frame-notes">
                                <strong>Production Notes</strong>
                                <ul>
                                    <li>AI images projected directly onto raw concrete—grainy, massive, slightly distorted.</li>
                                    <li>Same single spotlight on @img1. Consistent lighting throughout.</li>
                                    <li>First hint of score creeping in. Low tension.</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="ryanair-2" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('ryanair-2')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('ryanair-2')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="ryanair-2" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 3: THE FEVER -->
                    <div class="frame" data-frame="3" data-tab="ryanair">
                        <div class="frame-visual" data-frame-id="ryanair-3">
                            <span class="frame-number">03</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    The concrete walls flood with projections. Images overlapping, regenerating, multiplying.<br><br>
                                    @img1's voice rapid-fire: "Ads on the sick bags." / "Ads on the captain." / "Crying baby surcharge. Per decibel."<br><br>
                                    He paces in the spotlight. Eyes wild. This is his happy place.
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">Build</span>
                            <h2 class="frame-title">THE FEVER</h2>
                            <p class="frame-description">The concrete walls flood with projections. Images overlapping, regenerating, multiplying. @img1's voice rapid-fire: "Ads on the sick bags." / "Ads on the captain." / "Crying baby surcharge. Per decibel." He paces in the spotlight. Eyes wild. This is his happy place.</p>
                            <div class="frame-notes">
                                <strong>Production Notes</strong>
                                <ul>
                                    <li>Tempo increases. Jump cuts. Score intensifies—drums or percussive pulse.</li>
                                    <li>Multiple projections now—covering walls, floor, even ceiling. Manic energy.</li>
                                    <li>Spotlight stays harsh and fixed. @img1 moves within it like a conductor.</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="ryanair-3" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('ryanair-3')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('ryanair-3')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="ryanair-3" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 4: THE CRESCENDO -->
                    <div class="frame" data-frame="4" data-tab="ryanair">
                        <div class="frame-visual" data-frame-id="ryanair-4">
                            <span class="frame-number">04</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    @img1 spreads his arms wide. Full maestro energy. The hangar is his cathedral.<br><br>
                                    "Toilets. Pay per square."<br>
                                    "Parachutes. We don't land. We drop."<br><br>
                                    Beat. He pauses. Voice drops: "We charge for the chutes."<br><br>
                                    Massive projection on the wall: passengers freefalling, Ryanair-branded parachutes deploying. A few without.
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">Climax</span>
                            <h2 class="frame-title">THE CRESCENDO</h2>
                            <p class="frame-description">@img1 spreads his arms wide. Full maestro energy. The hangar is his cathedral. "Toilets. Pay per square." "Parachutes. We don't land. We drop." Beat. Voice drops: "We charge for the chutes." Massive projection on the wall: passengers freefalling, Ryanair-branded parachutes deploying. A few without.</p>
                            <div class="frame-notes">
                                <strong>Production Notes</strong>
                                <ul>
                                    <li>Camera movement here. Handheld or slow push-in on @img1 silhouette against projection.</li>
                                    <li>Score peaks. Whiplash-level intensity.</li>
                                    <li>The parachute image should fill the entire back wall. Beautifully absurd. A couple chuteless passengers adds dark comedy.</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="ryanair-4" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('ryanair-4')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('ryanair-4')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="ryanair-4" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 5: THE STILLNESS -->
                    <div class="frame" data-frame="5" data-tab="ryanair">
                        <div class="frame-visual" data-frame-id="ryanair-5">
                            <span class="frame-number">05</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    Silence. The projections fade to black.<br><br>
                                    @img1 stands alone in the spotlight. Catches his breath. A long beat.<br><br>
                                    Then a slow, satisfied smile spreads across his face.<br><br>
                                    He speaks one final prompt into the darkness.
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">Pause</span>
                            <h2 class="frame-title">THE STILLNESS</h2>
                            <p class="frame-description">Silence. The projections fade to black. @img1 stands alone in the spotlight. Catches his breath. A long beat. Then a slow, satisfied smile spreads across his face. He speaks one final prompt into the darkness.</p>
                            <div class="frame-notes">
                                <strong>Production Notes</strong>
                                <ul>
                                    <li>Hard cut to silence. Score drops out completely. Walls go dark.</li>
                                    <li>Just @img1 in the single spotlight. Hold on his silhouette. Let the audience breathe.</li>
                                    <li>Sound: just breathing echoing in the cavernous space.</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="ryanair-5" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('ryanair-5')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('ryanair-5')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="ryanair-5" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 6: THE PUNCHLINE -->
                    <div class="frame endcard" data-frame="6" data-tab="ryanair">
                        <div class="frame-visual" data-frame-id="ryanair-6">
                            <span class="frame-number">06</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="endcard-content">
                                    <div class="endcard-line">"Now turn this into an ad."</div>
                                    <div class="endcard-grok">Ryanair</div>
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">End Card</span>
                            <h2 class="frame-title">THE PUNCHLINE</h2>
                            <p class="frame-description">His voice echoes through the hangar: "Now turn this into an ad." Beat. He steps back. Smug. The spotlight snaps off. Cut to black. LOGO: Ryanair.</p>
                            <div class="frame-notes">
                                <strong>Production Notes</strong>
                                <ul>
                                    <li>The spotlight cutting out should feel abrupt. Plunges into total darkness.</li>
                                    <li>No tagline. No super. Trust the joke.</li>
                                    <li>Optional: hold black for an extra beat longer than comfortable. Let it land.</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="ryanair-6" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('ryanair-6')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('ryanair-6')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="ryanair-6" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 60px;">
                    <button class="add-frame-btn" style="flex:1; margin-top:0;" onclick="addFrame('ryanair')">+ Add Frame</button>
                    <button class="add-frame-btn" style="flex:0; margin-top:0; padding: 24px;" onclick="showFrameTemplates('ryanair', this)">Templates ▾</button>
                </div>
            </section>

            <footer class="footer">
                <div class="footer-left">
                    RYANAIR: NOW TURN THIS INTO AN AD — Storyboard v1.0<br>
                    Prepared for Creative Review
                </div>
                <div class="footer-right">
                    <button class="delete-tab-btn" onclick="deleteBrief('ryanair')">Delete Brief</button>
                    <button class="clear-data-btn" onclick="clearAllData('ryanair')">Clear All Data</button>
                    <span class="footer-link">Status: Ready for Review</span>
                </div>
            </footer>
        </main>
    </div>

    <!-- REDDIT TAB -->
    <div class="tab-content" id="reddit">
        <header class="header">
            <div class="header-content">
                <div class="project-info">
                    <h1>Spec Campaign Storyboard</h1>
                    <div class="project-title" contenteditable="true" data-editable-id="reddit-title">THE MOUNTAIN</div>
                    <div class="brief-actions">
                        <button class="share-btn" onclick="showShareModal('reddit')"><span>↗</span> Share</button>
                        <button class="brief-action-btn archive" onclick="archiveBrief('reddit')">Archive</button>
                        <button class="brief-action-btn danger" onclick="deleteBrief('reddit')">Delete</button>
                    </div>
                </div>
                <div class="meta">
                    CLIENT: <span contenteditable="true" data-editable-id="reddit-client">Reddit</span><br>
                    FORMAT: <span contenteditable="true" data-editable-id="reddit-format">:30-:45 Digital</span><br>
                    VERSION: <span contenteditable="true" data-editable-id="reddit-version">Draft 1.0</span><br>
                    DATE: <span contenteditable="true" data-editable-id="reddit-date">January 2026</span>
                </div>
            </div>
        </header>

        <!-- Executions Bar -->
        <div class="executions-bar">
            <div class="executions-nav" data-executions-for="reddit">
                <span class="executions-label">Executions</span>
                <button class="execution-tab active" data-execution="reddit-main" onclick="switchExecution('reddit', 'main')">
                    :45 <span class="frame-count">(7)</span>
                    <span class="execution-menu-trigger" onclick="event.stopPropagation(); toggleExecutionMenu(this)">▾</span>
                    <div class="execution-menu">
                        <div class="execution-menu-item" onclick="renameExecution('reddit')">Rename</div>
                        <div class="execution-menu-item" onclick="duplicateExecution('reddit')">Duplicate</div>
                        <div class="execution-menu-item danger" onclick="deleteExecution('reddit')">Delete</div>
                    </div>
                </button>
                <button class="execution-add" onclick="showExecutionModal('reddit')" title="Add execution">+</button>
            </div>
        </div>

        <main class="main">
            <section class="concept-section">
                <div class="section-label">Creative Brief</div>

                <div class="concept-grid">
                    <div class="concept-item">
                        <h3>Insight</h3>
                        <p>Every major AI—ChatGPT, Claude, Gemini—was trained on billions of Reddit comments. They took the words. They left the people.</p>
                    </div>
                    <div class="concept-item">
                        <h3>Idea</h3>
                        <p>Snoo as an ancient archivist atop a mountain of human opinion. Critters climb up seeking answers. But they only take one—missing the whole argument. That's the good part.</p>
                    </div>
                    <div class="concept-item">
                        <h3>Tone</h3>
                        <p>Miyazaki meets Reddit. Warm, strange, a little funny. Snoo is patient, ancient, amused. He's seen a thousand critters come and go. They always just take one answer.</p>
                    </div>
                </div>
            </section>

            <!-- Moodboard Section -->
            <section class="moodboard-section">
                <div class="section-label">Moodboard</div>
                <div class="moodboard-grid" data-moodboard-id="reddit">
                    <div class="moodboard-add" onclick="addMoodboardImage('reddit')">
                        <div class="moodboard-add-icon">+</div>
                        <div class="moodboard-add-text">Add Reference</div>
                        <input type="file" class="moodboard-file-input" accept="image/*" style="display:none">
                    </div>
                </div>
            </section>

            <section class="storyboard-section">
                <div class="section-label">Storyboard</div>

                <div class="frames-container">
                    <!-- FRAME 1: THE MOUNTAIN -->
                    <div class="frame" data-frame="1" data-tab="reddit">
                        <div class="frame-visual" data-frame-id="reddit-1">
                            <span class="frame-number">01</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    THE MOUNTAIN
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">Opening</span>
                            <h2 class="frame-title">THE MOUNTAIN</h2>
                            <p class="frame-description">Wide shot. A massive mountain rising through clouds. It's made of Reddit—giant upvote arrows jutting out like crags. Thread lines weaving through like veins. Comment chains stacked like sediment. Orange and white glowing through the mist. At the peak: a small temple. Warm light inside.</p>
                            <div class="frame-notes">
                                <strong>Production Notes</strong>
                                <ul>
                                    <li>Miyazaki-esque scale and wonder</li>
                                    <li>Mountain literally constructed from Reddit UI elements</li>
                                    <li>Temple glowing warm at peak—inviting</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="reddit-1" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('reddit-1')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('reddit-1')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="reddit-1" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 2: THE CRITTER -->
                    <div class="frame" data-frame="2" data-tab="reddit">
                        <div class="frame-visual" data-frame-id="reddit-2">
                            <span class="frame-number">02</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    THE CRITTER
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">Character</span>
                            <h2 class="frame-title">THE CRITTER</h2>
                            <p class="frame-description">Close shot. A small, cute critter climbing the path. OpenAI logo subtly on its body—maybe on its belly, or like a little backpack. Round, friendly, corporate. It waddles up the mountain with purpose. It has a question.</p>
                            <div class="frame-notes">
                                <strong>Production Notes</strong>
                                <ul>
                                    <li>Cute but corporate—friendly face, logo visible but not obnoxious</li>
                                    <li>Determined little waddle</li>
                                    <li>OpenAI logo subtle but recognizable</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="reddit-2" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('reddit-2')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('reddit-2')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="reddit-2" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 3: THE TEMPLE -->
                    <div class="frame" data-frame="3" data-tab="reddit">
                        <div class="frame-visual" data-frame-id="reddit-3">
                            <span class="frame-number">03</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    THE TEMPLE
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">Location</span>
                            <h2 class="frame-title">THE TEMPLE</h2>
                            <p class="frame-description">Inside. Warm, glowing, ancient. Scrolls everywhere, piled high, spilling off shelves. Elder Snoo sits in the center—robes, calm, wise. Has seen a thousand critters come through. The critter approaches.</p>
                            <div class="frame-notes">
                                <strong>Script</strong>
                                <ul>
                                    <li>CRITTER (babyish, eager): "What are the best mushrooms for mushroom soup?"</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="reddit-3" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('reddit-3')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('reddit-3')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="reddit-3" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 4: THE SCROLL -->
                    <div class="frame" data-frame="4" data-tab="reddit">
                        <div class="frame-visual" data-frame-id="reddit-4">
                            <span class="frame-number">04</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    THE SCROLL
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">The Argument</span>
                            <h2 class="frame-title">THE SCROLL</h2>
                            <p class="frame-description">Snoo's eyes light up. Oh, this is a good one. He reaches into the pile. Pulls out a long scroll. Unrolls it with ceremony. Clears his throat. Begins reading with relish—savoring every word, every reply, every argument.</p>
                            <div class="frame-notes">
                                <strong>Script</strong>
                                <ul>
                                    <li>SNOO (ancient, wise): "Cremini, obviously..."</li>
                                    <li>SNOO: "But u/shroomking99 says: 'Cremini is for beginners. Porcini or go home...'"</li>
                                    <li>SNOO: "And here, u/nonnas_recipe writes: 'My grandmother used chanterelles and she lived to 103...'"</li>
                                    <li>SNOO (chuckling): "Now THIS response has 47 replies—"</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="reddit-4" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('reddit-4')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('reddit-4')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="reddit-4" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 5: THE INTERRUPTION -->
                    <div class="frame" data-frame="5" data-tab="reddit">
                        <div class="frame-visual" data-frame-id="reddit-5">
                            <span class="frame-number">05</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    THE INTERRUPTION
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">The Turn</span>
                            <h2 class="frame-title">THE INTERRUPTION</h2>
                            <p class="frame-description">Critter cuts him off. Doesn't need the rest. Got what it came for. Turns. Waddles out. Snoo freezes mid-scroll. Mouth still open.</p>
                            <div class="frame-notes">
                                <strong>Script</strong>
                                <ul>
                                    <li>CRITTER (babyish, impatient): "Cremini. Got it. Thanks."</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="reddit-5" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('reddit-5')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('reddit-5')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="reddit-5" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 6: SNOO ALONE -->
                    <div class="frame" data-frame="6" data-tab="reddit">
                        <div class="frame-visual" data-frame-id="reddit-6">
                            <span class="frame-number">06</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description">
                                    SNOO ALONE
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">The Moment</span>
                            <h2 class="frame-title">SNOO ALONE</h2>
                            <p class="frame-description">Snoo holding the scroll. Mid-sentence. He looks down at it. All the threads. The debate. The grandmother. The 47 replies he never got to read. His shoulders drop slightly. A small sigh. ...but the argument was the best part. He slowly rolls the scroll back up. Tucks it away. Waits for the next critter.</p>
                            <div class="frame-notes">
                                <strong>Production Notes</strong>
                                <ul>
                                    <li>Not bitter—amused, a little deflated</li>
                                    <li>He loves the threads. That's the good part.</li>
                                    <li>Expression: "They always just take one."</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="reddit-6" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('reddit-6')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('reddit-6')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="reddit-6" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME 7: END CARD -->
                    <div class="frame endcard" data-frame="7" data-tab="reddit">
                        <div class="frame-visual" data-frame-id="reddit-7">
                            <span class="frame-number">07</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="endcard-content">
                                    <div class="endcard-line">You missed the best part.</div>
                                    <div class="endcard-grok">reddit</div>
                                </div>
                            </div>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type">End Card</span>
                            <h2 class="frame-title">END CARD</h2>
                            <p class="frame-description">Black. Simple. "You missed the best part." Reddit logo.</p>
                            <div class="frame-notes">
                                <strong>Production Notes</strong>
                                <ul>
                                    <li>Clean end card</li>
                                    <li>Line lands the whole point</li>
                                    <li>Reddit logo</li>
                                </ul>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="reddit-7" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('reddit-7')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('reddit-7')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="reddit-7" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                        </div>
                    </div>

                </div>
                <div style="display: flex; gap: 12px; margin-top: 60px;">
                    <button class="add-frame-btn" style="flex:1; margin-top:0;" onclick="addFrame('reddit')">+ Add Frame</button>
                    <button class="add-frame-btn" style="flex:0; margin-top:0; padding: 24px;" onclick="showFrameTemplates('reddit', this)">Templates ▾</button>
                </div>
            </section>

            <footer class="footer">
                <div class="footer-left">
                    REDDIT: THE MOUNTAIN — Storyboard v1.0<br>
                    Prepared for Creative Review
                </div>
                <div class="footer-right">
                    <button class="delete-tab-btn" onclick="deleteBrief('reddit')">Delete Brief</button>
                    <button class="clear-data-btn" onclick="clearAllData('reddit')">Clear All Data</button>
                    <span class="footer-link">7 Frames</span>
                </div>
            </footer>
        </main>
    </div>

    <!-- Bottom Toolbar -->
    <div class="cloud-bar">
        <div class="cloud-bar-left">
            <div class="toolbar" style="gap: 4px;">
                <button class="view-btn active" onclick="setView('list')">List</button>
                <button class="view-btn" onclick="setView('grid')">Grid</button>
                <button class="view-btn" onclick="setView('timeline')">Timeline</button>
            </div>
            <span class="toolbar-divider"></span>
            <button class="toolbar-btn" onclick="startPresentation()">▶ Present</button>
            <button class="toolbar-btn" onclick="duplicateCurrentBrief()">Duplicate</button>
            <button class="toolbar-btn" onclick="toggleVersionHistory()">History</button>
            <button class="toolbar-btn" onclick="showTemplateModal()">Templates</button>
        </div>
        <div class="cloud-bar-right">
            <span class="cloud-bar-status" id="saveStatus" style="margin-right: 16px;">Saved</span>
            <button class="cloud-bar-btn secondary" onclick="loadFromCloud()" id="loadBtn">Sync</button>
            <button class="cloud-bar-btn" onclick="saveToCloud()" id="saveBtn">Save to Cloud</button>
        </div>
    </div>

    <script>
        // Tab switching
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.dataset.tab;

                tabBtns.forEach(b => b.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));

                btn.classList.add('active');
                document.getElementById(tabId).classList.add('active');

                window.scrollTo(0, 0);
            });
        });

        // Progress bar (Grok tab only)
        const progressBar = document.getElementById('progressBar');
        window.addEventListener('scroll', () => {
            if (document.getElementById('grok').classList.contains('active')) {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const progress = (scrollTop / docHeight) * 100;
                progressBar.style.width = progress + '%';
            }
        });

        // Frame counter dots (Grok tab)
        const frameCounter = document.getElementById('frameCounter');
        const grokFrames = document.querySelectorAll('#grok .frame');

        grokFrames.forEach((frame, index) => {
            const dot = document.createElement('div');
            dot.className = 'frame-dot';
            dot.addEventListener('click', () => {
                frame.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });
            frameCounter.appendChild(dot);
        });

        const dots = document.querySelectorAll('.frame-dot');

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const index = Array.from(grokFrames).indexOf(entry.target);
                    dots.forEach((dot, i) => {
                        dot.classList.toggle('active', i === index);
                    });
                }
            });
        }, { threshold: 0.5 });

        grokFrames.forEach(frame => observer.observe(frame));

        // ==========================================
        // IMAGE UPLOAD FUNCTIONALITY
        // ==========================================

        const frameVisuals = document.querySelectorAll('.frame-visual');

        frameVisuals.forEach(visual => {
            const fileInput = visual.querySelector('.frame-file-input');
            const frameId = visual.dataset.frameId;

            // Click to upload
            visual.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-image')) return;
                fileInput.click();
            });

            // File input change - upload to Imgur
            fileInput.addEventListener('change', async (e) => {
                if (e.target.files && e.target.files[0]) {
                    await handleImageUpload(e.target.files[0], visual, frameId);
                }
            });

            // Drag and drop
            visual.addEventListener('dragover', (e) => {
                e.preventDefault();
                visual.classList.add('dragover');
            });

            visual.addEventListener('dragleave', () => {
                visual.classList.remove('dragover');
            });

            // Drop handler - upload to Imgur
            visual.addEventListener('drop', async (e) => {
                e.preventDefault();
                visual.classList.remove('dragover');
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    await handleImageUpload(e.dataTransfer.files[0], visual, frameId);
                }
            });

            // Remove image button
            const removeBtn = visual.querySelector('.remove-image');
            removeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                clearImage(frameId);
            });
        });

        // Handle image upload - uploads to Supabase Storage
        async function handleImageUpload(file, visual, frameId) {
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                return;
            }

            // Show loading state
            const visualContent = visual.querySelector('.visual-content');
            if (visualContent) {
                visualContent.innerHTML = '<div class="visual-description">Uploading...</div>';
            }

            // Upload to Supabase Storage
            const publicUrl = await uploadImageToSupabase(file, frameId);

            if (publicUrl) {
                // Store URL in memory
                imageUrls[frameId] = publicUrl;

                // Also set the URL input field
                const input = document.querySelector(`.image-url-input[data-frame-id="${frameId}"]`);
                if (input) input.value = publicUrl;

                // Display the image
                loadImageFromUrlDirect(frameId, publicUrl);

                // Auto-save to localStorage
                saveToLocalStorage();
            } else {
                // Fallback to base64 if upload fails
                showGlobalStatus('Upload failed, saving locally...');
                const reader = new FileReader();
                reader.onload = (e) => {
                    const base64Data = e.target.result;
                    imageUrls[frameId] = base64Data;
                    loadImageFromUrlDirect(frameId, base64Data);
                    saveToLocalStorage();
                };
                reader.readAsDataURL(file);
            }
        }

        // ==========================================
        // CD COMMENTS FUNCTIONALITY
        // ==========================================

        const commentTextareas = document.querySelectorAll('.cd-comments-textarea');

        commentTextareas.forEach(textarea => {
            const commentId = textarea.dataset.commentId;
            const statusEl = textarea.parentElement.querySelector('.cd-comments-status');

            // Load saved comment
            const savedComment = localStorage.getItem(`storyboard-comment-${commentId}`);
            if (savedComment) {
                textarea.value = savedComment;
            }

            // Save on input with debounce
            let saveTimeout;
            textarea.addEventListener('input', () => {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    localStorage.setItem(`storyboard-comment-${commentId}`, textarea.value);
                    showSaveStatus(statusEl);
                }, 500);
            });

            // Save on blur immediately
            textarea.addEventListener('blur', () => {
                localStorage.setItem(`storyboard-comment-${commentId}`, textarea.value);
                showSaveStatus(statusEl);
            });
        });

        function showSaveStatus(statusEl) {
            statusEl.classList.add('visible');
            setTimeout(() => {
                statusEl.classList.remove('visible');
            }, 2000);
        }

        // ==========================================
        // CLEAR ALL DATA
        // ==========================================

        function clearAllData(tab) {
            if (!confirm(`Clear all images and comments for ${tab.toUpperCase()}? This cannot be undone.`)) return;

            const frames = document.querySelectorAll(`[data-tab="${tab}"] .frame-visual`);
            frames.forEach(visual => {
                const frameId = visual.dataset.frameId;
                clearImage(frameId);
            });

            const comments = document.querySelectorAll(`[data-tab="${tab}"] .cd-comments-textarea`);
            comments.forEach(textarea => {
                const commentId = textarea.dataset.commentId;
                textarea.value = '';
                localStorage.removeItem(`storyboard-comment-${commentId}`);
            });

            // Also update URL
            saveToUrl();
        }

        // ==========================================
        // CLOUD STORAGE (npoint.io - free, no signup)
        // ==========================================

        // SUPABASE CONFIG
        const SUPABASE_URL = 'https://zdgntadusbzoqaprfogm.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpkZ250YWR1c2J6b3FhcHJmb2dtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4NDQ3NzEsImV4cCI6MjA4NDQyMDc3MX0.AcaZHJy7IG-SrTvHvJXaQlaVB7hHVGdJllSW_x1xSaQ';
        const DOC_ID = 'main'; // Single shared document for everyone

        // Store image URLs in memory
        const imageUrls = {};

        async function saveToCloud() {
            const saveBtn = document.getElementById('saveBtn');
            const cloudStatus = document.getElementById('cloudStatus');

            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';
            cloudStatus.textContent = '';

            const data = getAllData();

            try {
                // Save to Supabase with fixed ID 'main'
                const response = await fetch(`${SUPABASE_URL}/rest/v1/storyboard_data`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Prefer': 'resolution=merge-duplicates'
                    },
                    body: JSON.stringify({
                        id: DOC_ID,
                        data: data,
                        updated_at: new Date().toISOString()
                    })
                });

                if (response.ok) {
                    document.getElementById('cloudId').textContent = '✓ Synced';
                    cloudStatus.textContent = '✓ Saved!';
                    showGlobalStatus('Saved to cloud!');
                } else {
                    throw new Error('Save failed: ' + response.status);
                }
            } catch (error) {
                console.error('Save error:', error);
                cloudStatus.textContent = '✗ Save failed';
                showGlobalStatus('Save failed - check console');
            }

            saveBtn.disabled = false;
            saveBtn.textContent = 'Save';
        }

        async function loadFromCloud() {
            const loadBtn = document.getElementById('loadBtn');
            const cloudStatus = document.getElementById('cloudStatus');

            loadBtn.disabled = true;
            loadBtn.textContent = 'Loading...';
            cloudStatus.textContent = '';

            try {
                console.log('Loading from Supabase...');
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/storyboard_data?id=eq.${DOC_ID}&select=data`,
                    {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    }
                );

                console.log('Response status:', response.status);

                if (response.ok) {
                    const results = await response.json();
                    console.log('Results:', results);
                    if (results.length > 0 && results[0].data) {
                        console.log('Data to load:', results[0].data);
                        setAllData(results[0].data);
                        document.getElementById('cloudId').textContent = '✓ Synced';
                        cloudStatus.textContent = '✓ Loaded!';
                        showGlobalStatus('Data loaded!');
                    } else {
                        console.log('No data found');
                        cloudStatus.textContent = 'No saved data yet';
                        document.getElementById('cloudId').textContent = 'No data';
                    }
                } else {
                    const errorText = await response.text();
                    console.error('Response error:', errorText);
                    throw new Error('Load failed: ' + response.status);
                }
            } catch (error) {
                console.error('Load error:', error);
                cloudStatus.textContent = '✗ Load failed';
                document.getElementById('cloudId').textContent = 'Error';
                showGlobalStatus('Load failed - check console');
            }

            loadBtn.disabled = false;
            loadBtn.textContent = 'Refresh';
        }

        // Auto-load from cloud on page load
        setTimeout(() => loadFromCloud(), 500);

        // Upload image to Supabase Storage
        async function uploadImageToSupabase(file, frameId) {
            showGlobalStatus('Uploading image...');

            const fileName = `${frameId}_${Date.now()}_${file.name}`;

            try {
                const response = await fetch(
                    `${SUPABASE_URL}/storage/v1/object/storyboard-images/${fileName}`,
                    {
                        method: 'POST',
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`,
                            'Content-Type': file.type
                        },
                        body: file
                    }
                );

                if (response.ok) {
                    // Get public URL
                    const publicUrl = `${SUPABASE_URL}/storage/v1/object/public/storyboard-images/${fileName}`;
                    showGlobalStatus('Image uploaded!');
                    return publicUrl;
                } else {
                    throw new Error('Upload failed');
                }
            } catch (error) {
                console.error('Upload error:', error);
                showGlobalStatus('Upload failed');
                return null;
            }
        }

        function getAllData() {
            const data = {
                images: {},
                comments: {},
                editableText: {}
            };

            // Collect all image URLs from memory
            Object.entries(imageUrls).forEach(([id, url]) => {
                if (url) {
                    data.images[id] = url;
                }
            });

            // Collect all comments
            document.querySelectorAll('.cd-comments-textarea').forEach(textarea => {
                const id = textarea.dataset.commentId;
                if (textarea.value.trim()) {
                    data.comments[id] = textarea.value.trim();
                }
            });

            // Collect all editable text
            document.querySelectorAll('[contenteditable="true"][data-editable-id]').forEach(el => {
                const id = el.dataset.editableId;
                const content = el.innerHTML;
                if (content) {
                    data.editableText[id] = content;
                }
            });

            return data;
        }

        function setAllData(data) {
            if (!data) return;

            // Set image URLs and load images
            if (data.images) {
                Object.entries(data.images).forEach(([id, url]) => {
                    imageUrls[id] = url;
                    // Also set the URL input field
                    const input = document.querySelector(`.image-url-input[data-frame-id="${id}"]`);
                    if (input) input.value = url;
                    loadImageFromUrlDirect(id, url);
                });
            }

            // Set comments
            if (data.comments) {
                Object.entries(data.comments).forEach(([id, comment]) => {
                    const textarea = document.querySelector(`.cd-comments-textarea[data-comment-id="${id}"]`);
                    if (textarea) {
                        textarea.value = comment;
                    }
                });
            }

            // Set editable text
            if (data.editableText) {
                Object.entries(data.editableText).forEach(([id, content]) => {
                    const el = document.querySelector(`[data-editable-id="${id}"]`);
                    if (el) {
                        el.innerHTML = content;
                    }
                });
            }
        }

        function saveToUrl() {
            // Just save to localStorage as backup (silent)
            const data = getAllData();
            try {
                localStorage.setItem('storyboard-backup', JSON.stringify(data));
            } catch (e) {
                console.warn('Could not save to localStorage');
            }
        }

        function loadFromLocalBackup() {
            try {
                const backup = localStorage.getItem('storyboard-backup');
                if (backup) {
                    const data = JSON.parse(backup);
                    setAllData(data);
                }
            } catch (e) {
                console.warn('Could not load from localStorage');
            }
        }

        function showGlobalStatus(message) {
            // Create or update status indicator
            let status = document.getElementById('globalStatus');
            if (!status) {
                status = document.createElement('div');
                status.id = 'globalStatus';
                status.style.cssText = `
                    position: fixed;
                    bottom: 70px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: var(--accent);
                    color: var(--bg-dark);
                    padding: 12px 24px;
                    border-radius: 4px;
                    font-family: 'Space Mono', monospace;
                    font-size: 11px;
                    font-weight: 700;
                    text-transform: uppercase;
                    letter-spacing: 1px;
                    z-index: 9999;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                `;
                document.body.appendChild(status);
            }
            status.textContent = message;
            status.style.opacity = '1';
            setTimeout(() => {
                status.style.opacity = '0';
            }, 3000);
        }

        // ==========================================
        // IMAGE URL FUNCTIONS
        // ==========================================

        function loadImageFromUrlDirect(frameId, url) {
            const visual = document.querySelector(`.frame-visual[data-frame-id="${frameId}"]`);

            if (!visual || !url) return;

            // Remove existing image
            const existingImg = visual.querySelector('.frame-image');
            if (existingImg) existingImg.remove();

            // Create new image
            const img = document.createElement('img');
            img.src = url;
            img.className = 'frame-image';
            img.onerror = () => {
                console.warn('Could not load image:', url);
                img.remove();
                const visualContent = visual.querySelector('.visual-content');
                if (visualContent) visualContent.style.opacity = '1';
            };
            img.onload = () => {
                // Hide placeholder
                const visualContent = visual.querySelector('.visual-content');
                if (visualContent) visualContent.style.opacity = '0';
            };
            visual.appendChild(img);
        }

        function clearImage(frameId) {
            const visual = document.querySelector(`.frame-visual[data-frame-id="${frameId}"]`);

            // Remove from memory and localStorage
            delete imageUrls[frameId];
            localStorage.removeItem(`storyboard-img-${frameId}`);

            if (visual) {
                const img = visual.querySelector('.frame-image');
                if (img) img.remove();

                const visualContent = visual.querySelector('.visual-content');
                if (visualContent) visualContent.style.opacity = '1';
            }

            // Auto-save to URL
            saveToUrl();
        }

        // ==========================================
        // URL INPUT FUNCTIONS
        // ==========================================

        function loadImageFromInput(frameId) {
            const input = document.querySelector(`.image-url-input[data-frame-id="${frameId}"]`);
            if (!input || !input.value.trim()) return;

            const url = input.value.trim();
            imageUrls[frameId] = url;
            loadImageFromUrlDirect(frameId, url);
            saveToUrl();
            showGlobalStatus('Image loaded!');
        }

        function clearImageInput(frameId) {
            const input = document.querySelector(`.image-url-input[data-frame-id="${frameId}"]`);
            if (input) input.value = '';
            clearImage(frameId);
        }

        // Initialize URL input event listeners
        document.querySelectorAll('.image-url-input').forEach(input => {
            const frameId = input.dataset.frameId;

            // Load on Enter key
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    loadImageFromInput(frameId);
                }
            });
        });

        // Auto-save comments to cloud on change
        let autoSaveTimeout;
        document.querySelectorAll('.cd-comments-textarea').forEach(textarea => {
            // Auto-save on blur
            textarea.addEventListener('blur', () => {
                saveToLocalStorage();
            });

            // Enter key to blur (Shift+Enter for new line)
            textarea.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    textarea.blur();
                }
            });
        });

        // ==========================================
        // IMGUR AUTO-UPLOAD
        // ==========================================

        // Imgur Client ID (anonymous uploads, no account needed)
        const IMGUR_CLIENT_ID = 'c45790ea498a46a';

        async function uploadToImgur(file) {
            showGlobalStatus('Uploading to Imgur...');

            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch('https://api.imgur.com/3/image', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Client-ID ${IMGUR_CLIENT_ID}`
                    },
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showGlobalStatus('Image uploaded to Imgur!');
                    return data.data.link;
                } else {
                    throw new Error(data.data.error || 'Upload failed');
                }
            } catch (error) {
                console.error('Imgur upload error:', error);
                showGlobalStatus('Upload failed - try again or use URL');
                return null;
            }
        }

        // Load data on page load - cloud auto-loads, this is backup
        function initializeData() {
            // Try localStorage backup first (instant), cloud will override
            loadFromLocalBackup();
        }

        function loadFromLocalStorage() {
            // Legacy - not used anymore, keeping for compatibility
            document.querySelectorAll('.frame-visual').forEach(visual => {
                const frameId = visual.dataset.frameId;
                const savedUrl = localStorage.getItem(`storyboard-img-${frameId}`);
                if (savedUrl) {
                    imageUrls[frameId] = savedUrl;
                    loadImageFromUrlDirect(frameId, savedUrl);
                }
            });

            document.querySelectorAll('.cd-comments-textarea').forEach(textarea => {
                const commentId = textarea.dataset.commentId;
                const savedComment = localStorage.getItem(`storyboard-comment-${commentId}`);
                if (savedComment) {
                    textarea.value = savedComment;
                }
            });
        }

        window.addEventListener('DOMContentLoaded', initializeData);

        // Also try loading immediately in case DOMContentLoaded already fired
        if (document.readyState !== 'loading') {
            initializeData();
        }

        // ==========================================
        // EDITABLE TEXT FUNCTIONALITY
        // ==========================================

        // Make text elements editable
        function initEditableText() {
            let editableCounter = 0;

            // Make titles, descriptions, and notes editable
            document.querySelectorAll('.frame-title, .frame-description, .frame-notes, .concept-item p, .idea-block p, .endcard-line').forEach(el => {
                if (!el.hasAttribute('contenteditable')) {
                    el.setAttribute('contenteditable', 'true');
                    // Generate unique ID if not present
                    if (!el.dataset.editableId) {
                        const frameEl = el.closest('.frame');
                        const tabEl = el.closest('.tab-content');
                        const tabId = tabEl ? tabEl.id : 'unknown';
                        const frameNum = frameEl ? frameEl.dataset.frame : editableCounter++;
                        const type = el.classList.contains('frame-title') ? 'title' :
                                     el.classList.contains('frame-description') ? 'desc' :
                                     el.classList.contains('frame-notes') ? 'notes' :
                                     el.classList.contains('endcard-line') ? 'endcard' : 'text';
                        el.dataset.editableId = `${tabId}-${frameNum}-${type}`;
                    }
                }
            });

            // Add blur event listener to save on edit
            document.querySelectorAll('[contenteditable="true"]').forEach(el => {
                el.addEventListener('blur', () => {
                    saveToLocalStorage();
                    showGlobalStatus('Saved locally');
                });
            });
        }

        // Save all data to localStorage
        function saveToLocalStorage() {
            try {
                const data = getAllData();
                localStorage.setItem('storyboard-data', JSON.stringify(data));
            } catch (e) {
                console.warn('Could not save to localStorage', e);
            }
        }

        // Load all data from localStorage
        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('storyboard-data');
                if (saved) {
                    const data = JSON.parse(saved);
                    setAllData(data);
                    return true;
                }
            } catch (e) {
                console.warn('Could not load from localStorage', e);
            }
            return false;
        }

        // Initialize editable text on load
        function initAll() {
            initEditableText();
            initNotes();
            initStatusBadges();
            loadFromLocalStorage();
        }

        window.addEventListener('DOMContentLoaded', initAll);
        if (document.readyState !== 'loading') {
            initAll();
        }

        // ==========================================
        // NEW BRIEF / TAB MANAGEMENT
        // ==========================================

        function showNewBriefModal() {
            document.getElementById('newBriefModal').classList.add('show');
            document.getElementById('newBriefClient').focus();
        }

        function hideNewBriefModal() {
            document.getElementById('newBriefModal').classList.remove('show');
            document.getElementById('newBriefClient').value = '';
            document.getElementById('newBriefTitle').value = '';
        }

        function createNewBrief() {
            const client = document.getElementById('newBriefClient').value.trim();
            const title = document.getElementById('newBriefTitle').value.trim();

            if (!client) {
                alert('Please enter a client name');
                return;
            }

            const tabId = client.toLowerCase().replace(/[^a-z0-9]/g, '-');

            // Check if tab already exists
            if (document.getElementById(tabId)) {
                alert('A brief for this client already exists');
                return;
            }

            // Create new tab button
            const tabNav = document.getElementById('tabNav');
            const addBtn = tabNav.querySelector('.add-tab-btn');
            const newTabBtn = document.createElement('button');
            newTabBtn.className = 'tab-btn';
            newTabBtn.dataset.tab = tabId;
            newTabBtn.innerHTML = `${client} <span class="status-container"><span class="wip-badge">WIP<span class="remove-badge" onclick="removeStatus(event, '${tabId}')">×</span></span></span>`;
            tabNav.insertBefore(newTabBtn, addBtn);

            // Create new tab content
            const tabContent = document.createElement('div');
            tabContent.className = 'tab-content';
            tabContent.id = tabId;
            tabContent.innerHTML = createBriefTemplate(tabId, client, title || 'UNTITLED CAMPAIGN');

            // Insert before cloud bar
            const cloudBar = document.querySelector('.cloud-bar');
            document.body.insertBefore(tabContent, cloudBar);

            // Re-initialize tab switching
            initTabSwitching();
            initEditableText();
            initNotes();
            initFrameUploads();

            // Switch to new tab
            newTabBtn.click();

            hideNewBriefModal();
            showGlobalStatus(`Created brief: ${client}`);
            saveToLocalStorage();
        }

        function createBriefTemplate(tabId, client, title) {
            return `
        <header class="header">
            <div class="header-content">
                <div class="project-info">
                    <h1>Spec Campaign Storyboard</h1>
                    <div class="project-title" contenteditable="true" data-editable-id="${tabId}-title">${title.toUpperCase()}</div>
                    <div class="brief-actions">
                        <button class="share-btn" onclick="showShareModal('${tabId}')"><span>↗</span> Share</button>
                        <button class="brief-action-btn archive" onclick="archiveBrief('${tabId}')">Archive</button>
                        <button class="brief-action-btn danger" onclick="deleteBrief('${tabId}')">Delete</button>
                    </div>
                </div>
                <div class="meta">
                    CLIENT: <span contenteditable="true" data-editable-id="${tabId}-client">${client}</span><br>
                    FORMAT: <span contenteditable="true" data-editable-id="${tabId}-format">:30-:60 Digital</span><br>
                    VERSION: <span contenteditable="true" data-editable-id="${tabId}-version">Draft 1.0</span><br>
                    DATE: <span contenteditable="true" data-editable-id="${tabId}-date">January 2026</span>
                </div>
            </div>
        </header>

        <!-- Executions Bar -->
        <div class="executions-bar">
            <div class="executions-nav" data-executions-for="${tabId}">
                <span class="executions-label">Executions</span>
                <button class="execution-tab active" data-execution="${tabId}-main" onclick="switchExecution('${tabId}', 'main')">
                    :30 <span class="frame-count">(1)</span>
                    <span class="execution-menu-trigger" onclick="event.stopPropagation(); toggleExecutionMenu(this)">▾</span>
                    <div class="execution-menu">
                        <div class="execution-menu-item" onclick="renameExecution('${tabId}')">Rename</div>
                        <div class="execution-menu-item" onclick="duplicateExecution('${tabId}')">Duplicate</div>
                        <div class="execution-menu-item danger" onclick="deleteExecution('${tabId}')">Delete</div>
                    </div>
                </button>
                <button class="execution-add" onclick="showExecutionModal('${tabId}')" title="Add execution">+</button>
            </div>
        </div>

        <main class="main">
            <section class="concept-section">
                <div class="section-label">Creative Brief</div>

                <div class="concept-grid">
                    <div class="concept-item">
                        <h3>Insight</h3>
                        <p contenteditable="true" data-editable-id="${tabId}-insight">Click to add insight...</p>
                    </div>
                    <div class="concept-item">
                        <h3>Idea</h3>
                        <p contenteditable="true" data-editable-id="${tabId}-idea">Click to add idea...</p>
                    </div>
                    <div class="concept-item">
                        <h3>Tone</h3>
                        <p contenteditable="true" data-editable-id="${tabId}-tone">Click to add tone...</p>
                    </div>
                </div>
            </section>

            <section class="storyboard-section">
                <div class="section-label">Storyboard</div>

                <div class="frames-container">
                    ${createFrameTemplate(tabId, 1)}
                </div>
                <button class="add-frame-btn" onclick="addFrame('${tabId}')">+ Add Frame</button>
            </section>

            <footer class="footer">
                <div class="footer-left">
                    ${client.toUpperCase()}: ${title.toUpperCase()} — Storyboard v1.0<br>
                    Prepared for Creative Review
                </div>
                <div class="footer-right">
                    <button class="delete-tab-btn" onclick="deleteBrief('${tabId}')">Delete Brief</button>
                    <button class="clear-data-btn" onclick="clearAllData('${tabId}')">Clear All Data</button>
                </div>
            </footer>
        </main>
            `;
        }

        function createFrameTemplate(tabId, frameNum) {
            const frameId = `${tabId}-${frameNum}`;
            return `
                    <div class="frame" data-frame="${frameNum}" data-tab="${tabId}">
                        <div class="frame-visual" data-frame-id="${frameId}">
                            <span class="frame-number">${String(frameNum).padStart(2, '0')}</span>
                            <button class="remove-image">Remove</button>
                            <div class="visual-content">
                                <div class="visual-description" contenteditable="true" data-editable-id="${frameId}-visual">
                                    Click to describe visual...
                                </div>
                            </div>
                            <button class="ai-generate-btn" onclick="event.stopPropagation(); toggleAIPanel('${frameId}')">
                                <span class="sparkle">✨</span> AI Generate
                            </button>
                            <span class="upload-hint">Click or drag image to upload</span>
                            <input type="file" class="frame-file-input" accept="image/*">
                        </div>
                        <div class="frame-details">
                            <span class="frame-type" contenteditable="true" data-editable-id="${frameId}-type">Scene</span>
                            <h2 class="frame-title" contenteditable="true" data-editable-id="${frameId}-title">FRAME ${frameNum}</h2>
                            <p class="frame-description" contenteditable="true" data-editable-id="${frameId}-desc">Click to add description...</p>

                            <!-- AI Generation Panel -->
                            <div class="ai-panel" data-ai-panel="${frameId}">
                                <div class="ai-panel-header">
                                    <span class="ai-panel-title"><span>✨</span> AI Image Generation</span>
                                    <button class="ai-panel-close" onclick="closeAIPanel('${frameId}')">×</button>
                                </div>
                                <div class="ai-panel-body">
                                    <div class="ai-model-selector">
                                        <span class="ai-model-label">Select Model</span>
                                        <div class="ai-model-options">
                                            <div class="ai-model-option selected" data-model="nanobananapro" onclick="selectAIModel('${frameId}', 'nanobananapro', this)">
                                                <div class="model-name">NanoBananaPro</div>
                                                <div class="model-desc">Fast, stylized</div>
                                            </div>
                                            <div class="ai-model-option" data-model="seedream" onclick="selectAIModel('${frameId}', 'seedream', this)">
                                                <div class="model-name">Seedream 4.5</div>
                                                <div class="model-desc">Photorealistic</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="ai-references">
                                        <span class="ai-references-label">
                                            Reference Images <span class="ai-references-count" data-ref-count="${frameId}">(0/5)</span>
                                        </span>
                                        <div class="ai-references-grid" data-refs="${frameId}">
                                            <div class="ai-reference-add" onclick="addAIReference('${frameId}')">
                                                <span class="ai-reference-add-icon">+</span>
                                                <span class="ai-reference-add-text">Add Ref</span>
                                                <input type="file" class="ai-ref-input" accept="image/*" style="display:none">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="ai-prompt">
                                        <span class="ai-prompt-label">
                                            Prompt
                                            <span class="ai-prompt-auto" onclick="autoFillPrompt('${frameId}')">↻ Auto-fill from description</span>
                                        </span>
                                        <textarea class="ai-prompt-textarea" data-prompt="${frameId}" placeholder="Describe the image you want to generate..."></textarea>
                                    </div>
                                    <button class="ai-generate-submit" onclick="generateAIImage('${frameId}')">
                                        <span>✨</span> Generate Image
                                    </button>
                                    <div class="ai-status" data-status="${frameId}">
                                        <div class="ai-status-spinner"></div>
                                        <span class="ai-status-text">Generating...</span>
                                    </div>
                                </div>
                            </div>

                            <div class="frame-notes" data-notes-id="${frameId}">
                                <strong>Production Notes</strong>
                                <ul>
                                    <li class="note-item" contenteditable="true">Click to add note...<span class="delete-note" onclick="deleteNote(event)">×</span></li>
                                </ul>
                                <button class="add-note-btn" onclick="addNote(this)">+ Add Note</button>
                            </div>
                            <div class="image-url-container">
                                <input type="text" class="image-url-input" data-frame-id="${frameId}" placeholder="Paste image URL (press Enter to load)">
                                <button class="image-url-btn" onclick="loadImageFromInput('${frameId}')">Load</button>
                                <button class="image-url-btn clear" onclick="clearImageInput('${frameId}')">Clear</button>
                            </div>
                            <div class="cd-comments">
                                <div class="cd-comments-header">
                                    <span class="cd-comments-label">CD Comments</span>
                                    <span class="cd-comments-status">Saved</span>
                                </div>
                                <textarea class="cd-comments-textarea" data-comment-id="${frameId}" placeholder="Add feedback, notes, or questions..."></textarea>
                            </div>
                            <button class="delete-tab-btn" style="margin-top: 16px;" onclick="deleteFrame(this)">Delete Frame</button>
                        </div>
                    </div>
            `;
        }

        function addFrame(tabId) {
            const container = document.querySelector(`#${tabId} .frames-container`);
            const existingFrames = container.querySelectorAll('.frame');
            const newFrameNum = existingFrames.length + 1;

            const frameHtml = createFrameTemplate(tabId, newFrameNum);
            container.insertAdjacentHTML('beforeend', frameHtml);

            // Re-initialize
            initEditableText();
            initNotes();
            initFrameUploads();

            // Scroll to new frame
            const newFrame = container.querySelector(`.frame[data-frame="${newFrameNum}"]`);
            if (newFrame) {
                newFrame.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            showGlobalStatus('Frame added');
            saveToLocalStorage();
        }

        function deleteFrame(btn) {
            const frame = btn.closest('.frame');
            if (!frame) {
                console.error('Could not find frame to delete');
                return;
            }

            if (!confirm('Delete this frame? This cannot be undone.')) return;

            const container = frame.closest('.frames-container');
            frame.remove();

            // Renumber remaining frames
            if (container) {
                const frames = container.querySelectorAll('.frame');
                frames.forEach((f, i) => {
                    const num = i + 1;
                    f.dataset.frame = num;
                    const numEl = f.querySelector('.frame-number');
                    if (numEl) numEl.textContent = String(num).padStart(2, '0');
                });
            }

            showGlobalStatus('Frame deleted');
            saveToLocalStorage();
        }

        // ==========================================
        // NOTES SECTION MANAGEMENT
        // ==========================================

        function initNoteSections() {
            document.querySelectorAll('.frame').forEach(frame => {
                const details = frame.querySelector('.frame-details');
                if (!details) return;

                const notesSection = frame.querySelector('.frame-notes');
                const description = frame.querySelector('.frame-description');

                if (notesSection) {
                    // Add remove button if not already there
                    if (!notesSection.querySelector('.remove-notes-btn')) {
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'remove-notes-btn';
                        removeBtn.textContent = '× Remove';
                        removeBtn.onclick = () => removeNotesSection(frame);
                        notesSection.appendChild(removeBtn);
                    }
                } else {
                    // Add "Add Notes" button if not already there
                    if (!details.querySelector('.add-notes-btn')) {
                        const addBtn = document.createElement('button');
                        addBtn.className = 'add-notes-btn';
                        addBtn.textContent = '+ Add Notes';
                        addBtn.onclick = () => addNotesSection(frame);
                        // Insert after description
                        if (description && description.nextSibling) {
                            details.insertBefore(addBtn, description.nextSibling);
                        } else {
                            details.appendChild(addBtn);
                        }
                    }
                }
            });
        }

        function addNotesSection(frame) {
            const details = frame.querySelector('.frame-details');
            const addBtn = details.querySelector('.add-notes-btn');
            const description = frame.querySelector('.frame-description');

            const notesSection = document.createElement('div');
            notesSection.className = 'frame-notes';
            notesSection.innerHTML = `
                <strong contenteditable="true">Production Notes</strong>
                <ul>
                    <li class="note-item" contenteditable="true">Add your first note...<span class="delete-note" onclick="deleteNote(event)">×</span></li>
                </ul>
                <button class="add-note-btn" onclick="addNote(this)">+ Add Note</button>
                <button class="remove-notes-btn" onclick="removeNotesSection(this.closest('.frame'))">× Remove</button>
            `;

            // Insert after description
            if (description && description.nextSibling) {
                details.insertBefore(notesSection, description.nextSibling);
            } else {
                details.appendChild(notesSection);
            }

            // Remove the add button
            if (addBtn) addBtn.remove();

            showGlobalStatus('Notes section added');
            triggerAutoSave();
        }

        function removeNotesSection(frame) {
            const notesSection = frame.querySelector('.frame-notes');
            if (!notesSection) return;

            notesSection.remove();

            // Add the "Add Notes" button back
            const details = frame.querySelector('.frame-details');
            const description = frame.querySelector('.frame-description');

            const addBtn = document.createElement('button');
            addBtn.className = 'add-notes-btn';
            addBtn.textContent = '+ Add Notes';
            addBtn.onclick = () => addNotesSection(frame);

            if (description && description.nextSibling) {
                details.insertBefore(addBtn, description.nextSibling);
            } else {
                details.appendChild(addBtn);
            }

            showGlobalStatus('Notes section removed');
            triggerAutoSave();
        }

        function deleteBrief(tabId) {
            if (!confirm(`Delete the entire "${tabId}" brief? This cannot be undone.`)) return;

            // Remove tab button
            const tabBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
            if (tabBtn) tabBtn.remove();

            // Remove tab content
            const tabContent = document.getElementById(tabId);
            if (tabContent) tabContent.remove();

            // Switch to first available tab
            const firstTab = document.querySelector('.tab-btn');
            if (firstTab) firstTab.click();

            showGlobalStatus('Brief deleted');
            saveToLocalStorage();
        }

        function initTabSwitching() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabBtns.forEach(btn => {
                btn.onclick = () => {
                    const tabId = btn.dataset.tab;

                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));

                    btn.classList.add('active');
                    const content = document.getElementById(tabId);
                    if (content) content.classList.add('active');

                    window.scrollTo(0, 0);
                };
            });
        }

        // ==========================================
        // STATUS BADGE MANAGEMENT
        // ==========================================

        function initStatusBadges() {
            // Add click to add status on empty status containers
            document.querySelectorAll('.tab-btn').forEach(btn => {
                const container = btn.querySelector('.status-container');
                if (container && !container.querySelector('.wip-badge')) {
                    // Add the "+" button for adding status
                    if (!container.querySelector('.add-status-btn')) {
                        const addBtn = document.createElement('span');
                        addBtn.className = 'add-status-btn';
                        addBtn.textContent = '+';
                        addBtn.onclick = (e) => {
                            e.stopPropagation();
                            showStatusDropdown(e, btn.dataset.tab);
                        };
                        container.appendChild(addBtn);
                    }
                }
            });
        }

        function showStatusDropdown(e, tabId) {
            // Remove any existing dropdown
            const existing = document.querySelector('.status-dropdown');
            if (existing) existing.remove();

            const dropdown = document.createElement('div');
            dropdown.className = 'status-dropdown show';
            dropdown.innerHTML = `
                <div class="status-option" onclick="addStatus('${tabId}', 'WIP')">WIP</div>
                <div class="status-option" onclick="addStatus('${tabId}', 'DRAFT')">Draft</div>
                <div class="status-option" onclick="addStatus('${tabId}', 'REVIEW')">Review</div>
                <div class="status-option" onclick="addStatus('${tabId}', 'APPROVED')">Approved</div>
            `;

            const btn = e.target;
            btn.style.position = 'relative';
            btn.appendChild(dropdown);

            // Close on outside click
            setTimeout(() => {
                document.addEventListener('click', function closeDropdown(ev) {
                    if (!dropdown.contains(ev.target)) {
                        dropdown.remove();
                        document.removeEventListener('click', closeDropdown);
                    }
                });
            }, 10);
        }

        function addStatus(tabId, status) {
            const tabBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
            if (!tabBtn) return;

            const container = tabBtn.querySelector('.status-container');
            if (!container) return;

            // Clear container
            container.innerHTML = `<span class="wip-badge">${status}<span class="remove-badge" onclick="removeStatus(event, '${tabId}')">×</span></span>`;

            showGlobalStatus(`Status: ${status}`);
            saveToLocalStorage();
        }

        function removeStatus(e, tabId) {
            e.stopPropagation();

            const tabBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
            if (!tabBtn) return;

            const container = tabBtn.querySelector('.status-container');
            if (!container) return;

            container.innerHTML = '';
            initStatusBadges();

            showGlobalStatus('Status removed');
            saveToLocalStorage();
        }

        // ==========================================
        // NOTES MANAGEMENT
        // ==========================================

        function initNotes() {
            // Make sure all note items have delete buttons
            document.querySelectorAll('.frame-notes li').forEach(li => {
                if (!li.classList.contains('note-item')) {
                    li.classList.add('note-item');
                }
                if (!li.querySelector('.delete-note')) {
                    const deleteBtn = document.createElement('span');
                    deleteBtn.className = 'delete-note';
                    deleteBtn.textContent = '×';
                    deleteBtn.onclick = (e) => deleteNote(e);
                    li.appendChild(deleteBtn);
                }
                if (!li.hasAttribute('contenteditable')) {
                    li.setAttribute('contenteditable', 'true');
                }
            });

            // Add "Add Note" button to all frame-notes that don't have one
            document.querySelectorAll('.frame-notes').forEach(notes => {
                if (!notes.querySelector('.add-note-btn')) {
                    const addBtn = document.createElement('button');
                    addBtn.className = 'add-note-btn';
                    addBtn.textContent = '+ Add Note';
                    addBtn.onclick = function() { addNote(this); };
                    notes.appendChild(addBtn);
                }
            });
        }

        function addNote(btn) {
            const ul = btn.previousElementSibling;
            if (!ul || ul.tagName !== 'UL') return;

            const li = document.createElement('li');
            li.className = 'note-item';
            li.setAttribute('contenteditable', 'true');
            li.innerHTML = 'New note...<span class="delete-note" onclick="deleteNote(event)">×</span>';
            ul.appendChild(li);

            // Focus the new note
            li.focus();

            // Select all text
            const range = document.createRange();
            range.selectNodeContents(li.firstChild);
            const sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);

            saveToLocalStorage();
        }

        function deleteNote(e) {
            e.stopPropagation();
            const li = e.target.closest('li');
            if (!li) return;

            const ul = li.closest('ul');
            li.remove();

            // Make sure there's always at least one note
            if (ul && ul.children.length === 0) {
                const newLi = document.createElement('li');
                newLi.className = 'note-item';
                newLi.setAttribute('contenteditable', 'true');
                newLi.innerHTML = 'Click to add note...<span class="delete-note" onclick="deleteNote(event)">×</span>';
                ul.appendChild(newLi);
            }

            saveToLocalStorage();
        }

        // ==========================================
        // FRAME UPLOAD RE-INITIALIZATION
        // ==========================================

        function initFrameUploads() {
            document.querySelectorAll('.frame-visual').forEach(visual => {
                // Skip if already initialized
                if (visual.dataset.initialized) return;
                visual.dataset.initialized = 'true';

                const fileInput = visual.querySelector('.frame-file-input');
                const frameId = visual.dataset.frameId;

                // Click to upload
                visual.addEventListener('click', (e) => {
                    if (e.target.classList.contains('remove-image')) return;
                    if (e.target.classList.contains('delete-note')) return;
                    if (e.target.hasAttribute('contenteditable')) return;
                    fileInput.click();
                });

                // File input change
                fileInput.addEventListener('change', async (e) => {
                    if (e.target.files && e.target.files[0]) {
                        await handleImageUpload(e.target.files[0], visual, frameId);
                    }
                });

                // Drag and drop
                visual.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    visual.classList.add('dragover');
                });

                visual.addEventListener('dragleave', () => {
                    visual.classList.remove('dragover');
                });

                visual.addEventListener('drop', async (e) => {
                    e.preventDefault();
                    visual.classList.remove('dragover');
                    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                        await handleImageUpload(e.dataTransfer.files[0], visual, frameId);
                    }
                });

                // Remove image button
                const removeBtn = visual.querySelector('.remove-image');
                if (removeBtn) {
                    removeBtn.onclick = (e) => {
                        e.stopPropagation();
                        clearImage(frameId);
                    };
                }
            });

            // URL input listeners
            document.querySelectorAll('.image-url-input').forEach(input => {
                if (input.dataset.initialized) return;
                input.dataset.initialized = 'true';

                const frameId = input.dataset.frameId;
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        loadImageFromInput(frameId);
                    }
                });
            });
        }

        // Close modal on Escape or clicking outside
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                hideNewBriefModal();
            }
        });

        document.getElementById('newBriefModal').addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                hideNewBriefModal();
            }
        });

        // Enter to submit in modal
        document.getElementById('newBriefTitle').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                createNewBrief();
            }
        });

        // ==========================================
        // VIEW TOGGLE (List vs Grid)
        // ==========================================

        function setView(view) {
            const viewBtns = document.querySelectorAll('.view-btn');
            viewBtns.forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase() === view);
            });

            const containers = document.querySelectorAll('.frames-container');
            containers.forEach(container => {
                if (view === 'grid') {
                    container.classList.add('grid-view');
                } else {
                    container.classList.remove('grid-view');
                }
            });

            // Save preference
            localStorage.setItem('storyboard-view', view);
        }

        // Load view preference
        const savedView = localStorage.getItem('storyboard-view');
        if (savedView) {
            setView(savedView);
        }

        // ==========================================
        // ARCHIVE BRIEF
        // ==========================================

        function archiveBrief(tabId) {
            const tabBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
            if (!tabBtn) return;

            tabBtn.classList.toggle('archived');

            const isArchived = tabBtn.classList.contains('archived');
            const container = tabBtn.querySelector('.status-container');

            if (isArchived) {
                container.innerHTML = '<span class="wip-badge" style="background: rgba(100,100,100,0.3); color: var(--text-secondary);">ARCHIVED<span class="remove-badge" onclick="archiveBrief(\'' + tabId + '\'); event.stopPropagation();">×</span></span>';
                showGlobalStatus('Brief archived');
            } else {
                container.innerHTML = '';
                initStatusBadges();
                showGlobalStatus('Brief unarchived');
            }

            saveToLocalStorage();
        }

        // Update deleteBrief to show archive option
        function deleteBrief(tabId) {
            const choice = confirm(`Delete "${tabId}" brief permanently?\n\nClick OK to delete, or Cancel to archive instead.`);

            if (choice) {
                // Permanent delete
                const tabBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
                if (tabBtn) tabBtn.remove();

                const tabContent = document.getElementById(tabId);
                if (tabContent) tabContent.remove();

                const firstTab = document.querySelector('.tab-btn');
                if (firstTab) firstTab.click();

                showGlobalStatus('Brief deleted permanently');
            } else {
                // Archive instead
                archiveBrief(tabId);
            }

            saveToLocalStorage();
        }

        // ==========================================
        // PRESENTATION MODE
        // ==========================================

        let currentSlide = 0;
        let presentationFrames = [];

        function startPresentation() {
            const activeTab = document.querySelector('.tab-content.active');
            if (!activeTab) return;

            const frames = activeTab.querySelectorAll('.frame:not(.endcard)');
            presentationFrames = Array.from(frames);

            if (presentationFrames.length === 0) {
                showGlobalStatus('No frames to present');
                return;
            }

            // Get brief title
            const title = activeTab.querySelector('.project-title')?.textContent || 'Storyboard';
            document.getElementById('presentationTitle').textContent = title;

            // Build nav dots
            const nav = document.getElementById('presentationNav');
            nav.innerHTML = presentationFrames.map((_, i) =>
                `<div class="presentation-dot ${i === 0 ? 'active' : ''}" onclick="goToSlide(${i})"></div>`
            ).join('');

            currentSlide = 0;
            showSlide(0);

            document.getElementById('presentationMode').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function exitPresentation() {
            document.getElementById('presentationMode').classList.remove('active');
            document.body.style.overflow = '';
        }

        function showSlide(index) {
            if (index < 0 || index >= presentationFrames.length) return;

            currentSlide = index;
            const frame = presentationFrames[index];
            const container = document.getElementById('presentationFrame');

            // Get frame image or placeholder
            const frameVisual = frame.querySelector('.frame-visual');
            const img = frameVisual?.querySelector('.frame-image');
            const title = frame.querySelector('.frame-title')?.textContent || '';
            const desc = frame.querySelector('.frame-description')?.textContent || '';

            const frameType = frame.querySelector('.frame-type')?.textContent || '';
            const visualDesc = frame.querySelector('.visual-description')?.textContent || '';

            if (img && img.src) {
                container.innerHTML = `
                    <div class="presentation-split">
                        <div class="presentation-image">
                            <img src="${img.src}" alt="${title}">
                        </div>
                        <div class="presentation-text">
                            <span class="presentation-frame-type">${frameType}</span>
                            <h2>${title}</h2>
                            <p>${desc}</p>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="presentation-split no-image">
                        <div class="presentation-visual-desc">
                            <span class="presentation-frame-type">${frameType}</span>
                            <h2>${title}</h2>
                            <p class="visual-text">${visualDesc || desc}</p>
                        </div>
                    </div>
                `;
            }

            // Update counter
            document.getElementById('presentationCounter').textContent = `${index + 1} / ${presentationFrames.length}`;

            // Update dots
            document.querySelectorAll('.presentation-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
        }

        function nextSlide() {
            if (currentSlide < presentationFrames.length - 1) {
                showSlide(currentSlide + 1);
            }
        }

        function prevSlide() {
            if (currentSlide > 0) {
                showSlide(currentSlide - 1);
            }
        }

        function goToSlide(index) {
            showSlide(index);
        }

        // Keyboard navigation for presentation
        document.addEventListener('keydown', (e) => {
            const presentationMode = document.getElementById('presentationMode');
            if (!presentationMode.classList.contains('active')) return;

            if (e.key === 'Escape') {
                exitPresentation();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextSlide();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                prevSlide();
            }
        });

        // ==========================================
        // VERSION HISTORY
        // ==========================================

        let versions = [];
        const MAX_VERSIONS = 20;

        function saveVersion(label = 'Auto-save') {
            const data = getAllData();
            const version = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                label: label,
                data: JSON.parse(JSON.stringify(data))
            };

            versions.unshift(version);
            if (versions.length > MAX_VERSIONS) {
                versions = versions.slice(0, MAX_VERSIONS);
            }

            localStorage.setItem('storyboard-versions', JSON.stringify(versions));
            renderVersionHistory();
        }

        function loadVersions() {
            try {
                const saved = localStorage.getItem('storyboard-versions');
                if (saved) {
                    versions = JSON.parse(saved);
                }
            } catch (e) {
                console.warn('Could not load versions');
            }
        }

        function renderVersionHistory() {
            const list = document.getElementById('versionList');
            if (!list) return;

            if (versions.length === 0) {
                list.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">No versions yet</p>';
                return;
            }

            list.innerHTML = versions.map((v, i) => {
                const date = new Date(v.timestamp);
                const timeStr = date.toLocaleString();
                return `
                    <div class="version-item ${i === 0 ? 'current' : ''}" data-version-id="${v.id}">
                        <div class="version-time">${timeStr}</div>
                        <div class="version-label">${v.label}</div>
                        <div class="version-actions">
                            <button class="version-btn" onclick="restoreVersion(${v.id})">Restore</button>
                            <button class="version-btn" onclick="previewVersion(${v.id})">Preview</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function restoreVersion(versionId) {
            const version = versions.find(v => v.id === versionId);
            if (!version) return;

            if (!confirm('Restore this version? Current changes will be saved first.')) return;

            // Save current state first
            saveVersion('Before restore');

            // Restore
            setAllData(version.data);
            showGlobalStatus('Version restored');
        }

        function previewVersion(versionId) {
            // For now, just restore - could add preview modal later
            restoreVersion(versionId);
        }

        function toggleVersionHistory() {
            const panel = document.getElementById('versionHistory');
            panel.classList.toggle('open');
            if (panel.classList.contains('open')) {
                renderVersionHistory();
            }
        }

        // ==========================================
        // AUTO-SAVE
        // ==========================================

        let autoSaveTimer;
        const AUTO_SAVE_DELAY = 3000; // 3 seconds after last change

        function triggerAutoSave() {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                saveToLocalStorage();
                saveVersion('Auto-save');
                updateSaveStatus('Saved');
            }, AUTO_SAVE_DELAY);
            updateSaveStatus('Saving...');
        }

        function updateSaveStatus(status) {
            const statusEl = document.getElementById('saveStatus');
            if (statusEl) {
                statusEl.textContent = status;
                statusEl.classList.add('visible');
                if (status === 'Saved') {
                    setTimeout(() => statusEl.classList.remove('visible'), 2000);
                }
            }
        }

        // Hook auto-save to all editable elements
        document.addEventListener('input', (e) => {
            if (e.target.hasAttribute('contenteditable') ||
                e.target.classList.contains('cd-comments-textarea') ||
                e.target.classList.contains('comment-input')) {
                triggerAutoSave();
            }
        });

        // ==========================================
        // DUPLICATE BRIEF
        // ==========================================

        function duplicateCurrentBrief() {
            const activeTab = document.querySelector('.tab-content.active');
            if (!activeTab) return;

            const tabId = activeTab.id;
            const title = activeTab.querySelector('.project-title')?.textContent || 'Untitled';
            const client = activeTab.querySelector('[data-editable-id$="-client"]')?.textContent || 'Client';

            const newClient = client + ' (Copy)';
            const newTabId = newClient.toLowerCase().replace(/[^a-z0-9]/g, '-');

            // Check if exists
            if (document.getElementById(newTabId)) {
                showGlobalStatus('Duplicate already exists');
                return;
            }

            // Clone the tab content
            const clone = activeTab.cloneNode(true);
            clone.id = newTabId;
            clone.classList.remove('active');

            // Update all IDs in the clone
            clone.querySelectorAll('[data-editable-id]').forEach(el => {
                el.dataset.editableId = el.dataset.editableId.replace(tabId, newTabId);
            });
            clone.querySelectorAll('[data-frame-id]').forEach(el => {
                el.dataset.frameId = el.dataset.frameId.replace(tabId, newTabId);
            });
            clone.querySelectorAll('[data-comment-id]').forEach(el => {
                el.dataset.commentId = el.dataset.commentId.replace(tabId, newTabId);
            });

            // Update title
            const titleEl = clone.querySelector('.project-title');
            if (titleEl) titleEl.textContent = title + ' (COPY)';

            // Update onclick handlers
            clone.innerHTML = clone.innerHTML.replace(new RegExp(`'${tabId}'`, 'g'), `'${newTabId}'`);

            // Create tab button
            const tabNav = document.getElementById('tabNav');
            const addBtn = tabNav.querySelector('.add-tab-btn');
            const newTabBtn = document.createElement('button');
            newTabBtn.className = 'tab-btn';
            newTabBtn.dataset.tab = newTabId;
            newTabBtn.innerHTML = `${newClient} <span class="status-container"><span class="wip-badge">WIP<span class="remove-badge" onclick="removeStatus(event, '${newTabId}')">×</span></span></span>`;
            tabNav.insertBefore(newTabBtn, addBtn);

            // Insert tab content
            const cloudBar = document.querySelector('.cloud-bar');
            document.body.insertBefore(clone, cloudBar);

            // Re-initialize
            initTabSwitching();
            initEditableText();
            initNotes();
            initFrameUploads();

            // Switch to new tab
            newTabBtn.click();

            showGlobalStatus('Brief duplicated');
            saveToLocalStorage();
        }

        // ==========================================
        // TEMPLATE LIBRARY
        // ==========================================

        let selectedTemplate = null;

        function showTemplateModal() {
            document.getElementById('templateModal').classList.add('show');
        }

        function hideTemplateModal() {
            document.getElementById('templateModal').classList.remove('show');
            selectedTemplate = null;
            document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
        }

        function selectTemplate(templateId) {
            selectedTemplate = templateId;
            document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
        }

        function applyTemplate() {
            if (!selectedTemplate) {
                showGlobalStatus('Select a template first');
                return;
            }

            const templates = {
                '30-sec': [
                    { type: 'Opening', title: 'THE HOOK', desc: 'Grab attention immediately...' },
                    { type: 'Build', title: 'THE TENSION', desc: 'Escalate the situation...' },
                    { type: 'Turn', title: 'THE REVEAL', desc: 'The twist or insight...' },
                    { type: 'Payoff', title: 'THE PAYOFF', desc: 'Deliver the punchline...' },
                    { type: 'End Card', title: 'END CARD', desc: 'Logo and tagline.' }
                ],
                '60-sec': [
                    { type: 'Opening', title: 'THE SETUP', desc: 'Establish the world...' },
                    { type: 'Build', title: 'THE PROBLEM', desc: 'Introduce the conflict...' },
                    { type: 'Escalation', title: 'THE ESCALATION', desc: 'Things get worse...' },
                    { type: 'Turn', title: 'THE TURN', desc: 'A shift happens...' },
                    { type: 'Climax', title: 'THE CLIMAX', desc: 'Peak moment...' },
                    { type: 'Resolution', title: 'THE RESOLUTION', desc: 'Satisfying conclusion...' },
                    { type: 'Payoff', title: 'THE PAYOFF', desc: 'Final beat...' },
                    { type: 'End Card', title: 'END CARD', desc: 'Logo and tagline.' }
                ],
                'social': [
                    { type: 'Hook', title: 'THE HOOK', desc: 'Stop the scroll...' },
                    { type: 'Punch', title: 'THE PUNCH', desc: 'Deliver fast...' },
                    { type: 'End Card', title: 'END CARD', desc: 'Logo.' }
                ],
                'manifesto': [
                    { type: 'Opening', title: 'THE WORLD', desc: 'Establish tone and setting...' },
                    { type: 'Build', title: 'THE TENSION', desc: 'What\'s wrong with the world...' },
                    { type: 'Build', title: 'THE SHIFT', desc: 'But there\'s another way...' },
                    { type: 'Climax', title: 'THE VISION', desc: 'Show the better future...' },
                    { type: 'Resolve', title: 'THE CALL', desc: 'Invite them in...' },
                    { type: 'End Card', title: 'END CARD', desc: 'Logo and manifesto line.' }
                ]
            };

            const template = templates[selectedTemplate];
            if (!template) return;

            // Show modal for brief details
            hideTemplateModal();
            showNewBriefModal();

            // Store template to apply after brief is created
            window.pendingTemplate = template;
            showGlobalStatus('Enter brief details, template will be applied');
        }

        // ==========================================
        // TIMELINE VIEW
        // ==========================================

        function setView(view) {
            const viewBtns = document.querySelectorAll('.view-btn');
            viewBtns.forEach(btn => {
                const btnView = btn.textContent.toLowerCase().trim();
                btn.classList.toggle('active', btnView === view);
            });

            const containers = document.querySelectorAll('.frames-container');
            const timelineViews = document.querySelectorAll('.timeline-view');

            containers.forEach(container => {
                container.classList.remove('grid-view');
                container.style.display = view === 'timeline' ? 'none' : '';
                if (view === 'grid') {
                    container.classList.add('grid-view');
                }
            });

            // Build timeline if needed
            if (view === 'timeline') {
                buildTimelineView();
            }

            timelineViews.forEach(tv => {
                tv.classList.toggle('active', view === 'timeline');
            });

            localStorage.setItem('storyboard-view', view);
        }

        function buildTimelineView() {
            const activeTab = document.querySelector('.tab-content.active');
            if (!activeTab) return;

            let timelineView = activeTab.querySelector('.timeline-view');
            if (!timelineView) {
                timelineView = document.createElement('div');
                timelineView.className = 'timeline-view active';
                const storyboardSection = activeTab.querySelector('.storyboard-section');
                if (storyboardSection) {
                    storyboardSection.insertBefore(timelineView, storyboardSection.querySelector('.frames-container'));
                }
            }

            const frames = activeTab.querySelectorAll('.frame');
            const track = document.createElement('div');
            track.className = 'timeline-track';

            frames.forEach((frame, i) => {
                const img = frame.querySelector('.frame-image');
                const title = frame.querySelector('.frame-title')?.textContent || `Frame ${i + 1}`;
                const timing = frame.querySelector('.frame-timing')?.textContent || '';

                const thumbHtml = img && img.src
                    ? `<img src="${img.src}" alt="${title}">`
                    : `<div class="timeline-thumbnail-placeholder">${title}</div>`;

                track.innerHTML += `
                    <div class="timeline-frame" onclick="scrollToFrame(${i})">
                        <div class="timeline-thumbnail">${thumbHtml}</div>
                        <div class="timeline-info">
                            <div class="timeline-number">${String(i + 1).padStart(2, '0')}</div>
                            <div class="timeline-label">${title}</div>
                        </div>
                        ${timing ? `<div class="timeline-time" data-time="${timing}"></div>` : ''}
                    </div>
                `;
            });

            timelineView.innerHTML = '';
            timelineView.appendChild(track);
        }

        function scrollToFrame(index) {
            const activeTab = document.querySelector('.tab-content.active');
            if (!activeTab) return;

            const frames = activeTab.querySelectorAll('.frame');
            if (frames[index]) {
                setView('list');
                setTimeout(() => {
                    frames[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }

        // ==========================================
        // THREADED COMMENTS
        // ==========================================

        function initComments() {
            // Convert old textarea-based comments to new threaded structure
            document.querySelectorAll('.cd-comments').forEach(container => {
                if (container.dataset.converted === 'true') return;
                container.dataset.converted = 'true';

                const textarea = container.querySelector('.cd-comments-textarea');
                if (!textarea) return;

                const commentId = textarea.dataset.commentId;
                const existingValue = textarea.value;

                // Replace with new structure
                const newSection = document.createElement('div');
                newSection.className = 'comments-section collapsed';
                newSection.dataset.commentsFor = commentId;
                newSection.innerHTML = `
                    <div class="comments-header" onclick="toggleComments(this)">
                        <span class="comments-toggle">▼</span>
                        <span>Comments</span>
                    </div>
                    <div class="comments-body">
                        <div class="comments-thread" data-thread-id="${commentId}"></div>
                        <div class="comment-input-row">
                            <input type="text" class="comment-input" placeholder="Add comment..." onkeydown="if(event.key==='Enter')postComment('${commentId}', this)">
                            <button class="comment-submit" onclick="postComment('${commentId}', this.previousElementSibling)">Post</button>
                        </div>
                    </div>
                `;

                container.replaceWith(newSection);

                // Load existing comments
                loadComments(commentId);

                // Migrate old textarea content if it had any
                if (existingValue && existingValue.trim()) {
                    saveComment(commentId, {
                        author: 'CD',
                        text: existingValue.trim(),
                        time: Date.now() - 86400000
                    });
                }
            });

            // Also init already-converted sections
            document.querySelectorAll('.comments-section').forEach(section => {
                const threadId = section.querySelector('[data-thread-id]')?.dataset.threadId;
                if (threadId) {
                    loadComments(threadId);
                }
            });
        }

        function loadComments(threadId) {
            try {
                const comments = JSON.parse(localStorage.getItem(`comments-${threadId}`) || '[]');
                renderComments(threadId, comments);
            } catch (e) {
                console.warn('Could not load comments');
            }
        }

        function toggleComments(header) {
            const section = header.closest('.comments-section');
            if (section) {
                section.classList.toggle('collapsed');
            }
        }

        function renderComments(threadId, comments) {
            const thread = document.querySelector(`[data-thread-id="${threadId}"]`);
            if (!thread) return;

            // Update comment count badge
            updateCommentBadge(threadId, comments.length);

            if (comments.length === 0) {
                thread.innerHTML = '';
                return;
            }

            thread.innerHTML = comments.map((c, i) => `
                <div class="comment-bubble">
                    <span class="comment-bubble-delete" onclick="deleteComment('${threadId}', ${i})">×</span>
                    <div class="comment-bubble-header">
                        <span class="comment-bubble-author">${c.author || 'CD'}</span>
                        <span class="comment-bubble-time">${formatTime(c.time)}</span>
                    </div>
                    <div class="comment-bubble-text">${escapeHtml(c.text)}</div>
                </div>
            `).join('');
        }

        function updateCommentBadge(threadId, count) {
            const section = document.querySelector(`[data-comments-for="${threadId}"]`);
            if (!section) return;

            const header = section.querySelector('.comments-header');
            if (!header) return;

            // Remove existing badge
            const existingBadge = header.querySelector('.comment-count-badge');
            if (existingBadge) existingBadge.remove();

            // Add badge if there are comments
            if (count > 0) {
                const badge = document.createElement('span');
                badge.className = 'comment-count-badge';
                badge.textContent = count;
                header.appendChild(badge);
            }
        }

        function postComment(threadId, inputEl) {
            if (!inputEl || !inputEl.value.trim()) return;

            saveComment(threadId, {
                author: 'You',
                text: inputEl.value.trim(),
                time: Date.now()
            });

            inputEl.value = '';
            inputEl.focus();
            triggerAutoSave();
        }

        function saveComment(threadId, comment) {
            const comments = JSON.parse(localStorage.getItem(`comments-${threadId}`) || '[]');
            comments.push(comment);
            localStorage.setItem(`comments-${threadId}`, JSON.stringify(comments));
            renderComments(threadId, comments);
        }

        function deleteComment(threadId, index) {
            const comments = JSON.parse(localStorage.getItem(`comments-${threadId}`) || '[]');
            comments.splice(index, 1);
            localStorage.setItem(`comments-${threadId}`, JSON.stringify(comments));
            renderComments(threadId, comments);
            triggerAutoSave();
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;

            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
            return date.toLocaleDateString();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ==========================================
        // REFERENCE FINDER (Eyecannndy Integration)
        // ==========================================

        const visualTechniques = [
            // Camera techniques
            { name: 'Slow Motion', slug: 'slow-motion', category: 'motion', desc: 'Action captured at high frame rate, played back slower', img: 'https://images.unsplash.com/photo-1551972873-b7e8754e8e26?w=400&h=225&fit=crop' },
            { name: 'Fast Motion', slug: 'undercranking', category: 'motion', desc: 'Sped-up footage creating urgency and energy', img: 'https://images.unsplash.com/photo-1536440136628-849c177e76a1?w=400&h=225&fit=crop' },
            { name: 'Whip Pan', slug: 'whip-pan', category: 'camera', desc: 'Rapid horizontal camera movement with motion blur', img: 'https://images.unsplash.com/photo-1478720568477-152d9b164e26?w=400&h=225&fit=crop' },
            { name: 'Dolly Zoom', slug: 'dolly-zoom', category: 'camera', desc: 'Camera moves while zooming opposite direction', img: 'https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?w=400&h=225&fit=crop' },
            { name: 'Tracking Shot', slug: 'tracking', category: 'camera', desc: 'Camera follows subject through space', img: 'https://images.unsplash.com/photo-1440404653325-ab127d49abc1?w=400&h=225&fit=crop' },
            { name: 'Handheld', slug: 'handheld', category: 'camera', desc: 'Unstabilized camera for raw authenticity', img: 'https://images.unsplash.com/photo-1485846234645-a62644f84728?w=400&h=225&fit=crop' },
            { name: 'Steadicam', slug: 'steadicam', category: 'camera', desc: 'Smooth floating camera movement', img: 'https://images.unsplash.com/photo-1500210600449-1d64b8898cde?w=400&h=225&fit=crop' },
            { name: 'Crane Shot', slug: 'crane', category: 'camera', desc: 'Elevated sweeping movement for reveals', img: 'https://images.unsplash.com/photo-1518676590629-3dcbd9c5a5c9?w=400&h=225&fit=crop' },
            { name: 'POV Shot', slug: 'pov', category: 'camera', desc: 'First-person perspective view', img: 'https://images.unsplash.com/photo-1516035069371-29a1b244cc32?w=400&h=225&fit=crop' },
            { name: 'Dutch Angle', slug: 'dutch-angle', category: 'camera', desc: 'Tilted camera creating unease', img: 'https://images.unsplash.com/photo-1524712245354-2c4e5e7121c0?w=400&h=225&fit=crop' },

            // Transitions
            { name: 'Match Cut', slug: 'match-cut', category: 'transition', desc: 'Visual element carries between scenes', img: 'https://images.unsplash.com/photo-1492691527719-9d1e07e534b4?w=400&h=225&fit=crop' },
            { name: 'Jump Cut', slug: 'jump-cut', category: 'transition', desc: 'Abrupt cut creating jarring time skip', img: 'https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?w=400&h=225&fit=crop' },
            { name: 'Smash Cut', slug: 'smash-cut', category: 'transition', desc: 'Sudden cut for dramatic contrast', img: 'https://images.unsplash.com/photo-1594909122845-11baa439b7bf?w=400&h=225&fit=crop' },
            { name: 'Cross Dissolve', slug: 'cross-dissolve', category: 'transition', desc: 'Gradual blend implying time passage', img: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=225&fit=crop' },
            { name: 'Wipe', slug: 'wipe', category: 'transition', desc: 'One shot pushes another off screen', img: 'https://images.unsplash.com/photo-1518005020951-eccb494ad742?w=400&h=225&fit=crop' },
            { name: 'Match Motion', slug: 'match-motion', category: 'transition', desc: 'Camera motion carries onto next cut', img: 'https://images.unsplash.com/photo-1505373877841-8d25f7d46678?w=400&h=225&fit=crop' },
            { name: 'L-Cut / J-Cut', slug: 'l-cut', category: 'transition', desc: 'Audio overlaps the visual cut', img: 'https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?w=400&h=225&fit=crop' },

            // Motion & Animation
            { name: 'Stop Motion', slug: 'stop-motion', category: 'motion', desc: 'Frame-by-frame animation of objects', img: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400&h=225&fit=crop' },
            { name: 'Time Lapse', slug: 'time-lapse', category: 'motion', desc: 'Extended time compressed into seconds', img: 'https://images.unsplash.com/photo-1507400492013-162706c8c05e?w=400&h=225&fit=crop' },
            { name: 'Hyperlapse', slug: 'hyperlapse', category: 'motion', desc: 'Moving time-lapse through space', img: 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=400&h=225&fit=crop' },
            { name: 'Motion Blur', slug: 'motion-blur', category: 'motion', desc: 'Blur from movement creating energy', img: 'https://images.unsplash.com/photo-1494438639946-1ebd1d20bf85?w=400&h=225&fit=crop' },
            { name: 'Freeze Frame', slug: 'freeze-frame', category: 'motion', desc: 'Action pauses for emphasis', img: 'https://images.unsplash.com/photo-1517604931442-7e0c8ed2963c?w=400&h=225&fit=crop' },
            { name: 'Speed Ramp', slug: 'speed-ramp', category: 'motion', desc: 'Smooth slow-to-fast transition', img: 'https://images.unsplash.com/photo-1547153760-18fc86324498?w=400&h=225&fit=crop' },
            { name: 'Reverse', slug: 'reverse', category: 'motion', desc: 'Footage played backwards', img: 'https://images.unsplash.com/photo-1550684376-efcbd6e3f031?w=400&h=225&fit=crop' },

            // Style & Look
            { name: 'Split Screen', slug: 'split-screen', category: 'style', desc: 'Multiple frames shown at once', img: 'https://images.unsplash.com/photo-1535016120720-40c646be5580?w=400&h=225&fit=crop' },
            { name: 'Picture in Picture', slug: 'pip', category: 'style', desc: 'Smaller frame within main frame', img: 'https://images.unsplash.com/photo-1611532736597-de2d4265fba3?w=400&h=225&fit=crop' },
            { name: 'Silhouette', slug: 'silhouette', category: 'style', desc: 'Dark shape against bright background', img: 'https://images.unsplash.com/photo-1500534623283-312aade485b7?w=400&h=225&fit=crop' },
            { name: 'High Contrast', slug: 'high-contrast', category: 'style', desc: 'Deep shadows, bright highlights', img: 'https://images.unsplash.com/photo-1509347528160-9a9e33742cdb?w=400&h=225&fit=crop' },
            { name: 'Desaturated', slug: 'desaturated', category: 'style', desc: 'Muted color for mood', img: 'https://images.unsplash.com/photo-1518156677180-95a2893f3e9f?w=400&h=225&fit=crop' },
            { name: 'Lens Flare', slug: 'lens-flare', category: 'style', desc: 'Light artifacts for warmth', img: 'https://images.unsplash.com/photo-1504384308090-c894fdcc538d?w=400&h=225&fit=crop' },
            { name: 'Anamorphic', slug: 'anamorphic', category: 'style', desc: 'Wide ratio with oval bokeh', img: 'https://images.unsplash.com/photo-1478720568477-152d9b164e26?w=400&h=225&fit=crop' },
            { name: 'Film Grain', slug: 'film-grain', category: 'style', desc: 'Textured organic vintage feel', img: 'https://images.unsplash.com/photo-1460661419201-fd4cecdf8a8b?w=400&h=225&fit=crop' },

            // Effects
            { name: 'Glitch', slug: 'glitch', category: 'effect', desc: 'Digital distortion effects', img: 'https://images.unsplash.com/photo-1550751827-4bd374c3f58b?w=400&h=225&fit=crop' },
            { name: 'Double Exposure', slug: 'double-exposure', category: 'effect', desc: 'Two images superimposed', img: 'https://images.unsplash.com/photo-1533134486753-c833f0ed4866?w=400&h=225&fit=crop' },
            { name: 'Light Leak', slug: 'light-leak', category: 'effect', desc: 'Film artifacts adding warmth', img: 'https://images.unsplash.com/photo-1516339901601-2e1b62dc0c45?w=400&h=225&fit=crop' },
            { name: 'Reflection', slug: 'reflection', category: 'effect', desc: 'Mirrored surfaces for depth', img: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=225&fit=crop' },
            { name: 'Rack Focus', slug: 'rack-focus', category: 'effect', desc: 'Focus shifts between subjects', img: 'https://images.unsplash.com/photo-1502982720700-bfff97f2ecac?w=400&h=225&fit=crop' },
            { name: 'Shallow DOF', slug: 'shallow-dof', category: 'effect', desc: 'Blurred background, creamy bokeh', img: 'https://images.unsplash.com/photo-1519681393784-d120267933ba?w=400&h=225&fit=crop' },
            { name: 'Deep Focus', slug: 'deep-focus', category: 'effect', desc: 'Everything sharp near to far', img: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=225&fit=crop' },
            { name: 'VHS/CRT', slug: 'vhs', category: 'effect', desc: 'Analog artifacts and scan lines', img: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400&h=225&fit=crop' },
            { name: 'Screen Recording', slug: 'screen-recording', category: 'effect', desc: 'Captured digital interface', img: 'https://images.unsplash.com/photo-1517694712202-14dd9538aa97?w=400&h=225&fit=crop' },
        ];

        let currentReferenceFrameId = null;
        let selectedTechnique = null;

        function showReferenceFinder(frameId) {
            currentReferenceFrameId = frameId;
            selectedTechnique = null;

            const modal = document.getElementById('referenceFinderModal');
            const grid = document.getElementById('techniquesGrid');
            const preview = document.getElementById('selectedTechniquePreview');
            const attachBtn = document.getElementById('attachTechniqueBtn');
            const search = document.getElementById('techniqueSearch');
            const panel = document.getElementById('techniquePreviewPanel');
            const iframe = document.getElementById('techniquePreviewIframe');

            // Reset state
            search.value = '';
            preview.innerHTML = 'No technique selected';
            attachBtn.disabled = true;

            // Reset iframe
            panel.classList.remove('has-content');
            iframe.src = '';

            // Reset category buttons
            document.querySelectorAll('.technique-category').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === 'all') btn.classList.add('active');
            });

            // Render techniques
            renderTechniques(visualTechniques);

            modal.classList.add('show');
        }

        function hideReferenceFinder() {
            document.getElementById('referenceFinderModal').classList.remove('show');
            currentReferenceFrameId = null;
            selectedTechnique = null;
        }

        function renderTechniques(techniques) {
            const grid = document.getElementById('techniquesGrid');
            grid.innerHTML = techniques.map(t => `
                <div class="technique-card ${selectedTechnique?.slug === t.slug ? 'selected' : ''}"
                     data-slug="${t.slug}"
                     onclick="selectTechnique('${t.slug}')">
                    <div class="technique-card-body">
                        <div class="technique-card-name">${t.name}</div>
                        <div class="technique-card-desc">${t.desc}</div>
                        <a class="technique-card-link" href="https://eyecannndy.com/technique/${t.slug}" target="_blank" onclick="event.stopPropagation()">
                            View on Eyecannndy ↗
                        </a>
                    </div>
                </div>
            `).join('');
        }

        function selectTechnique(slug) {
            const technique = visualTechniques.find(t => t.slug === slug);
            if (!technique) return;

            selectedTechnique = technique;

            // Update UI
            document.querySelectorAll('.technique-card').forEach(card => {
                card.classList.toggle('selected', card.dataset.slug === slug);
            });

            document.getElementById('selectedTechniquePreview').innerHTML =
                `Selected: <strong>${technique.name}</strong>`;
            document.getElementById('attachTechniqueBtn').disabled = false;

            // Load iframe preview
            const panel = document.getElementById('techniquePreviewPanel');
            const iframe = document.getElementById('techniquePreviewIframe');
            iframe.src = `https://eyecannndy.com/technique/${slug}`;
            panel.classList.add('has-content');
        }

        function filterTechniques() {
            const search = document.getElementById('techniqueSearch').value.toLowerCase();
            const activeCategory = document.querySelector('.technique-category.active')?.dataset.category || 'all';

            let filtered = visualTechniques;

            if (activeCategory !== 'all') {
                filtered = filtered.filter(t => t.category === activeCategory);
            }

            if (search) {
                filtered = filtered.filter(t =>
                    t.name.toLowerCase().includes(search) ||
                    t.desc.toLowerCase().includes(search)
                );
            }

            renderTechniques(filtered);
        }

        function filterByCategory(category) {
            document.querySelectorAll('.technique-category').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.category === category);
            });
            filterTechniques();
        }

        function attachSelectedTechnique() {
            if (!selectedTechnique || !currentReferenceFrameId) return;

            addTechniqueToFrame(currentReferenceFrameId, selectedTechnique);
            hideReferenceFinder();
            showGlobalStatus(`Added "${selectedTechnique.name}" technique`);
        }

        function addTechniqueToFrame(frameId, technique) {
            const frame = document.querySelector(`[data-frame-id="${frameId}"]`)?.closest('.frame');
            if (!frame) return;

            const details = frame.querySelector('.frame-details');
            if (!details) return;

            // Find or create techniques container
            let container = details.querySelector('.frame-techniques');
            if (!container) {
                container = document.createElement('div');
                container.className = 'frame-techniques';
                // Insert after frame-type
                const frameType = details.querySelector('.frame-type');
                if (frameType) {
                    frameType.after(container);
                } else {
                    details.prepend(container);
                }
            }

            // Check if already added
            if (container.querySelector(`[data-technique="${technique.slug}"]`)) {
                showGlobalStatus('Technique already added');
                return;
            }

            // Add tag
            const tag = document.createElement('span');
            tag.className = 'technique-tag';
            tag.dataset.technique = technique.slug;
            tag.innerHTML = `
                <a href="https://eyecannndy.com/technique/${technique.slug}" target="_blank" style="color: inherit; text-decoration: none;">${technique.name}</a>
                <span class="remove-tag" onclick="event.stopPropagation(); removeTechnique(this, '${technique.slug}')">×</span>
            `;
            container.appendChild(tag);

            // Save to localStorage
            saveTechniques(frameId);
        }

        function removeTechnique(btn, slug) {
            const tag = btn.closest('.technique-tag');
            const container = tag.closest('.frame-techniques');
            const frameId = container.closest('.frame').querySelector('[data-frame-id]')?.dataset.frameId;

            tag.remove();

            // Remove container if empty
            if (container.children.length === 0) {
                container.remove();
            }

            if (frameId) {
                saveTechniques(frameId);
            }

            showGlobalStatus('Technique removed');
        }

        function saveTechniques(frameId) {
            const frame = document.querySelector(`[data-frame-id="${frameId}"]`)?.closest('.frame');
            if (!frame) return;

            const container = frame.querySelector('.frame-techniques');
            const techniques = container ?
                Array.from(container.querySelectorAll('.technique-tag')).map(t => t.dataset.technique) : [];

            localStorage.setItem(`techniques-${frameId}`, JSON.stringify(techniques));
            triggerAutoSave();
        }

        function loadTechniques(frameId) {
            try {
                const slugs = JSON.parse(localStorage.getItem(`techniques-${frameId}`) || '[]');
                slugs.forEach(slug => {
                    const technique = visualTechniques.find(t => t.slug === slug);
                    if (technique) {
                        addTechniqueToFrame(frameId, technique);
                    }
                });
            } catch (e) {
                console.warn('Could not load techniques');
            }
        }

        function initReferenceFinder() {
            console.log('initReferenceFinder called');
            // Add "Find Reference" button to each frame
            const frames = document.querySelectorAll('.frame');
            console.log('Found frames:', frames.length);

            frames.forEach((frame, idx) => {
                const visual = frame.querySelector('.frame-visual');
                const details = frame.querySelector('.frame-details');
                const frameId = visual?.dataset.frameId;

                console.log(`Frame ${idx}: frameId=${frameId}, hasDetails=${!!details}`);

                if (!details || !frameId) return;

                // Check if already has button
                if (details.querySelector('.find-reference-btn')) {
                    console.log(`Frame ${frameId} already has button`);
                    return;
                }

                // Create button
                const btn = document.createElement('button');
                btn.className = 'find-reference-btn';
                btn.innerHTML = '<span class="icon">🎬</span> Find Reference';
                btn.onclick = () => showReferenceFinder(frameId);

                // Insert after frame-title (more reliable)
                const frameTitle = details.querySelector('.frame-title');
                const frameType = details.querySelector('.frame-type');
                if (frameTitle) {
                    frameTitle.after(btn);
                } else if (frameType) {
                    frameType.after(btn);
                } else {
                    details.prepend(btn);
                }

                console.log(`Added button to frame ${frameId}`);

                // Load saved techniques
                loadTechniques(frameId);
            });
        }

        // ==========================================
        // MOODBOARD
        // ==========================================

        let currentMoodboardId = null;

        function addMoodboardImage(boardId) {
            currentMoodboardId = boardId;
            const modal = document.getElementById('addReferenceModal');
            const linkSection = document.getElementById('linkInputSection');
            const options = document.getElementById('referenceOptions');
            const closeBtn = document.getElementById('referenceModalClose');

            // Reset modal state
            linkSection.classList.remove('show');
            options.style.display = 'flex';
            closeBtn.style.display = 'flex';
            document.getElementById('referenceLinkUrl').value = '';
            document.getElementById('referenceLinkTitle').value = '';

            modal.classList.add('show');
        }

        function hideAddReferenceModal() {
            document.getElementById('addReferenceModal').classList.remove('show');
            currentMoodboardId = null;
        }

        function selectReferenceType(type) {
            if (type === 'image') {
                hideAddReferenceModal();
                // Trigger file input
                const grid = document.querySelector(`[data-moodboard-id="${currentMoodboardId}"]`);
                if (!grid) return;

                const fileInput = grid.querySelector('.moodboard-file-input');
                if (fileInput) {
                    fileInput.onchange = async (e) => {
                        if (e.target.files && e.target.files[0]) {
                            await uploadMoodboardImage(currentMoodboardId, e.target.files[0]);
                        }
                    };
                    fileInput.click();
                }
            } else if (type === 'link') {
                // Show link input
                document.getElementById('referenceOptions').style.display = 'none';
                document.getElementById('referenceModalClose').style.display = 'none';
                document.getElementById('linkInputSection').classList.add('show');
                document.getElementById('referenceLinkUrl').focus();
            }
        }

        function addLinkReference() {
            const url = document.getElementById('referenceLinkUrl').value.trim();
            const title = document.getElementById('referenceLinkTitle').value.trim();

            if (!url) {
                showGlobalStatus('Please enter a URL');
                return;
            }

            // Basic URL validation
            let finalUrl = url;
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                finalUrl = 'https://' + url;
            }

            addMoodboardLinkItem(currentMoodboardId, finalUrl, title);
            saveMoodboard(currentMoodboardId);
            hideAddReferenceModal();
            showGlobalStatus('Link added to moodboard');
        }

        function addMoodboardLinkItem(boardId, url, title) {
            const grid = document.querySelector(`[data-moodboard-id="${boardId}"]`);
            if (!grid) return;

            const addBtn = grid.querySelector('.moodboard-add');

            // Extract domain for display
            let domain = '';
            try {
                domain = new URL(url).hostname.replace('www.', '');
            } catch(e) {
                domain = url;
            }

            // Use provided title or domain as fallback
            const displayTitle = title || domain;

            const item = document.createElement('div');
            item.className = 'moodboard-item link-item';
            item.setAttribute('data-link-url', url);
            item.setAttribute('data-link-title', title || '');
            item.innerHTML = `
                <div>
                    <img class="moodboard-link-favicon" src="https://www.google.com/s2/favicons?domain=${domain}&sz=64" alt="" onerror="this.style.display='none'">
                    <div class="moodboard-link-title">${escapeHtml(displayTitle)}</div>
                    <div class="moodboard-link-url">${escapeHtml(domain)}</div>
                </div>
                <span class="moodboard-link-open">↗</span>
                <button class="remove-moodboard" onclick="event.stopPropagation(); removeMoodboardItem(this, '${boardId}')">×</button>
            `;

            item.onclick = (e) => {
                if (!e.target.classList.contains('remove-moodboard')) {
                    window.open(url, '_blank');
                }
            };

            grid.insertBefore(item, addBtn);
            updateMoodboardCount(boardId);
        }

        async function uploadMoodboardImage(boardId, file) {
            showGlobalStatus('Uploading...');

            // Upload to Supabase
            const publicUrl = await uploadImageToSupabase(file, `moodboard-${boardId}-${Date.now()}`);

            if (publicUrl) {
                addMoodboardItem(boardId, publicUrl);
                saveMoodboard(boardId);
                showGlobalStatus('Added to moodboard');
            } else {
                // Fallback to base64
                const reader = new FileReader();
                reader.onload = (e) => {
                    addMoodboardItem(boardId, e.target.result);
                    saveMoodboard(boardId);
                    showGlobalStatus('Added to moodboard');
                };
                reader.readAsDataURL(file);
            }
        }

        function addMoodboardItem(boardId, url) {
            const grid = document.querySelector(`[data-moodboard-id="${boardId}"]`);
            if (!grid) return;

            const addBtn = grid.querySelector('.moodboard-add');

            const item = document.createElement('div');
            item.className = 'moodboard-item';
            item.innerHTML = `
                <img src="${url}" alt="Reference">
                <button class="remove-moodboard" onclick="removeMoodboardItem(this, '${boardId}')">×</button>
            `;

            grid.insertBefore(item, addBtn);
            updateMoodboardCount(boardId);
        }

        function removeMoodboardItem(btn, boardId) {
            const item = btn.closest('.moodboard-item');
            if (item) {
                item.remove();
                saveMoodboard(boardId);
                updateMoodboardCount(boardId);
                showGlobalStatus('Removed from moodboard');
            }
        }

        function saveMoodboard(boardId) {
            const grid = document.querySelector(`[data-moodboard-id="${boardId}"]`);
            if (!grid) return;

            const items = [];

            // Save images
            grid.querySelectorAll('.moodboard-item:not(.link-item)').forEach(item => {
                const img = item.querySelector('img');
                if (img && img.src) {
                    items.push({ type: 'image', url: img.src });
                }
            });

            // Save links
            grid.querySelectorAll('.moodboard-item.link-item').forEach(item => {
                const url = item.getAttribute('data-link-url');
                const title = item.getAttribute('data-link-title');
                if (url) {
                    items.push({ type: 'link', url: url, title: title || '' });
                }
            });

            localStorage.setItem(`moodboard-${boardId}`, JSON.stringify(items));
            updateMoodboardCount(boardId);
            triggerAutoSave();
        }

        function loadMoodboard(boardId) {
            try {
                const data = JSON.parse(localStorage.getItem(`moodboard-${boardId}`) || '[]');

                // Handle old format (array of URLs) and new format (array of objects)
                data.forEach(item => {
                    if (typeof item === 'string') {
                        // Old format - just image URL
                        addMoodboardItem(boardId, item);
                    } else if (item.type === 'image') {
                        addMoodboardItem(boardId, item.url);
                    } else if (item.type === 'link') {
                        addMoodboardLinkItem(boardId, item.url, item.title);
                    }
                });

                updateMoodboardCount(boardId);
            } catch (e) {
                console.warn('Could not load moodboard');
            }
        }

        function updateMoodboardCount(boardId) {
            const grid = document.querySelector(`[data-moodboard-id="${boardId}"]`);
            const countEl = document.querySelector(`[data-count-for="${boardId}"]`);
            if (!grid || !countEl) return;

            const imageCount = grid.querySelectorAll('.moodboard-item:not(.link-item)').length;
            const linkCount = grid.querySelectorAll('.moodboard-item.link-item').length;
            const total = imageCount + linkCount;

            let countText = '';
            if (imageCount > 0 && linkCount > 0) {
                countText = `${imageCount} image${imageCount !== 1 ? 's' : ''}, ${linkCount} link${linkCount !== 1 ? 's' : ''}`;
            } else if (imageCount > 0) {
                countText = `${imageCount} image${imageCount !== 1 ? 's' : ''}`;
            } else if (linkCount > 0) {
                countText = `${linkCount} link${linkCount !== 1 ? 's' : ''}`;
            } else {
                countText = '0 items';
            }

            countEl.textContent = countText;
        }

        function initMoodboards() {
            document.querySelectorAll('[data-moodboard-id]').forEach(grid => {
                const boardId = grid.dataset.moodboardId;
                loadMoodboard(boardId);
            });
        }

        // ==========================================
        // FRAME TEMPLATES (Quick Add)
        // ==========================================

        const frameTemplates = {
            'establishing': { type: 'Opening', title: 'ESTABLISHING SHOT', desc: 'Wide shot. Set the scene and tone.' },
            'cu': { type: 'Close-up', title: 'CLOSE-UP', desc: 'Tight on subject. Emotion or detail.' },
            'dialogue': { type: 'Dialogue', title: 'DIALOGUE', desc: 'Characters speaking. Action/reaction.' },
            'montage': { type: 'Montage', title: 'MONTAGE', desc: 'Quick cuts. Time passing or building energy.' },
            'reveal': { type: 'Reveal', title: 'THE REVEAL', desc: 'The twist or key information lands.' },
            'reaction': { type: 'Reaction', title: 'REACTION', desc: 'Character responds to event.' },
            'endcard': { type: 'End Card', title: 'END CARD', desc: 'Logo and tagline.' }
        };

        function showFrameTemplates(tabId, btn) {
            // Remove existing dropdown
            const existing = document.querySelector('.frame-template-dropdown');
            if (existing) existing.remove();

            const dropdown = document.createElement('div');
            dropdown.className = 'frame-template-dropdown show';
            dropdown.innerHTML = Object.entries(frameTemplates).map(([id, t]) => `
                <div class="frame-template-option" onclick="addFrameFromTemplate('${tabId}', '${id}')">
                    ${t.title}
                    <small>${t.type}</small>
                </div>
            `).join('');

            btn.style.position = 'relative';
            btn.appendChild(dropdown);

            setTimeout(() => {
                document.addEventListener('click', function close(e) {
                    if (!dropdown.contains(e.target)) {
                        dropdown.remove();
                        document.removeEventListener('click', close);
                    }
                });
            }, 10);
        }

        function addFrameFromTemplate(tabId, templateId) {
            const template = frameTemplates[templateId];
            if (!template) return;

            const container = document.querySelector(`#${tabId} .frames-container`);
            if (!container) return;

            const existingFrames = container.querySelectorAll('.frame');
            const newFrameNum = existingFrames.length + 1;
            const frameId = `${tabId}-${newFrameNum}`;

            const frameHtml = `
                <div class="frame ${templateId === 'endcard' ? 'endcard' : ''}" data-frame="${newFrameNum}" data-tab="${tabId}">
                    <div class="frame-visual" data-frame-id="${frameId}">
                        <span class="frame-number">${String(newFrameNum).padStart(2, '0')}</span>
                        <button class="remove-image">Remove</button>
                        <div class="visual-content">
                            <div class="visual-description" contenteditable="true" data-editable-id="${frameId}-visual">
                                Click to describe visual...
                            </div>
                        </div>
                        <span class="upload-hint">Click or drag image to upload</span>
                        <input type="file" class="frame-file-input" accept="image/*">
                    </div>
                    <div class="frame-details">
                        <span class="frame-type" contenteditable="true" data-editable-id="${frameId}-type">${template.type}</span>
                        <h2 class="frame-title" contenteditable="true" data-editable-id="${frameId}-title">${template.title}</h2>
                        <p class="frame-description" contenteditable="true" data-editable-id="${frameId}-desc">${template.desc}</p>
                        <div class="frame-notes" data-notes-id="${frameId}">
                            <strong>Production Notes</strong>
                            <ul>
                                <li class="note-item" contenteditable="true">Add notes...<span class="delete-note" onclick="deleteNote(event)">×</span></li>
                            </ul>
                            <button class="add-note-btn" onclick="addNote(this)">+ Add Note</button>
                        </div>
                        <div class="image-url-container">
                            <input type="text" class="image-url-input" data-frame-id="${frameId}" placeholder="Paste image URL (press Enter to load)">
                            <button class="image-url-btn" onclick="loadImageFromInput('${frameId}')">Load</button>
                            <button class="image-url-btn clear" onclick="clearImageInput('${frameId}')">Clear</button>
                        </div>
                        <div class="cd-comments">
                            <div class="cd-comments-header">
                                <span class="cd-comments-label">CD Comments</span>
                                <span class="cd-comments-status">Saved</span>
                            </div>
                            <textarea class="cd-comments-textarea" data-comment-id="${frameId}" placeholder="Add feedback, notes, or questions..."></textarea>
                        </div>
                        <button class="delete-tab-btn" style="margin-top: 16px;" onclick="deleteFrame(this)">Delete Frame</button>
                    </div>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', frameHtml);

            // Re-initialize
            initEditableText();
            initNotes();
            initFrameUploads();
            initComments();

            // Scroll to new frame
            const newFrame = container.querySelector(`.frame[data-frame="${newFrameNum}"]`);
            if (newFrame) {
                newFrame.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            // Close dropdown
            const dropdown = document.querySelector('.frame-template-dropdown');
            if (dropdown) dropdown.remove();

            showGlobalStatus(`Added ${template.type} frame`);
            triggerAutoSave();
        }

        // ==========================================
        // ADD DELETE BUTTONS TO FRAMES
        // ==========================================

        function initFrameDeleteButtons() {
            document.querySelectorAll('.frame').forEach(frame => {
                const details = frame.querySelector('.frame-details');
                if (!details) return;

                // Check if already has delete button
                if (frame.querySelector('.delete-frame-btn')) return;

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-frame-btn';
                deleteBtn.textContent = 'Delete Frame';
                deleteBtn.style.cssText = 'margin-top: 20px; font-family: Space Mono, monospace; font-size: 9px; letter-spacing: 1px; text-transform: uppercase; padding: 8px 14px; background: transparent; border: 1px solid #ff3b3b33; color: #ff3b3b99; cursor: pointer; border-radius: 2px; transition: all 0.2s; display: block;';
                deleteBtn.onmouseover = () => { deleteBtn.style.borderColor = '#ff3b3b'; deleteBtn.style.color = '#ff3b3b'; };
                deleteBtn.onmouseout = () => { deleteBtn.style.borderColor = '#ff3b3b33'; deleteBtn.style.color = '#ff3b3b99'; };
                deleteBtn.onclick = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    deleteFrame(deleteBtn);
                };
                details.appendChild(deleteBtn);
            });
        }

        // ==========================================
        // INITIALIZE ALL NEW FEATURES
        // ==========================================

        function initNewFeatures() {
            loadVersions();
            renderVersionHistory();
            initComments();
            initMoodboards();
            initFrameDeleteButtons();
            initNoteSections();
            initReferenceFinder();

            // Save initial version if none exist
            if (versions.length === 0) {
                setTimeout(() => saveVersion('Initial state'), 1000);
            }
        }

        // Hook into existing init
        const originalInitAll = initAll;
        initAll = function() {
            originalInitAll();
            initNewFeatures();
        };

        // Re-run if already loaded
        if (document.readyState !== 'loading') {
            initNewFeatures();
        }

        // ==========================================
        // AI IMAGE GENERATION
        // ==========================================

        const aiState = {};

        function toggleAIPanel(frameId) {
            const panel = document.querySelector(`[data-ai-panel="${frameId}"]`);
            if (!panel) return;

            const isOpen = panel.classList.contains('open');

            // Close all other panels first
            document.querySelectorAll('.ai-panel.open').forEach(p => {
                p.classList.remove('open');
            });

            if (!isOpen) {
                panel.classList.add('open');
                // Auto-fill prompt from visual description
                autoFillPrompt(frameId);
            }
        }

        function closeAIPanel(frameId) {
            const panel = document.querySelector(`[data-ai-panel="${frameId}"]`);
            if (panel) panel.classList.remove('open');
        }

        function selectAIModel(frameId, model, btn) {
            // Update visual state
            const panel = btn.closest('.ai-model-options');
            panel.querySelectorAll('.ai-model-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            btn.classList.add('selected');

            // Store selection
            if (!aiState[frameId]) aiState[frameId] = {};
            aiState[frameId].model = model;
        }

        function addAIReference(frameId) {
            const grid = document.querySelector(`[data-refs="${frameId}"]`);
            if (!grid) return;

            const currentRefs = grid.querySelectorAll('.ai-reference-item').length;
            if (currentRefs >= 5) {
                showGlobalStatus('Max 5 reference images');
                return;
            }

            const input = grid.querySelector('.ai-ref-input');
            if (input) {
                input.onchange = async (e) => {
                    if (e.target.files && e.target.files[0]) {
                        await addReferenceImage(frameId, e.target.files[0]);
                    }
                    input.value = '';
                };
                input.click();
            }
        }

        async function addReferenceImage(frameId, file) {
            const grid = document.querySelector(`[data-refs="${frameId}"]`);
            if (!grid) return;

            // Read as base64 for display
            const reader = new FileReader();
            reader.onload = (e) => {
                const addBtn = grid.querySelector('.ai-reference-add');

                const item = document.createElement('div');
                item.className = 'ai-reference-item';
                item.innerHTML = `
                    <img src="${e.target.result}" alt="Reference">
                    <button class="ai-reference-remove" onclick="removeAIReference('${frameId}', this)">×</button>
                `;

                grid.insertBefore(item, addBtn);
                updateRefCount(frameId);

                // Store reference
                if (!aiState[frameId]) aiState[frameId] = {};
                if (!aiState[frameId].refs) aiState[frameId].refs = [];
                aiState[frameId].refs.push(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        function removeAIReference(frameId, btn) {
            const item = btn.closest('.ai-reference-item');
            const img = item.querySelector('img');

            if (aiState[frameId] && aiState[frameId].refs) {
                const idx = aiState[frameId].refs.indexOf(img.src);
                if (idx > -1) aiState[frameId].refs.splice(idx, 1);
            }

            item.remove();
            updateRefCount(frameId);
        }

        function updateRefCount(frameId) {
            const grid = document.querySelector(`[data-refs="${frameId}"]`);
            const count = grid ? grid.querySelectorAll('.ai-reference-item').length : 0;
            const countEl = document.querySelector(`[data-ref-count="${frameId}"]`);
            if (countEl) countEl.textContent = `(${count}/5)`;
        }

        function autoFillPrompt(frameId) {
            const frame = document.querySelector(`[data-frame-id="${frameId}"]`)?.closest('.frame');
            if (!frame) return;

            const visualDesc = frame.querySelector('.visual-description')?.textContent?.trim() || '';
            const frameDesc = frame.querySelector('.frame-description')?.textContent?.trim() || '';

            const promptTextarea = document.querySelector(`[data-prompt="${frameId}"]`);
            if (promptTextarea) {
                // Combine descriptions for a rich prompt
                let prompt = visualDesc;
                if (frameDesc && frameDesc !== 'Click to add description...') {
                    prompt += '\n\n' + frameDesc;
                }
                promptTextarea.value = prompt;
            }
        }

        async function generateAIImage(frameId) {
            const panel = document.querySelector(`[data-ai-panel="${frameId}"]`);
            if (!panel) return;

            const promptTextarea = panel.querySelector(`[data-prompt="${frameId}"]`);
            const prompt = promptTextarea?.value?.trim();

            if (!prompt) {
                showGlobalStatus('Please enter a prompt');
                return;
            }

            // Get selected model
            const selectedModel = panel.querySelector('.ai-model-option.selected');
            const model = selectedModel?.dataset.model || 'nanobananapro';

            // Get reference images
            const refs = aiState[frameId]?.refs || [];

            // Show loading state
            const submitBtn = panel.querySelector('.ai-generate-submit');
            const statusEl = panel.querySelector(`[data-status="${frameId}"]`);

            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            statusEl.classList.add('visible');
            statusEl.querySelector('.ai-status-text').textContent = `Generating with ${model === 'nanobananapro' ? 'NanoBananaPro' : 'Seedream 4.5'}...`;

            try {
                // API call placeholder - this would connect to actual AI services
                // For now, we'll simulate with a timeout and show the expected behavior
                showGlobalStatus(`Sending to ${model}...`);

                // In production, this would be:
                // const response = await fetch('/api/generate', {
                //     method: 'POST',
                //     body: JSON.stringify({ prompt, model, refs })
                // });
                // const { imageUrl } = await response.json();

                // Simulate generation time
                await new Promise(resolve => setTimeout(resolve, 2000));

                // For demo: Show message that API would be called
                statusEl.querySelector('.ai-status-text').textContent = 'API integration pending - connect your AI service';

                setTimeout(() => {
                    submitBtn.classList.remove('loading');
                    submitBtn.disabled = false;
                    statusEl.classList.remove('visible');
                    showGlobalStatus('Connect NanoBananaPro or Seedream API to generate');
                }, 2000);

            } catch (error) {
                console.error('AI generation error:', error);
                showGlobalStatus('Generation failed - check console');
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
                statusEl.classList.remove('visible');
            }
        }

        // Add AI generate buttons to existing frames
        function initAIGenerateButtons() {
            document.querySelectorAll('.frame-visual').forEach(visual => {
                if (visual.querySelector('.ai-generate-btn')) return; // Already has button

                const frameId = visual.dataset.frameId;
                if (!frameId) return;

                // Add the button
                const btn = document.createElement('button');
                btn.className = 'ai-generate-btn';
                btn.innerHTML = '<span class="sparkle">✨</span> AI Generate';
                btn.onclick = (e) => {
                    e.stopPropagation();
                    toggleAIPanel(frameId);
                };
                visual.appendChild(btn);

                // Add AI panel to frame-details
                const frame = visual.closest('.frame');
                const details = frame?.querySelector('.frame-details');
                if (details && !details.querySelector(`[data-ai-panel="${frameId}"]`)) {
                    const frameDesc = details.querySelector('.frame-description');
                    if (frameDesc) {
                        const panelHtml = createAIPanelHTML(frameId);
                        frameDesc.insertAdjacentHTML('afterend', panelHtml);
                    }
                }
            });
        }

        function createAIPanelHTML(frameId) {
            return `
                <div class="ai-panel" data-ai-panel="${frameId}">
                    <div class="ai-panel-header">
                        <span class="ai-panel-title"><span>✨</span> AI Image Generation</span>
                        <button class="ai-panel-close" onclick="closeAIPanel('${frameId}')">×</button>
                    </div>
                    <div class="ai-panel-body">
                        <div class="ai-model-selector">
                            <span class="ai-model-label">Select Model</span>
                            <div class="ai-model-options">
                                <div class="ai-model-option selected" data-model="nanobananapro" onclick="selectAIModel('${frameId}', 'nanobananapro', this)">
                                    <div class="model-name">NanoBananaPro</div>
                                    <div class="model-desc">Fast, stylized</div>
                                </div>
                                <div class="ai-model-option" data-model="seedream" onclick="selectAIModel('${frameId}', 'seedream', this)">
                                    <div class="model-name">Seedream 4.5</div>
                                    <div class="model-desc">Photorealistic</div>
                                </div>
                            </div>
                        </div>
                        <div class="ai-references">
                            <span class="ai-references-label">
                                Reference Images <span class="ai-references-count" data-ref-count="${frameId}">(0/5)</span>
                            </span>
                            <div class="ai-references-grid" data-refs="${frameId}">
                                <div class="ai-reference-add" onclick="addAIReference('${frameId}')">
                                    <span class="ai-reference-add-icon">+</span>
                                    <span class="ai-reference-add-text">Add Ref</span>
                                    <input type="file" class="ai-ref-input" accept="image/*" style="display:none">
                                </div>
                            </div>
                        </div>
                        <div class="ai-prompt">
                            <span class="ai-prompt-label">
                                Prompt
                                <span class="ai-prompt-auto" onclick="autoFillPrompt('${frameId}')">↻ Auto-fill from description</span>
                            </span>
                            <textarea class="ai-prompt-textarea" data-prompt="${frameId}" placeholder="Describe the image you want to generate..."></textarea>
                        </div>
                        <button class="ai-generate-submit" onclick="generateAIImage('${frameId}')">
                            <span>✨</span> Generate Image
                        </button>
                        <div class="ai-status" data-status="${frameId}">
                            <div class="ai-status-spinner"></div>
                            <span class="ai-status-text">Generating...</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // ==========================================
        // FOCUS MODE
        // ==========================================

        let focusModeActive = false;

        function toggleFocusMode() {
            focusModeActive = !focusModeActive;
            document.body.classList.toggle('focus-mode', focusModeActive);

            const btn = document.querySelector('.focus-toggle-btn');
            if (btn) {
                btn.classList.toggle('active', focusModeActive);
                btn.innerHTML = focusModeActive
                    ? '<span>◉</span> Exit Focus'
                    : '<span>◎</span> Focus';
            }

            if (focusModeActive) {
                showGlobalStatus('Focus mode ON - hover over frames');
                initFocusTracking();
            } else {
                showGlobalStatus('Focus mode OFF');
                document.querySelectorAll('.frame.focused').forEach(f => f.classList.remove('focused'));
            }
        }

        function initFocusTracking() {
            document.querySelectorAll('.frame').forEach(frame => {
                frame.onmouseenter = () => {
                    if (focusModeActive) {
                        document.querySelectorAll('.frame.focused').forEach(f => f.classList.remove('focused'));
                        frame.classList.add('focused');
                    }
                };
            });
        }

        // ==========================================
        // MOODBOARD COLLAPSIBLE
        // ==========================================

        function toggleMoodboard(header) {
            const section = header.closest('.moodboard-section');
            if (section) {
                section.classList.toggle('collapsed');
            }
        }

        function updateMoodboardCount(boardId) {
            const grid = document.querySelector(`[data-moodboard-id="${boardId}"]`);
            const count = grid ? grid.querySelectorAll('.moodboard-item').length : 0;
            const countEl = document.querySelector(`[data-count-for="${boardId}"]`);
            if (countEl) {
                countEl.textContent = `${count} image${count !== 1 ? 's' : ''}`;
            }
        }

        // Override the existing addMoodboardItem to also update count
        const originalAddMoodboardItem = addMoodboardItem;
        addMoodboardItem = function(boardId, url) {
            originalAddMoodboardItem(boardId, url);
            updateMoodboardCount(boardId);
        };

        const originalRemoveMoodboardItem = removeMoodboardItem;
        removeMoodboardItem = function(btn, boardId) {
            originalRemoveMoodboardItem(btn, boardId);
            updateMoodboardCount(boardId);
        };

        // ==========================================
        // HOMEPAGE / DASHBOARD
        // ==========================================

        function showHomepage() {
            document.body.classList.add('show-homepage');
            populateHomepage();
        }

        function hideHomepage() {
            document.body.classList.remove('show-homepage');
        }

        function populateHomepage() {
            const grid = document.getElementById('briefsGrid');
            if (!grid) return;

            const tabs = document.querySelectorAll('.tab-btn:not(.home-btn):not(.add-tab-btn)');

            let html = '';

            tabs.forEach(tab => {
                const tabId = tab.dataset.tab;
                const tabContent = document.getElementById(tabId);
                if (!tabContent) return;

                const title = tabContent.querySelector('.project-title')?.textContent || 'Untitled';
                const client = tabContent.querySelector('[data-editable-id$="-client"]')?.textContent || tabId.toUpperCase();
                const format = tabContent.querySelector('[data-editable-id$="-format"]')?.textContent || '';
                const date = tabContent.querySelector('[data-editable-id$="-date"]')?.textContent || '';

                // Get status
                const badge = tab.querySelector('.wip-badge');
                const status = badge ? badge.textContent.replace('×', '').trim() : '';

                // Get first frame image
                const firstImg = tabContent.querySelector('.frame-image');
                const thumbnailHtml = firstImg
                    ? `<img src="${firstImg.src}" alt="${title}">`
                    : '';

                // Count frames
                const frames = tabContent.querySelectorAll('.frame');
                const frameCount = frames.length;

                // Build frame dots
                const frameDots = Array.from(frames).slice(0, 8).map(f => {
                    const hasImage = f.querySelector('.frame-image');
                    return `<div class="brief-card-frame-dot ${hasImage ? 'has-image' : ''}"></div>`;
                }).join('');

                html += `
                    <div class="brief-card" onclick="openBrief('${tabId}')">
                        <div class="brief-card-thumbnail">
                            ${thumbnailHtml}
                            <div class="brief-card-frames">${frameDots}</div>
                            ${status ? `<div class="brief-card-status">${status}</div>` : ''}
                        </div>
                        <div class="brief-card-body">
                            <div class="brief-card-client">${client}</div>
                            <div class="brief-card-title">${title}</div>
                            <div class="brief-card-meta">${frameCount} frames · ${format} · ${date}</div>
                        </div>
                    </div>
                `;
            });

            // Add "New Brief" card
            html += `
                <div class="brief-card brief-card-new" onclick="hideHomepage(); showNewBriefModal();">
                    <div class="brief-card-new-content">
                        <div class="brief-card-new-icon">+</div>
                        <div class="brief-card-new-text">New Brief</div>
                    </div>
                </div>
            `;

            grid.innerHTML = html;
        }

        function openBrief(tabId) {
            hideHomepage();
            const tabBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
            if (tabBtn) tabBtn.click();
        }

        // ==========================================
        // INIT ALL NEW FEATURES v2
        // ==========================================

        function initAllNewFeaturesV2() {
            initAIGenerateButtons();
            initFocusTracking();

            // Update moodboard counts
            document.querySelectorAll('[data-moodboard-id]').forEach(grid => {
                updateMoodboardCount(grid.dataset.moodboardId);
            });
        }

        // Run on load
        window.addEventListener('DOMContentLoaded', initAllNewFeaturesV2);
        if (document.readyState !== 'loading') {
            initAllNewFeaturesV2();
        }

        // ==========================================
        // BRIEF SHARING
        // ==========================================

        let currentShareBrief = null;
        let shareSettings = {
            password: '',
            showComments: false
        };

        function showShareModal(briefId) {
            currentShareBrief = briefId;
            const modal = document.getElementById('shareModal');
            modal.classList.add('show');

            // Generate share URL
            updateShareLink();

            // Reset toggles
            document.getElementById('sharePasswordToggle').classList.remove('active');
            document.getElementById('shareCommentsToggle').classList.remove('active');
            document.getElementById('sharePasswordField').classList.remove('visible');
            document.getElementById('sharePasswordInput').value = '';
            shareSettings = { password: '', showComments: false };
        }

        function hideShareModal() {
            document.getElementById('shareModal').classList.remove('show');
            currentShareBrief = null;
        }

        function updateShareLink() {
            const baseUrl = window.location.origin + window.location.pathname;
            const params = new URLSearchParams();
            params.set('view', currentShareBrief);

            if (shareSettings.password) {
                // Simple encoding - in production use proper encryption
                params.set('p', btoa(shareSettings.password));
            }
            if (shareSettings.showComments) {
                params.set('comments', '1');
            }

            const shareUrl = `${baseUrl}?${params.toString()}`;
            document.getElementById('shareLinkInput').value = shareUrl;
        }

        function copyShareLink() {
            const input = document.getElementById('shareLinkInput');
            input.select();
            document.execCommand('copy');

            const btn = document.getElementById('shareCopyBtn');
            btn.textContent = 'Copied!';
            btn.classList.add('copied');

            setTimeout(() => {
                btn.textContent = 'Copy';
                btn.classList.remove('copied');
            }, 2000);

            showGlobalStatus('Link copied to clipboard');
        }

        function toggleSharePassword() {
            const toggle = document.getElementById('sharePasswordToggle');
            const field = document.getElementById('sharePasswordField');
            toggle.classList.toggle('active');
            field.classList.toggle('visible', toggle.classList.contains('active'));

            if (!toggle.classList.contains('active')) {
                shareSettings.password = '';
                document.getElementById('sharePasswordInput').value = '';
            }
            updateShareLink();
        }

        function toggleShareComments() {
            const toggle = document.getElementById('shareCommentsToggle');
            toggle.classList.toggle('active');
            shareSettings.showComments = toggle.classList.contains('active');
            updateShareLink();
        }

        // Update password in real-time
        document.getElementById('sharePasswordInput')?.addEventListener('input', (e) => {
            shareSettings.password = e.target.value;
            updateShareLink();
        });

        function previewClientView() {
            hideShareModal();
            enterClientView(currentShareBrief, shareSettings.showComments);
        }

        function enterClientView(briefId, showComments = false) {
            // Switch to the brief tab
            const tabBtn = document.querySelector(`.tab-btn[data-tab="${briefId}"]`);
            if (tabBtn) tabBtn.click();

            // Enter client view mode
            document.body.classList.add('client-view');

            // Make all contenteditable elements read-only
            document.querySelectorAll('[contenteditable]').forEach(el => {
                el.setAttribute('contenteditable', 'false');
            });

            // Show/hide comments based on setting
            if (!showComments) {
                document.querySelectorAll('.comments-section, .cd-comments').forEach(el => {
                    el.style.display = 'none';
                });
            }

            showGlobalStatus('Client view active');
        }

        function exitClientView() {
            document.body.classList.remove('client-view');

            // Restore contenteditable
            document.querySelectorAll('[contenteditable="false"]').forEach(el => {
                el.setAttribute('contenteditable', 'true');
            });

            // Show comments again
            document.querySelectorAll('.comments-section, .cd-comments').forEach(el => {
                el.style.display = '';
            });

            showGlobalStatus('Editor view restored');
        }

        // Check URL for shared view on load
        function checkForSharedView() {
            const params = new URLSearchParams(window.location.search);
            const viewBrief = params.get('view');

            if (viewBrief) {
                const passwordHash = params.get('p');
                const showComments = params.get('comments') === '1';

                if (passwordHash) {
                    // Show password gate
                    const password = atob(passwordHash);
                    showPasswordGate(viewBrief, password, showComments);
                } else {
                    // Direct view
                    setTimeout(() => {
                        enterClientView(viewBrief, showComments);
                    }, 500);
                }
            }
        }

        function showPasswordGate(briefId, password, showComments) {
            const gate = document.getElementById('passwordGate');
            gate.classList.add('active');

            // Get brief title
            const tabContent = document.getElementById(briefId);
            const title = tabContent?.querySelector('.project-title')?.textContent || briefId;
            document.getElementById('passwordGateBrief').textContent = title;

            // Store for verification
            gate.dataset.briefId = briefId;
            gate.dataset.password = password;
            gate.dataset.showComments = showComments;

            // Focus input
            document.getElementById('passwordGateInput').focus();
        }

        function submitPassword() {
            const gate = document.getElementById('passwordGate');
            const input = document.getElementById('passwordGateInput');
            const error = document.getElementById('passwordGateError');

            if (input.value === gate.dataset.password) {
                gate.classList.remove('active');
                enterClientView(gate.dataset.briefId, gate.dataset.showComments === 'true');
            } else {
                error.classList.add('visible');
                input.value = '';
                input.focus();
                setTimeout(() => error.classList.remove('visible'), 3000);
            }
        }

        // Enter key to submit password
        document.getElementById('passwordGateInput')?.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') submitPassword();
        });

        // Check for shared view on load
        window.addEventListener('DOMContentLoaded', checkForSharedView);

        // ==========================================
        // FRAME VARIATIONS
        // ==========================================

        const frameVariations = {}; // { frameId: { variations: [{id, image, desc}], selected: 0, active: 0 } }

        function initFrameVariations() {
            document.querySelectorAll('.frame').forEach(frame => {
                const visual = frame.querySelector('.frame-visual');
                const frameId = visual?.dataset.frameId;
                if (!frameId) return;

                // Skip if already has variations UI
                if (frame.querySelector('.frame-variations')) return;

                // Initialize variation data
                if (!frameVariations[frameId]) {
                    frameVariations[frameId] = {
                        variations: [{ id: 'A', image: null, desc: '' }],
                        selected: 0,
                        active: 0
                    };
                }

                // Add variations UI
                const details = frame.querySelector('.frame-details');
                const frameType = details?.querySelector('.frame-type');
                if (frameType) {
                    const variationsHtml = createVariationsHTML(frameId);
                    frameType.insertAdjacentHTML('beforebegin', variationsHtml);
                }
            });

            // Load saved variations
            loadVariations();
        }

        function createVariationsHTML(frameId) {
            const data = frameVariations[frameId];
            if (!data) return '';

            const tabs = data.variations.map((v, i) => {
                const isActive = i === data.active;
                const isSelected = i === data.selected;
                return `<button class="variation-tab ${isActive ? 'active' : ''} ${isSelected ? 'selected-variation' : ''}"
                    onclick="switchVariation('${frameId}', ${i})">${v.id}</button>`;
            }).join('');

            return `
                <div class="frame-variations" data-variations-for="${frameId}">
                    <div class="variation-tabs">
                        ${tabs}
                        <button class="variation-add" onclick="addVariation('${frameId}')" title="Add variation">+</button>
                    </div>
                    <div class="variation-actions">
                        <button class="variation-action-btn select-btn" onclick="selectVariation('${frameId}')" title="Mark as selected">✓ Select</button>
                        <button class="variation-action-btn" onclick="compareVariations('${frameId}')" title="Compare side-by-side">Compare</button>
                        <button class="variation-action-btn delete-btn" onclick="deleteVariation('${frameId}')" title="Delete this variation">×</button>
                    </div>
                </div>
            `;
        }

        function addVariation(frameId) {
            const data = frameVariations[frameId];
            if (!data) return;

            // Max 5 variations
            if (data.variations.length >= 5) {
                showGlobalStatus('Max 5 variations per frame');
                return;
            }

            // Get next letter
            const letters = 'ABCDE';
            const nextId = letters[data.variations.length];

            data.variations.push({ id: nextId, image: null, desc: '' });

            // Switch to new variation
            data.active = data.variations.length - 1;

            // Clear current image for new variation
            const frame = document.querySelector(`[data-frame-id="${frameId}"]`);
            const img = frame?.querySelector('.frame-image');
            if (img) img.remove();

            // Show placeholder again
            const visualContent = frame?.querySelector('.visual-content');
            if (visualContent) visualContent.style.opacity = '1';

            updateVariationsUI(frameId);
            saveVariations();
            showGlobalStatus(`Added variation ${nextId}`);
        }

        function switchVariation(frameId, index) {
            const data = frameVariations[frameId];
            if (!data || index >= data.variations.length) return;

            // Save current variation's image
            const frame = document.querySelector(`[data-frame-id="${frameId}"]`);
            const currentImg = frame?.querySelector('.frame-image');
            if (currentImg) {
                data.variations[data.active].image = currentImg.src;
            }

            // Switch to new variation
            data.active = index;
            const variation = data.variations[index];

            // Load variation's image
            if (variation.image) {
                loadImageFromUrlDirect(frameId, variation.image);
            } else {
                // Clear image
                const img = frame?.querySelector('.frame-image');
                if (img) img.remove();
                const visualContent = frame?.querySelector('.visual-content');
                if (visualContent) visualContent.style.opacity = '1';
            }

            updateVariationsUI(frameId);
            saveVariations();
        }

        function selectVariation(frameId) {
            const data = frameVariations[frameId];
            if (!data) return;

            data.selected = data.active;
            updateVariationsUI(frameId);
            saveVariations();
            showGlobalStatus(`Selected variation ${data.variations[data.active].id}`);
        }

        function deleteVariation(frameId) {
            const data = frameVariations[frameId];
            if (!data || data.variations.length <= 1) {
                showGlobalStatus('Cannot delete last variation');
                return;
            }

            const varId = data.variations[data.active].id;
            if (!confirm(`Delete variation ${varId}?`)) return;

            data.variations.splice(data.active, 1);

            // Adjust selected index if needed
            if (data.selected >= data.variations.length) {
                data.selected = data.variations.length - 1;
            }
            if (data.active >= data.variations.length) {
                data.active = data.variations.length - 1;
            }

            // Rename remaining variations
            data.variations.forEach((v, i) => {
                v.id = 'ABCDE'[i];
            });

            // Load new active variation
            switchVariation(frameId, data.active);

            updateVariationsUI(frameId);
            saveVariations();
            showGlobalStatus(`Deleted variation ${varId}`);
        }

        function updateVariationsUI(frameId) {
            const container = document.querySelector(`[data-variations-for="${frameId}"]`);
            if (!container) return;

            const data = frameVariations[frameId];
            if (!data) return;

            // Rebuild tabs
            const tabsContainer = container.querySelector('.variation-tabs');
            const tabs = data.variations.map((v, i) => {
                const isActive = i === data.active;
                const isSelected = i === data.selected;
                return `<button class="variation-tab ${isActive ? 'active' : ''} ${isSelected ? 'selected-variation' : ''}"
                    onclick="switchVariation('${frameId}', ${i})">${v.id}</button>`;
            }).join('');

            tabsContainer.innerHTML = tabs + `<button class="variation-add" onclick="addVariation('${frameId}')" title="Add variation">+</button>`;
        }

        function compareVariations(frameId) {
            const data = frameVariations[frameId];
            if (!data || data.variations.length < 2) {
                showGlobalStatus('Need at least 2 variations to compare');
                return;
            }

            // Save current image to current variation
            const frame = document.querySelector(`[data-frame-id="${frameId}"]`);
            const currentImg = frame?.querySelector('.frame-image');
            if (currentImg) {
                data.variations[data.active].image = currentImg.src;
            }

            // Show compare modal with first two variations
            openCompareModal(frameId, 0, 1);
        }

        function openCompareModal(frameId, leftIndex, rightIndex) {
            const modal = document.getElementById('compareModal');
            const data = frameVariations[frameId];

            modal.classList.add('active');
            modal.dataset.frameId = frameId;
            modal.dataset.leftIndex = leftIndex;
            modal.dataset.rightIndex = rightIndex;

            // Set labels
            document.getElementById('compareLeftLabel').textContent = data.variations[leftIndex].id;
            document.getElementById('compareRightLabel').textContent = data.variations[rightIndex].id;

            // Set images
            const leftImg = data.variations[leftIndex].image;
            const rightImg = data.variations[rightIndex].image;

            document.getElementById('compareLeftImage').innerHTML = leftImg
                ? `<img src="${leftImg}" alt="Variation ${data.variations[leftIndex].id}">`
                : `<div class="compare-placeholder">No image for variation ${data.variations[leftIndex].id}</div>`;

            document.getElementById('compareRightImage').innerHTML = rightImg
                ? `<img src="${rightImg}" alt="Variation ${data.variations[rightIndex].id}">`
                : `<div class="compare-placeholder">No image for variation ${data.variations[rightIndex].id}</div>`;
        }

        function closeCompare() {
            document.getElementById('compareModal').classList.remove('active');
        }

        function selectCompareVariation(side) {
            const modal = document.getElementById('compareModal');
            const frameId = modal.dataset.frameId;
            const data = frameVariations[frameId];

            const index = side === 'left' ? parseInt(modal.dataset.leftIndex) : parseInt(modal.dataset.rightIndex);
            data.selected = index;
            data.active = index;

            // Load the selected variation
            switchVariation(frameId, index);
            closeCompare();
            showGlobalStatus(`Selected variation ${data.variations[index].id}`);
        }

        function saveVariations() {
            try {
                localStorage.setItem('storyboard-variations', JSON.stringify(frameVariations));
            } catch (e) {
                console.warn('Could not save variations');
            }
        }

        function loadVariations() {
            try {
                const saved = localStorage.getItem('storyboard-variations');
                if (saved) {
                    Object.assign(frameVariations, JSON.parse(saved));
                }
            } catch (e) {
                console.warn('Could not load variations');
            }
        }

        // Hook into image upload to save to current variation
        const originalHandleImageUpload = handleImageUpload;
        if (typeof handleImageUpload === 'function') {
            handleImageUpload = async function(file, visual, frameId) {
                await originalHandleImageUpload(file, visual, frameId);

                // Save image URL to current variation
                if (frameVariations[frameId]) {
                    const data = frameVariations[frameId];
                    const imgUrl = imageUrls[frameId];
                    if (imgUrl) {
                        data.variations[data.active].image = imgUrl;
                        saveVariations();
                    }
                }
            };
        }

        // Initialize frame variations
        window.addEventListener('DOMContentLoaded', initFrameVariations);
        if (document.readyState !== 'loading') {
            initFrameVariations();
        }

        // Close modals on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                hideShareModal();
                closeCompare();
                hideExecutionModal();
            }
        });

        // Close modals on overlay click
        document.getElementById('shareModal')?.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) hideShareModal();
        });

        document.getElementById('executionModal')?.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) hideExecutionModal();
        });

        // ==========================================
        // EXECUTIONS
        // ==========================================

        // Data structure: { briefId: { executions: [{id, name, frames: [frameHTML]}], active: 0 } }
        const briefExecutions = {};
        let currentExecutionBrief = null;
        let selectedExecutionPreset = null;

        function initExecutions() {
            // Initialize execution data for each brief
            document.querySelectorAll('.tab-content').forEach(tab => {
                const briefId = tab.id;
                if (!briefExecutions[briefId]) {
                    // Get current frames as the "main" execution
                    const framesContainer = tab.querySelector('.frames-container');
                    const frames = framesContainer ? framesContainer.innerHTML : '';
                    const sectionLabel = tab.querySelector('.storyboard-section .section-label');
                    const currentName = sectionLabel?.textContent?.match(/Storyboard — (.*)/)?.[1] || ':45';

                    briefExecutions[briefId] = {
                        executions: [{
                            id: 'main',
                            name: currentName,
                            framesHTML: frames
                        }],
                        active: 0
                    };
                }

                // Update frame count in execution tab
                updateExecutionFrameCount(briefId);
            });

            // Load saved executions
            loadExecutions();
        }

        function showExecutionModal(briefId) {
            currentExecutionBrief = briefId;
            selectedExecutionPreset = null;

            // Reset UI
            document.querySelectorAll('.execution-preset').forEach(p => p.classList.remove('selected'));
            document.getElementById('executionCustomInput').value = '';

            document.getElementById('executionModal').classList.add('show');
        }

        function hideExecutionModal() {
            document.getElementById('executionModal').classList.remove('show');
            currentExecutionBrief = null;
            selectedExecutionPreset = null;
        }

        function selectExecutionPreset(preset, btn) {
            selectedExecutionPreset = preset;
            document.querySelectorAll('.execution-preset').forEach(p => p.classList.remove('selected'));
            btn.classList.add('selected');
            document.getElementById('executionCustomInput').value = '';
        }

        function createExecution() {
            if (!currentExecutionBrief) return;

            const customName = document.getElementById('executionCustomInput').value.trim();
            const name = customName || selectedExecutionPreset;

            if (!name) {
                showGlobalStatus('Select a format or enter custom name');
                return;
            }

            const briefId = currentExecutionBrief;
            const data = briefExecutions[briefId];

            // Check if execution with this name already exists
            if (data.executions.some(e => e.name === name)) {
                showGlobalStatus(`Execution "${name}" already exists`);
                return;
            }

            // Create new execution with empty frames container
            const newExecution = {
                id: `exec-${Date.now()}`,
                name: name,
                framesHTML: createEmptyFramesHTML(briefId)
            };

            data.executions.push(newExecution);

            // Switch to new execution
            data.active = data.executions.length - 1;
            renderExecutionTabs(briefId);
            loadExecutionFrames(briefId);

            hideExecutionModal();
            saveExecutions();
            showGlobalStatus(`Created execution: ${name}`);
        }

        function createEmptyFramesHTML(briefId) {
            const frameId = `${briefId}-exec${Date.now()}-1`;
            return `
                <div class="frame" data-frame="1" data-tab="${briefId}">
                    <div class="frame-visual" data-frame-id="${frameId}">
                        <span class="frame-number">01</span>
                        <button class="remove-image">Remove</button>
                        <div class="visual-content">
                            <div class="visual-description" contenteditable="true" data-editable-id="${frameId}-visual">
                                Click to describe visual...
                            </div>
                        </div>
                        <button class="ai-generate-btn" onclick="event.stopPropagation(); toggleAIPanel('${frameId}')">
                            <span class="sparkle">✨</span> AI Generate
                        </button>
                        <span class="upload-hint">Click or drag image to upload</span>
                        <input type="file" class="frame-file-input" accept="image/*">
                    </div>
                    <div class="frame-details">
                        <span class="frame-type" contenteditable="true">Opening</span>
                        <h2 class="frame-title" contenteditable="true">FRAME 1</h2>
                        <p class="frame-description" contenteditable="true">Click to add description...</p>
                        <div class="cd-comments">
                            <div class="cd-comments-header">
                                <span class="cd-comments-label">CD Comments</span>
                            </div>
                            <textarea class="cd-comments-textarea" data-comment-id="${frameId}" placeholder="Add feedback..."></textarea>
                        </div>
                        <button class="delete-tab-btn" style="margin-top: 16px;" onclick="deleteFrame(this)">Delete Frame</button>
                    </div>
                </div>
            `;
        }

        function switchExecution(briefId, executionId) {
            const data = briefExecutions[briefId];
            if (!data) return;

            // Save current execution's frames
            const tab = document.getElementById(briefId);
            const framesContainer = tab?.querySelector('.frames-container');
            if (framesContainer) {
                data.executions[data.active].framesHTML = framesContainer.innerHTML;
            }

            // Find and switch to target execution
            const targetIndex = data.executions.findIndex(e => e.id === executionId);
            if (targetIndex === -1) return;

            data.active = targetIndex;

            // Load new execution's frames
            loadExecutionFrames(briefId);
            renderExecutionTabs(briefId);
            saveExecutions();
        }

        function loadExecutionFrames(briefId) {
            const data = briefExecutions[briefId];
            if (!data) return;

            const execution = data.executions[data.active];
            const tab = document.getElementById(briefId);
            const framesContainer = tab?.querySelector('.frames-container');
            const sectionLabel = tab?.querySelector('.storyboard-section .section-label');

            if (framesContainer) {
                framesContainer.innerHTML = execution.framesHTML;

                // Re-initialize everything
                initEditableText();
                initNotes();
                initFrameUploads();
                initComments();
                initFrameVariations();
                initAIGenerateButtons();
            }

            // Update section label
            if (sectionLabel) {
                sectionLabel.innerHTML = `Storyboard — <span class="execution-name">${execution.name}</span>`;
            }

            updateExecutionFrameCount(briefId);
        }

        function renderExecutionTabs(briefId) {
            const nav = document.querySelector(`[data-executions-for="${briefId}"]`);
            if (!nav) return;

            const data = briefExecutions[briefId];
            if (!data) return;

            // Build tabs HTML with dropdown menu on each
            const tabsHTML = data.executions.map((exec, i) => {
                const isActive = i === data.active;
                const frameCount = countFramesInHTML(exec.framesHTML);
                return `<button class="execution-tab ${isActive ? 'active' : ''}"
                    data-execution="${exec.id}"
                    onclick="switchExecution('${briefId}', '${exec.id}')">
                    ${exec.name} <span class="frame-count">(${frameCount})</span>
                    <span class="execution-menu-trigger" onclick="event.stopPropagation(); toggleExecutionMenu(this)">▾</span>
                    <div class="execution-menu">
                        <div class="execution-menu-item" onclick="event.stopPropagation(); renameExecution('${briefId}')">Rename</div>
                        <div class="execution-menu-item" onclick="event.stopPropagation(); duplicateExecution('${briefId}')">Duplicate</div>
                        <div class="execution-menu-item danger" onclick="event.stopPropagation(); deleteExecution('${briefId}')">Delete</div>
                    </div>
                </button>`;
            }).join('');

            nav.innerHTML = `
                <span class="executions-label">Executions</span>
                ${tabsHTML}
                <button class="execution-add" onclick="showExecutionModal('${briefId}')" title="Add execution">+</button>
            `;
        }

        function toggleExecutionMenu(trigger) {
            // Close all other menus first
            document.querySelectorAll('.execution-menu.show').forEach(menu => {
                if (menu !== trigger.nextElementSibling) {
                    menu.classList.remove('show');
                }
            });

            const menu = trigger.nextElementSibling;
            menu.classList.toggle('show');

            // Close on click outside
            if (menu.classList.contains('show')) {
                setTimeout(() => {
                    document.addEventListener('click', function closeMenu(e) {
                        if (!menu.contains(e.target) && e.target !== trigger) {
                            menu.classList.remove('show');
                            document.removeEventListener('click', closeMenu);
                        }
                    });
                }, 10);
            }
        }

        function countFramesInHTML(html) {
            const temp = document.createElement('div');
            temp.innerHTML = html;
            return temp.querySelectorAll('.frame').length;
        }

        function updateExecutionFrameCount(briefId) {
            const data = briefExecutions[briefId];
            if (!data) return;

            // Update current tab's frame count from live DOM
            const tab = document.getElementById(briefId);
            const frameCount = tab?.querySelectorAll('.frames-container .frame').length || 0;
            data.executions[data.active].frameCount = frameCount;

            // Update the tab button
            const activeTab = document.querySelector(`[data-executions-for="${briefId}"] .execution-tab.active .frame-count`);
            if (activeTab) {
                activeTab.textContent = `(${frameCount})`;
            }
        }

        function renameExecution(briefId) {
            const data = briefExecutions[briefId];
            if (!data) return;

            const execution = data.executions[data.active];
            const newName = prompt('Rename execution:', execution.name);

            if (newName && newName.trim()) {
                execution.name = newName.trim();
                renderExecutionTabs(briefId);
                loadExecutionFrames(briefId); // Update section label
                saveExecutions();
                showGlobalStatus(`Renamed to: ${newName}`);
            }
        }

        function duplicateExecution(briefId) {
            const data = briefExecutions[briefId];
            if (!data) return;

            // Save current frames first
            const tab = document.getElementById(briefId);
            const framesContainer = tab?.querySelector('.frames-container');
            if (framesContainer) {
                data.executions[data.active].framesHTML = framesContainer.innerHTML;
            }

            const source = data.executions[data.active];
            const newExecution = {
                id: `exec-${Date.now()}`,
                name: `${source.name} (copy)`,
                framesHTML: source.framesHTML
            };

            data.executions.push(newExecution);
            data.active = data.executions.length - 1;

            renderExecutionTabs(briefId);
            loadExecutionFrames(briefId);
            saveExecutions();
            showGlobalStatus(`Duplicated: ${source.name}`);
        }

        function deleteExecution(briefId) {
            const data = briefExecutions[briefId];
            if (!data || data.executions.length <= 1) {
                showGlobalStatus('Cannot delete last execution');
                return;
            }

            const execution = data.executions[data.active];
            if (!confirm(`Delete execution "${execution.name}"? This cannot be undone.`)) return;

            data.executions.splice(data.active, 1);

            if (data.active >= data.executions.length) {
                data.active = data.executions.length - 1;
            }

            renderExecutionTabs(briefId);
            loadExecutionFrames(briefId);
            saveExecutions();
            showGlobalStatus(`Deleted: ${execution.name}`);
        }

        function saveExecutions() {
            // Save current frames to active execution before persisting
            document.querySelectorAll('.tab-content').forEach(tab => {
                const briefId = tab.id;
                const data = briefExecutions[briefId];
                if (!data) return;

                const framesContainer = tab.querySelector('.frames-container');
                if (framesContainer) {
                    data.executions[data.active].framesHTML = framesContainer.innerHTML;
                }
            });

            try {
                localStorage.setItem('storyboard-executions', JSON.stringify(briefExecutions));
            } catch (e) {
                console.warn('Could not save executions');
            }
        }

        function loadExecutions() {
            try {
                const saved = localStorage.getItem('storyboard-executions');
                if (saved) {
                    const loaded = JSON.parse(saved);
                    Object.keys(loaded).forEach(briefId => {
                        if (briefExecutions[briefId]) {
                            briefExecutions[briefId] = loaded[briefId];
                            renderExecutionTabs(briefId);
                            // Don't load frames on init - they're already in the DOM
                        }
                    });
                }
            } catch (e) {
                console.warn('Could not load executions');
            }
        }

        // Hook into frame add/delete to update counts
        const originalAddFrame = addFrame;
        if (typeof addFrame === 'function') {
            addFrame = function(tabId) {
                originalAddFrame(tabId);
                updateExecutionFrameCount(tabId);
                saveExecutions();
            };
        }

        const originalDeleteFrame = deleteFrame;
        if (typeof deleteFrame === 'function') {
            deleteFrame = function(btn) {
                const frame = btn.closest('.frame');
                const tabId = frame?.dataset.tab;
                originalDeleteFrame(btn);
                if (tabId) {
                    updateExecutionFrameCount(tabId);
                    saveExecutions();
                }
            };
        }

        // Initialize executions
        window.addEventListener('DOMContentLoaded', initExecutions);
        if (document.readyState !== 'loading') {
            initExecutions();
        }
    </script>
</body>
</html>
